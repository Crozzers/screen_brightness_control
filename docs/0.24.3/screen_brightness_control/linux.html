<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>screen_brightness_control.linux API documentation
</title>
    
    <script type="text/javascript">
function get_version_navigation_base_url(){if(window.location.href.indexOf("screen_brightness_control.html")!==-1){return new URL("./../..",window.location.href);}
return new URL("./../../..",window.location.href);}
var css_url=new URL("version_navigator.css",get_version_navigation_base_url());var js_url=new URL("version_navigator.js",get_version_navigation_base_url());var link=document.createElement("link");link.rel="stylesheet";link.href=css_url;document.getElementsByTagName("head")[0].appendChild(link);window.onload=function(){var s=document.createElement("script");s.type="text/javascript";s.src=js_url;document.getElementById("custom-version-navigation").appendChild(s);}    </script>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>        <a class="pdoc-button module-list-button" href="https://crozzers.github.io/screen_brightness_control">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>            &nbsp;
            Back to homepage
        </a>
                    <a class="pdoc-button module-list-button" href="../screen_brightness_control.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;screen_brightness_control</a>



            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SysFiles">SysFiles</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SysFiles.get_display_info">get_display_info</a>
                        </li>
                        <li>
                                <a class="function" href="#SysFiles.get_brightness">get_brightness</a>
                        </li>
                        <li>
                                <a class="function" href="#SysFiles.set_brightness">set_brightness</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#I2C">I2C</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#I2C.GET_VCP_CMD">GET_VCP_CMD</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.GET_VCP_REPLY">GET_VCP_REPLY</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.SET_VCP_CMD">SET_VCP_CMD</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.DDCCI_ADDR">DDCCI_ADDR</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.HOST_ADDR_R">HOST_ADDR_R</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.HOST_ADDR_W">HOST_ADDR_W</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.DESTINATION_ADDR_W">DESTINATION_ADDR_W</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.I2C_SLAVE">I2C_SLAVE</a>
                        </li>
                        <li>
                                <a class="variable" href="#I2C.WAIT_TIME">WAIT_TIME</a>
                        </li>
                        <li>
                                <a class="class" href="#I2C.I2CDevice">I2C.I2CDevice</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#I2C.I2CDevice.__init__">I2CDevice</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#I2C.I2CDevice.device">device</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.I2CDevice.read">read</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.I2CDevice.write">write</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="class" href="#I2C.DDCInterface">I2C.DDCInterface</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#I2C.DDCInterface.__init__">DDCInterface</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#I2C.DDCInterface.PROTOCOL_FLAG">PROTOCOL_FLAG</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#I2C.DDCInterface.logger">logger</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.DDCInterface.write">write</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.DDCInterface.setvcp">setvcp</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.DDCInterface.read">read</a>
                                    </li>
                                    <li>
                                            <a class="function" href="#I2C.DDCInterface.getvcp">getvcp</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#I2C.get_display_info">get_display_info</a>
                        </li>
                        <li>
                                <a class="function" href="#I2C.get_brightness">get_brightness</a>
                        </li>
                        <li>
                                <a class="function" href="#I2C.set_brightness">set_brightness</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#XRandr">XRandr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#XRandr.executable">executable</a>
                        </li>
                        <li>
                                <a class="function" href="#XRandr.get_display_info">get_display_info</a>
                        </li>
                        <li>
                                <a class="function" href="#XRandr.get_brightness">get_brightness</a>
                        </li>
                        <li>
                                <a class="function" href="#XRandr.set_brightness">set_brightness</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DDCUtil">DDCUtil</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DDCUtil.executable">executable</a>
                        </li>
                        <li>
                                <a class="variable" href="#DDCUtil.sleep_multiplier">sleep_multiplier</a>
                        </li>
                        <li>
                                <a class="variable" href="#DDCUtil.cmd_max_tries">cmd_max_tries</a>
                        </li>
                        <li>
                                <a class="variable" href="#DDCUtil.enable_async">enable_async</a>
                        </li>
                        <li>
                                <a class="function" href="#DDCUtil.get_display_info">get_display_info</a>
                        </li>
                        <li>
                                <a class="function" href="#DDCUtil.get_brightness">get_brightness</a>
                        </li>
                        <li>
                                <a class="function" href="#DDCUtil.set_brightness">set_brightness</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#i2c_bus_from_drm_device">i2c_bus_from_drm_device</a>
            </li>
            <li>
                    <a class="function" href="#list_monitors_info">list_monitors_info</a>
            </li>
            <li>
                    <a class="variable" href="#METHODS">METHODS</a>
            </li>
    </ul>



    <div id="custom-version-navigation">
    </div>

    <h2>
        <a href="https://github.com/Crozzers/screen_brightness_control">GitHub</a>
    </h2>
    <ul>
        <li><a href="https://github.com/Crozzers/screen_brightness_control/releases">Releases</a></li>
        <li><a href="https://github.com/Crozzers/screen_brightness_control/issues">Issue Tracker</a></li>
        <li><a href="https://github.com/Crozzers/screen_brightness_control/pulls">Pull Requests</a></li>
    </ul>
    <h2>
        <a href="https://pypi.org/project/screen-brightness-control/">PyPI</a>
    </h2>
    <h2>
        <a href="https://github.com/Crozzers/screen_brightness_control/blob/main/LICENSE">License</a>
    </h2>
                <footer>screen_brightness_control v0.24.3</footer>


        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
    <section>
            

                <h1 class="modulename">
<a href="./../screen_brightness_control.html">screen_brightness_control</a><wbr>.linux    </h1>

        
                        <input id="mod-linux-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                <label class="view-source-button" for="mod-linux-view-source"><span>View Source</span></label>

                <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">fcntl</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">operator</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">filter_monitors</span><span class="p">,</span> <span class="n">get_methods</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">I2CValidationError</span><span class="p">,</span> <span class="n">NoValidDisplayError</span><span class="p">,</span> <span class="n">format_exc</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">EDID</span><span class="p">,</span> <span class="n">BrightnessMethod</span><span class="p">,</span> <span class="n">BrightnessMethodAdv</span><span class="p">,</span> <span class="n">__Cache</span><span class="p">,</span> <span class="n">_monitor_brand_lookup</span><span class="p">,</span> <span class="n">check_output</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">DisplayIdentifier</span><span class="p">,</span> <span class="n">IntPercentage</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="n">__cache__</span> <span class="o">=</span> <span class="n">__Cache</span><span class="p">()</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SysFiles</span><span class="p">(</span><span class="n">BrightnessMethod</span><span class="p">):</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">    A way of getting display information and adjusting the brightness</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    that does not rely on any 3rd party software.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    This class works with displays that show up in the `/sys/class/backlight`</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    directory (so usually laptop displays).</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    To set the brightness, your user will need write permissions for</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    `/sys/class/backlight/*/brightness` or you will need to run the program</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    as root.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;SysFiles&#39;</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="n">subsystems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/backlight&#39;</span><span class="p">):</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>                <span class="n">subsystems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">)))</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="n">displays_by_edid</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="c1"># map drm devices to their pci device paths</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">drm_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm/card*-*&#39;</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>            <span class="n">drm_paths</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="k">for</span> <span class="n">subsystem</span> <span class="ow">in</span> <span class="n">subsystems</span><span class="p">:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>            <span class="n">device</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>                <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>                <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>                <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>                <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>                <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>            <span class="p">}</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subsystem</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>                <span class="c1"># subsystems like intel_backlight usually have an acpi_video0</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>                <span class="c1"># counterpart, which we don&#39;t want so lets find the &#39;best&#39; candidate</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/max_brightness&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>                        <span class="c1"># scale for SysFiles is just a multiplier for the set/get brightness values</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>                        <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>                    <span class="c1"># use the display with the highest resolution scale</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>                    <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error getting highest resolution scale for </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">format_exc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>                    <span class="k">continue</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>                <span class="c1"># check if backlight subsystem device matches any of the PCI devices discovered earlier</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>                <span class="c1"># if so, extract the i2c bus from the drm device folder</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>                <span class="n">pci_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/device&#39;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>                <span class="k">if</span> <span class="n">pci_path</span> <span class="ow">in</span> <span class="n">drm_paths</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i2c_bus_from_drm_device</span><span class="p">(</span><span class="n">drm_paths</span><span class="p">[</span><span class="n">pci_path</span><span class="p">])</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">hexdump</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EDID file exists but is empty for display </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>                        <span class="p">(</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">),</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">])</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                    <span class="p">):</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                            <span class="k">continue</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                        <span class="n">device</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="n">displays_by_edid</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">displays_by_edid</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                <span class="n">brightness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">brightness</span> <span class="o">/</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])))</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="k">class</span><span class="w"> </span><span class="nc">I2C</span><span class="p">(</span><span class="n">BrightnessMethod</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    In the same spirit as `SysFiles`, this class serves as a way of getting</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    display information and adjusting the brightness without relying on any</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">    3rd party software.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">    Usage of this class requires read and write permission for `/dev/i2c-*`.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">    This class works over the I2C bus, primarily with desktop monitors as I</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">    haven&#39;t tested any e-DP displays yet.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">    Massive thanks to [siemer](https://github.com/siemer) for</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    his work on the [ddcci.py](https://github.com/siemer/ddcci) project,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    which served as a my main reference for this.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">    References:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        * [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        * [DDCCI Spec](https://milek7.pl/ddcbacklight/ddcci.pdf)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;I2C&#39;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="c1"># vcp commands</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="n">GET_VCP_CMD</span> <span class="o">=</span> <span class="mh">0x01</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP command to get the value of a feature (eg: brightness)&#39;&#39;&#39;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">GET_VCP_REPLY</span> <span class="o">=</span> <span class="mh">0x02</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP feature reply op code&#39;&#39;&#39;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="n">SET_VCP_CMD</span> <span class="o">=</span> <span class="mh">0x03</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP command to set the value of a feature (eg: brightness)&#39;&#39;&#39;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="c1"># addresses</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="n">DDCCI_ADDR</span> <span class="o">=</span> <span class="mh">0x37</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;DDC packets are transmittred using this I2C address&#39;&#39;&#39;</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="n">HOST_ADDR_R</span> <span class="o">=</span> <span class="mh">0x50</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet source address (the computer) when reading data&#39;&#39;&#39;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="n">HOST_ADDR_W</span> <span class="o">=</span> <span class="mh">0x51</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet source address (the computer) when writing data&#39;&#39;&#39;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="n">DESTINATION_ADDR_W</span> <span class="o">=</span> <span class="mh">0x6E</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet destination address (the monitor) when writing data&#39;&#39;&#39;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="n">I2C_SLAVE</span> <span class="o">=</span> <span class="mh">0x0703</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;The I2C slave address&#39;&#39;&#39;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="c1"># timings</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>    <span class="n">WAIT_TIME</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;How long to wait between I2C commands&#39;&#39;&#39;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="n">_max_brightness_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">I2CDevice</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        Class to read and write data to an I2C bus,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        based on the `I2CDev` class from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">            Args:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">                fname: the I2C path, eg: `/dev/i2c-2`</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">                slave_addr: not entirely sure what this is meant to be</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="c1"># I2C_SLAVE address setup</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">I2C_SLAVE</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">            Read a certain number of bytes from the I2C bus</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">            Args:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">                length: the number of bytes to read</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">            Returns:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">                bytes</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">            Writes data to the I2C bus</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            Args:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">                data: the data to write</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">            Returns:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">                The number of bytes written</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DDCInterface</span><span class="p">(</span><span class="n">I2CDevice</span><span class="p">):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        Class to send DDC (Display Data Channel) commands to an I2C device,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        based on the `Ddcci` and `Mccs` classes from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">PROTOCOL_FLAG</span> <span class="o">=</span> <span class="mh">0x80</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2c_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">            Args:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">                i2c_path: the path to the I2C device, eg: `/dev/i2c-2`</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DDCCI_ADDR</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            Write some data to the I2C device.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            It is recommended to use `setvcp` to set VCP values on the DDC device</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            instead of using this function directly.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">            Args:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">                *args: variable length list of arguments. This will be put</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">                    into a `bytearray` and wrapped up in various flags and</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">                    checksums before being written to the I2C device</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">            Returns:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">                The number of bytes that were written</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span>  <span class="c1"># add length info</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_W</span><span class="p">)</span>  <span class="c1"># insert source address</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">))</span>  <span class="c1"># checksum</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">setvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">            Set a VCP value on the device</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a><span class="sd">            Args:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">                vcp_code: the VCP command to send, eg: `0x10` is brightness</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">                value: what to set the value to</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">            Returns:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">                The number of bytes written to the device</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">SET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">))</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">            Reads data from the DDC device.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            It is recommended to use `getvcp` to retrieve VCP values from the</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">            DDC device instead of using this function directly.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">            Args:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">                amount: the number of bytes to read</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">            Raises:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amount</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="c1"># check the bytes read</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                <span class="s1">&#39;source address&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">)</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="p">}</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="k">return</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">getvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">            Retrieves a VCP value from the DDC device.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">            Args:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">                vcp_code: the VCP value to read, eg: `0x10` is brightness</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            Returns:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">                The current and maximum value respectively</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">            Raises:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                <span class="s1">&#39;is feature reply&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_REPLY</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>                <span class="s1">&#39;supported VCP opcode&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                <span class="s1">&#39;answer matches request&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">vcp_code</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="p">}</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="c1"># current and max values</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="n">all_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="k">for</span> <span class="n">i2c_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-*&#39;</span><span class="p">):</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                    <span class="k">continue</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                    <span class="c1"># open the I2C device using the host read address</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                    <span class="n">device</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">I2CDevice</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                    <span class="c1"># read some 512 bytes from the device</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;IOError reading from device </span><span class="si">{</span><span class="n">i2c_path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                    <span class="k">continue</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="c1"># search for the EDID header within our 512 read bytes</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;00 FF FF FF FF FF FF 00&#39;</span><span class="p">))</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                    <span class="k">continue</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                <span class="c1"># grab 128 bytes of the edid</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="n">edid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">128</span><span class="p">]</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                <span class="c1"># parse the EDID</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="n">manufacturer_id</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">serial</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">edid</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                <span class="n">all_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                    <span class="p">{</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                        <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="n">manufacturer</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                        <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="n">manufacturer_id</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                        <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="n">serial</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                        <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                        <span class="c1"># convert edid to hex string</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                        <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edid</span><span class="p">),</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                        <span class="s1">&#39;i2c_bus&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                        <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>                    <span class="p">}</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                <span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="k">if</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">,</span> <span class="n">all_displays</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>            <span class="k">return</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="n">value</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">getvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="c1"># make sure display&#39;s max brighness is cached</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="c1"># if max value is not 100 then we have to adjust the scale to be</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="c1"># a percentage</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="c1"># make sure display brightness max value is cached</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="c1"># scale the brightness value according to the max brightness</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_value</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>            <span class="n">interface</span><span class="o">.</span><span class="n">setvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="k">class</span><span class="w"> </span><span class="nc">XRandr</span><span class="p">(</span><span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">    .. warning:: Deprecated</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">       The XRandr brightness method has been deprecated and will be removed in a future release.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">       XRandr only works on X11, which is starting to be dropped by most distributions.</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">       Furthermore, the xrandr executable doesn&#39;t change backlight brightness like the other methods here,</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">       but changes the gamma instead, making the behaviour inconsistent with the rest of the library.</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    Collection of screen brightness related methods using the xrandr executable</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="n">executable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;xrandr&#39;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;the xrandr executable to be called&#39;&#39;&#39;</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_uid</span><span class="p">(</span><span class="n">interface</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">        Attempts to find a UID (I2C bus path) for a given display interface.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        This works by parsing the interface name and matching it up to the entries in `/sys/class/drm`.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">        `i2c_bus_from_drm_device` is then used to extract the bus number</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        Args:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">            interface: the interface in question. EG: `eDP-1`, `eDP1`, `HDMI-1`...</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">        Returns:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">            The bus number as a string if found. Otherwise, none.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm&#39;</span><span class="p">):</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="c1"># use regex because sometimes it can be `eDP-1` and sometimes it&#39;s `eDP1`</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="k">if</span> <span class="n">interface_match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([a-z]+)-?(\d+)&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">interface</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">interface_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm/&#39;</span><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>            <span class="c1"># use regex here for case insensitivity on the interface</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;card\d+-</span><span class="si">%s</span><span class="s1">(?:-[A-Z])?-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">count</span><span class="p">),</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                <span class="k">continue</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/drm/</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>            <span class="k">if</span> <span class="n">bus</span> <span class="o">:=</span> <span class="n">i2c_bus_from_drm_device</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>                <span class="k">return</span> <span class="n">bus</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_gdi</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        .. warning:: Don&#39;t use this</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">           This function isn&#39;t final and I will probably make breaking changes to it.</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">           You have been warned</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">        Gets all displays reported by XRandr even if they&#39;re not supported</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">xrandr_output</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="n">display_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="n">tmp_display</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="k">for</span> <span class="n">line_index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xrandr_output</span><span class="p">):</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>                <span class="k">continue</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="s1">&#39;connected&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;disconnected&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>                <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>                    <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>                <span class="n">tmp_display</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                    <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>                    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">display_count</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>                    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>                    <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>                    <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>                    <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>                    <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>                    <span class="s1">&#39;unsupported&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;XWAYLAND&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;WAYLAND_DISPLAY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>                    <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_uid</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                <span class="p">}</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                <span class="n">display_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>            <span class="k">elif</span> <span class="s1">&#39;EDID:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="c1"># extract the edid from the chunk of the output that will contain the edid</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                <span class="n">edid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>                    <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrandr_output</span><span class="p">[</span><span class="n">line_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">line_index</span> <span class="o">+</span> <span class="mi">9</span><span class="p">]</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>                <span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edid</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>                    <span class="p">(</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">),</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">])</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>                <span class="p">):</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>                        <span class="k">continue</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="k">elif</span> <span class="s1">&#39;Brightness:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Brightness:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        Implements `BrightnessMethod.get_display_info`.</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">        Args:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">            display: the index of the specific display to query.</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">                If unspecified, all detected displays are queried</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">            brightness: whether to include the current brightness</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">                in the returned info</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                <span class="k">continue</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">brightness</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">])</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">(</span><span class="n">brightness</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="n">brightness</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">]</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">brightness</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="n">value_as_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>            <span class="n">check_output</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">],</span> <span class="s1">&#39;--brightness&#39;</span><span class="p">,</span> <span class="n">value_as_str</span><span class="p">])</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DDCUtil</span><span class="p">(</span><span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;collection of screen brightness related methods using the ddcutil executable&#39;&#39;&#39;</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;DDCUtil&#39;</span><span class="p">)</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>    <span class="n">executable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ddcutil&#39;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;The ddcutil executable to be called&#39;&#39;&#39;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>    <span class="n">sleep_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">    How long ddcutil should sleep between each DDC request (lower is shorter).</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">    See [the ddcutil docs](https://www.ddcutil.com/performance_options/#option-sleep-multiplier).</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="n">cmd_max_tries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Max number of retries when calling the ddcutil&#39;&#39;&#39;</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>    <span class="n">enable_async</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">    Use the `--async` flag when calling ddcutil.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">    See [ddcutil docs](https://www.ddcutil.com/performance_options/#option-async)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>    <span class="n">_max_brightness_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Cache for displays and their maximum brightness values&#39;&#39;&#39;</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_gdi</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">        .. warning:: Don&#39;t use this</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">           This function isn&#39;t final and I will probably make breaking changes to it.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">           You have been warned</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        Gets all displays reported by DDCUtil even if they&#39;re not supported</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="n">raw_ddcutil_output</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="n">check_output</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>                <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;detect&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--async&#39;</span><span class="p">]</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">enable_async</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>                <span class="k">else</span> <span class="p">[],</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>                <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>            <span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="c1"># Use -v to get EDID string but this means output cannot be decoded.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="c1"># Or maybe it can. I don&#39;t know the encoding though, so let&#39;s assume it cannot be decoded.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="c1"># Use str()[2:-1] workaround</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="c1"># include &quot;Invalid display&quot; sections because they tell us where one displays metadata ends</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="c1"># and another begins. We filter out invalid displays later on</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="n">ddcutil_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">raw_ddcutil_output</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;Invalid display&#39;</span><span class="p">,</span> <span class="s1">&#39;Display&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))]</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">tmp_display</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="n">display_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="k">for</span> <span class="n">line_index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ddcutil_output</span><span class="p">):</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)):</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                    <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>                <span class="n">tmp_display</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">display_count</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>                    <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                    <span class="s1">&#39;bin_serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                    <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                    <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                    <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                    <span class="s1">&#39;unsupported&#39;</span><span class="p">:</span> <span class="s1">&#39;invalid display&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                    <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                <span class="p">}</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="n">display_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>            <span class="k">elif</span> <span class="s1">&#39;I2C bus&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>            <span class="k">elif</span> <span class="s1">&#39;Mfg id&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>                <span class="c1"># Recently ddcutil has started reporting manufacturer IDs like</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>                <span class="c1"># &#39;BNQ - UNK&#39; or &#39;MSI - Microstep&#39; so we have to split the line</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>                <span class="c1"># into chunks of alpha chars and check for a valid mfg id</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>                <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Mfg id:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                        <span class="c1"># all mfg ids are 3 chars long</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                        <span class="k">continue</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>                    <span class="k">if</span> <span class="n">brand</span> <span class="o">:=</span> <span class="n">_monitor_brand_lookup</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>                        <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">],</span> <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;manufacturer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brand</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>                        <span class="k">break</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>            <span class="k">elif</span> <span class="s1">&#39;Model&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>                <span class="c1"># the split() removes extra spaces</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Model:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>                    <span class="k">pass</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="k">elif</span> <span class="s1">&#39;Serial number&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Serial number:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>            <span class="k">elif</span> <span class="s1">&#39;Binary serial number:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>            <span class="k">elif</span> <span class="s1">&#39;EDID hex dump:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>                        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="mi">17</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ddcutil_output</span><span class="p">[</span><span class="n">line_index</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">line_index</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>                    <span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                    <span class="k">pass</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>            <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>        <span class="k">if</span> <span class="n">valid_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>                    <span class="k">continue</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>                <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>            <span class="k">if</span> <span class="n">valid_displays</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">,</span> <span class="n">valid_displays</span><span class="p">)</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>                <span class="n">cmd_out</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>                    <span class="n">check_output</span><span class="p">(</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>                        <span class="p">[</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>                            <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>                            <span class="s1">&#39;getvcp&#39;</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>                            <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>                            <span class="s1">&#39;-t&#39;</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>                            <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>                            <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>                        <span class="p">],</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>                        <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>                    <span class="p">)</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>                    <span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>                    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>                <span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>                <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>                    <span class="c1"># if the max brightness is not 100 then the number is not a percentage</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>                    <span class="c1"># and will need to be scaled</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>                <span class="c1"># now make sure max brightness is recorded so set_brightness can use it</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>                <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>                <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="n">__cache__</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">startswith</span><span class="o">=</span><span class="s1">&#39;ddcutil_brightness_&#39;</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>            <span class="c1"># check if monitor has a max brightness that requires us to scale this value</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">])</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="n">check_output</span><span class="p">(</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>                <span class="p">[</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>                    <span class="s1">&#39;setvcp&#39;</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>                    <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>                    <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>                    <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>                <span class="p">],</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>                <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>            <span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a><span class="k">def</span><span class="w"> </span><span class="nf">i2c_bus_from_drm_device</span><span class="p">(</span><span class="nb">dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a><span class="sd">    Extract the relevant I2C bus number from a device in `/sys/class/drm`.</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a><span class="sd">    This function works by searching the directory for `i2c-*` and `ddc/i2c-dev/i2c-*` folders.</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">    Args:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="sd">        dir: the DRM directory, in the format `/sys/class/drm/&lt;device&gt;`</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a><span class="sd">    Returns:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">        Returns the I2C bus number as a string if found. Otherwise, returns None</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>    <span class="c1"># check for enabled file and skip device if monitor inactive</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/enabled&#39;</span><span class="p">):</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/enabled&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;enabled&#39;</span><span class="p">:</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>                <span class="k">return</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>    <span class="c1"># sometimes the i2c path is in /sys/class/drm/*/i2c-*</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>    <span class="c1"># do this first because, in my testing, sometimes a device can have both `.../i2c-X` and `.../ddc/i2c-dev/...`</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="c1"># and the latter is usually the wrong i2c path</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>    <span class="n">paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/i2c-*&#39;</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>    <span class="k">if</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>        <span class="k">return</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>    <span class="c1"># sometimes the i2c path is in /sys/class/drm/*/ddc/i2c-dev</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/ddc/i2c-dev&#39;</span><span class="p">):</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>        <span class="n">paths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/ddc/i2c-dev&#39;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>        <span class="k">if</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>            <span class="k">return</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;i2c-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="k">def</span><span class="w"> </span><span class="nf">list_monitors_info</span><span class="p">(</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>    <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">unsupported</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a><span class="sd">    Lists detailed information about all detected displays</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a><span class="sd">    Args:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a><span class="sd">        method: the method the display can be addressed by. See `.get_methods`</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a><span class="sd">            for more info on available methods</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="sd">        allow_duplicates: whether to filter out duplicate displays (displays with the same EDID) or not</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="sd">        unsupported: include detected displays that are invalid or unsupported</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>    <span class="n">all_methods</span> <span class="o">=</span> <span class="n">get_methods</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>    <span class="n">haystack</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>    <span class="k">for</span> <span class="n">method_class</span> <span class="ow">in</span> <span class="n">all_methods</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>            <span class="k">if</span> <span class="n">unsupported</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">method_class</span><span class="p">,</span> <span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>                <span class="n">haystack</span> <span class="o">+=</span> <span class="n">method_class</span><span class="o">.</span><span class="n">_gdi</span><span class="p">()</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>                <span class="n">haystack</span> <span class="o">+=</span> <span class="n">method_class</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a>            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error grabbing display info from </span><span class="si">{</span><span class="n">method_class</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">format_exc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a>            <span class="k">pass</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a>    <span class="k">if</span> <span class="n">allow_duplicates</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a>        <span class="k">return</span> <span class="n">haystack</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a>        <span class="c1"># use filter_monitors to remove duplicates</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>        <span class="k">return</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">haystack</span><span class="o">=</span><span class="n">haystack</span><span class="p">)</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a>    <span class="k">except</span> <span class="n">NoValidDisplayError</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a><span class="n">METHODS</span> <span class="o">=</span> <span class="p">(</span><span class="n">SysFiles</span><span class="p">,</span> <span class="n">I2C</span><span class="p">,</span> <span class="n">XRandr</span><span class="p">,</span> <span class="n">DDCUtil</span><span class="p">)</span>
</span></pre></div>


        <br />

    </section>
                <section id="SysFiles">
                            <input id="SysFiles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SysFiles</span><wbr>(<span class="base"><a href="helpers.html#BrightnessMethod">screen_brightness_control.helpers.BrightnessMethod</a></span>):

                <label class="view-source-button" for="SysFiles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SysFiles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SysFiles-22"><a href="#SysFiles-22"><span class="linenos"> 22</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SysFiles</span><span class="p">(</span><span class="n">BrightnessMethod</span><span class="p">):</span>
</span><span id="SysFiles-23"><a href="#SysFiles-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="SysFiles-24"><a href="#SysFiles-24"><span class="linenos"> 24</span></a><span class="sd">    A way of getting display information and adjusting the brightness</span>
</span><span id="SysFiles-25"><a href="#SysFiles-25"><span class="linenos"> 25</span></a><span class="sd">    that does not rely on any 3rd party software.</span>
</span><span id="SysFiles-26"><a href="#SysFiles-26"><span class="linenos"> 26</span></a>
</span><span id="SysFiles-27"><a href="#SysFiles-27"><span class="linenos"> 27</span></a><span class="sd">    This class works with displays that show up in the `/sys/class/backlight`</span>
</span><span id="SysFiles-28"><a href="#SysFiles-28"><span class="linenos"> 28</span></a><span class="sd">    directory (so usually laptop displays).</span>
</span><span id="SysFiles-29"><a href="#SysFiles-29"><span class="linenos"> 29</span></a>
</span><span id="SysFiles-30"><a href="#SysFiles-30"><span class="linenos"> 30</span></a><span class="sd">    To set the brightness, your user will need write permissions for</span>
</span><span id="SysFiles-31"><a href="#SysFiles-31"><span class="linenos"> 31</span></a><span class="sd">    `/sys/class/backlight/*/brightness` or you will need to run the program</span>
</span><span id="SysFiles-32"><a href="#SysFiles-32"><span class="linenos"> 32</span></a><span class="sd">    as root.</span>
</span><span id="SysFiles-33"><a href="#SysFiles-33"><span class="linenos"> 33</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="SysFiles-34"><a href="#SysFiles-34"><span class="linenos"> 34</span></a>
</span><span id="SysFiles-35"><a href="#SysFiles-35"><span class="linenos"> 35</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;SysFiles&#39;</span><span class="p">)</span>
</span><span id="SysFiles-36"><a href="#SysFiles-36"><span class="linenos"> 36</span></a>
</span><span id="SysFiles-37"><a href="#SysFiles-37"><span class="linenos"> 37</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles-38"><a href="#SysFiles-38"><span class="linenos"> 38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="SysFiles-39"><a href="#SysFiles-39"><span class="linenos"> 39</span></a>        <span class="n">subsystems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SysFiles-40"><a href="#SysFiles-40"><span class="linenos"> 40</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/backlight&#39;</span><span class="p">):</span>
</span><span id="SysFiles-41"><a href="#SysFiles-41"><span class="linenos"> 41</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">):</span>
</span><span id="SysFiles-42"><a href="#SysFiles-42"><span class="linenos"> 42</span></a>                <span class="n">subsystems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">)))</span>
</span><span id="SysFiles-43"><a href="#SysFiles-43"><span class="linenos"> 43</span></a>
</span><span id="SysFiles-44"><a href="#SysFiles-44"><span class="linenos"> 44</span></a>        <span class="n">displays_by_edid</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SysFiles-45"><a href="#SysFiles-45"><span class="linenos"> 45</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SysFiles-46"><a href="#SysFiles-46"><span class="linenos"> 46</span></a>
</span><span id="SysFiles-47"><a href="#SysFiles-47"><span class="linenos"> 47</span></a>        <span class="c1"># map drm devices to their pci device paths</span>
</span><span id="SysFiles-48"><a href="#SysFiles-48"><span class="linenos"> 48</span></a>        <span class="n">drm_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SysFiles-49"><a href="#SysFiles-49"><span class="linenos"> 49</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm/card*-*&#39;</span><span class="p">):</span>
</span><span id="SysFiles-50"><a href="#SysFiles-50"><span class="linenos"> 50</span></a>            <span class="n">drm_paths</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="SysFiles-51"><a href="#SysFiles-51"><span class="linenos"> 51</span></a>
</span><span id="SysFiles-52"><a href="#SysFiles-52"><span class="linenos"> 52</span></a>        <span class="k">for</span> <span class="n">subsystem</span> <span class="ow">in</span> <span class="n">subsystems</span><span class="p">:</span>
</span><span id="SysFiles-53"><a href="#SysFiles-53"><span class="linenos"> 53</span></a>            <span class="n">device</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SysFiles-54"><a href="#SysFiles-54"><span class="linenos"> 54</span></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="SysFiles-55"><a href="#SysFiles-55"><span class="linenos"> 55</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="SysFiles-56"><a href="#SysFiles-56"><span class="linenos"> 56</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="SysFiles-57"><a href="#SysFiles-57"><span class="linenos"> 57</span></a>                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="SysFiles-58"><a href="#SysFiles-58"><span class="linenos"> 58</span></a>                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-59"><a href="#SysFiles-59"><span class="linenos"> 59</span></a>                <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-60"><a href="#SysFiles-60"><span class="linenos"> 60</span></a>                <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-61"><a href="#SysFiles-61"><span class="linenos"> 61</span></a>                <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-62"><a href="#SysFiles-62"><span class="linenos"> 62</span></a>                <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-63"><a href="#SysFiles-63"><span class="linenos"> 63</span></a>                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-64"><a href="#SysFiles-64"><span class="linenos"> 64</span></a>                <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles-65"><a href="#SysFiles-65"><span class="linenos"> 65</span></a>            <span class="p">}</span>
</span><span id="SysFiles-66"><a href="#SysFiles-66"><span class="linenos"> 66</span></a>
</span><span id="SysFiles-67"><a href="#SysFiles-67"><span class="linenos"> 67</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subsystem</span><span class="p">:</span>
</span><span id="SysFiles-68"><a href="#SysFiles-68"><span class="linenos"> 68</span></a>                <span class="c1"># subsystems like intel_backlight usually have an acpi_video0</span>
</span><span id="SysFiles-69"><a href="#SysFiles-69"><span class="linenos"> 69</span></a>                <span class="c1"># counterpart, which we don&#39;t want so lets find the &#39;best&#39; candidate</span>
</span><span id="SysFiles-70"><a href="#SysFiles-70"><span class="linenos"> 70</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SysFiles-71"><a href="#SysFiles-71"><span class="linenos"> 71</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/max_brightness&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles-72"><a href="#SysFiles-72"><span class="linenos"> 72</span></a>                        <span class="c1"># scale for SysFiles is just a multiplier for the set/get brightness values</span>
</span><span id="SysFiles-73"><a href="#SysFiles-73"><span class="linenos"> 73</span></a>                        <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="SysFiles-74"><a href="#SysFiles-74"><span class="linenos"> 74</span></a>
</span><span id="SysFiles-75"><a href="#SysFiles-75"><span class="linenos"> 75</span></a>                    <span class="c1"># use the display with the highest resolution scale</span>
</span><span id="SysFiles-76"><a href="#SysFiles-76"><span class="linenos"> 76</span></a>                    <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]:</span>
</span><span id="SysFiles-77"><a href="#SysFiles-77"><span class="linenos"> 77</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="SysFiles-78"><a href="#SysFiles-78"><span class="linenos"> 78</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SysFiles-79"><a href="#SysFiles-79"><span class="linenos"> 79</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="SysFiles-80"><a href="#SysFiles-80"><span class="linenos"> 80</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SysFiles-81"><a href="#SysFiles-81"><span class="linenos"> 81</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error getting highest resolution scale for </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">format_exc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="SysFiles-82"><a href="#SysFiles-82"><span class="linenos"> 82</span></a>                    <span class="k">continue</span>
</span><span id="SysFiles-83"><a href="#SysFiles-83"><span class="linenos"> 83</span></a>
</span><span id="SysFiles-84"><a href="#SysFiles-84"><span class="linenos"> 84</span></a>                <span class="c1"># check if backlight subsystem device matches any of the PCI devices discovered earlier</span>
</span><span id="SysFiles-85"><a href="#SysFiles-85"><span class="linenos"> 85</span></a>                <span class="c1"># if so, extract the i2c bus from the drm device folder</span>
</span><span id="SysFiles-86"><a href="#SysFiles-86"><span class="linenos"> 86</span></a>                <span class="n">pci_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/device&#39;</span><span class="p">)</span>
</span><span id="SysFiles-87"><a href="#SysFiles-87"><span class="linenos"> 87</span></a>                <span class="k">if</span> <span class="n">pci_path</span> <span class="ow">in</span> <span class="n">drm_paths</span><span class="p">:</span>
</span><span id="SysFiles-88"><a href="#SysFiles-88"><span class="linenos"> 88</span></a>                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i2c_bus_from_drm_device</span><span class="p">(</span><span class="n">drm_paths</span><span class="p">[</span><span class="n">pci_path</span><span class="p">])</span>
</span><span id="SysFiles-89"><a href="#SysFiles-89"><span class="linenos"> 89</span></a>
</span><span id="SysFiles-90"><a href="#SysFiles-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]):</span>
</span><span id="SysFiles-91"><a href="#SysFiles-91"><span class="linenos"> 91</span></a>                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">hexdump</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="SysFiles-92"><a href="#SysFiles-92"><span class="linenos"> 92</span></a>
</span><span id="SysFiles-93"><a href="#SysFiles-93"><span class="linenos"> 93</span></a>                <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles-94"><a href="#SysFiles-94"><span class="linenos"> 94</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EDID file exists but is empty for display </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="SysFiles-95"><a href="#SysFiles-95"><span class="linenos"> 95</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SysFiles-96"><a href="#SysFiles-96"><span class="linenos"> 96</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SysFiles-97"><a href="#SysFiles-97"><span class="linenos"> 97</span></a>                        <span class="p">(</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">),</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">])</span>
</span><span id="SysFiles-98"><a href="#SysFiles-98"><span class="linenos"> 98</span></a>                    <span class="p">):</span>
</span><span id="SysFiles-99"><a href="#SysFiles-99"><span class="linenos"> 99</span></a>                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles-100"><a href="#SysFiles-100"><span class="linenos">100</span></a>                            <span class="k">continue</span>
</span><span id="SysFiles-101"><a href="#SysFiles-101"><span class="linenos">101</span></a>                        <span class="n">device</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="SysFiles-102"><a href="#SysFiles-102"><span class="linenos">102</span></a>
</span><span id="SysFiles-103"><a href="#SysFiles-103"><span class="linenos">103</span></a>            <span class="n">displays_by_edid</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="SysFiles-104"><a href="#SysFiles-104"><span class="linenos">104</span></a>            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SysFiles-105"><a href="#SysFiles-105"><span class="linenos">105</span></a>
</span><span id="SysFiles-106"><a href="#SysFiles-106"><span class="linenos">106</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">displays_by_edid</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="SysFiles-107"><a href="#SysFiles-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles-108"><a href="#SysFiles-108"><span class="linenos">108</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
</span><span id="SysFiles-109"><a href="#SysFiles-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span><span id="SysFiles-110"><a href="#SysFiles-110"><span class="linenos">110</span></a>
</span><span id="SysFiles-111"><a href="#SysFiles-111"><span class="linenos">111</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles-112"><a href="#SysFiles-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="SysFiles-113"><a href="#SysFiles-113"><span class="linenos">113</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="SysFiles-114"><a href="#SysFiles-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles-115"><a href="#SysFiles-115"><span class="linenos">115</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="SysFiles-116"><a href="#SysFiles-116"><span class="linenos">116</span></a>
</span><span id="SysFiles-117"><a href="#SysFiles-117"><span class="linenos">117</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SysFiles-118"><a href="#SysFiles-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="SysFiles-119"><a href="#SysFiles-119"><span class="linenos">119</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles-120"><a href="#SysFiles-120"><span class="linenos">120</span></a>                <span class="n">brightness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
</span><span id="SysFiles-121"><a href="#SysFiles-121"><span class="linenos">121</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">brightness</span> <span class="o">/</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span>
</span><span id="SysFiles-122"><a href="#SysFiles-122"><span class="linenos">122</span></a>
</span><span id="SysFiles-123"><a href="#SysFiles-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="SysFiles-124"><a href="#SysFiles-124"><span class="linenos">124</span></a>
</span><span id="SysFiles-125"><a href="#SysFiles-125"><span class="linenos">125</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles-126"><a href="#SysFiles-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SysFiles-127"><a href="#SysFiles-127"><span class="linenos">127</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="SysFiles-128"><a href="#SysFiles-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles-129"><a href="#SysFiles-129"><span class="linenos">129</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="SysFiles-130"><a href="#SysFiles-130"><span class="linenos">130</span></a>
</span><span id="SysFiles-131"><a href="#SysFiles-131"><span class="linenos">131</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="SysFiles-132"><a href="#SysFiles-132"><span class="linenos">132</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles-133"><a href="#SysFiles-133"><span class="linenos">133</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])))</span>
</span></pre></div>


            <div class="docstring"><p>A way of getting display information and adjusting the brightness
that does not rely on any 3rd party software.</p>

<p>This class works with displays that show up in the <code>/sys/class/backlight</code>
directory (so usually laptop displays).</p>

<p>To set the brightness, your user will need write permissions for
<code>/sys/class/backlight/*/brightness</code> or you will need to run the program
as root.</p>
</div>


                            <div id="SysFiles.get_display_info" class="classattr">
                                        <input id="SysFiles.get_display_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_display_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SysFiles.get_display_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SysFiles.get_display_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SysFiles.get_display_info-37"><a href="#SysFiles.get_display_info-37"><span class="linenos"> 37</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles.get_display_info-38"><a href="#SysFiles.get_display_info-38"><span class="linenos"> 38</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="SysFiles.get_display_info-39"><a href="#SysFiles.get_display_info-39"><span class="linenos"> 39</span></a>        <span class="n">subsystems</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SysFiles.get_display_info-40"><a href="#SysFiles.get_display_info-40"><span class="linenos"> 40</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/backlight&#39;</span><span class="p">):</span>
</span><span id="SysFiles.get_display_info-41"><a href="#SysFiles.get_display_info-41"><span class="linenos"> 41</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">):</span>
</span><span id="SysFiles.get_display_info-42"><a href="#SysFiles.get_display_info-42"><span class="linenos"> 42</span></a>                <span class="n">subsystems</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/subsystem&#39;</span><span class="p">)))</span>
</span><span id="SysFiles.get_display_info-43"><a href="#SysFiles.get_display_info-43"><span class="linenos"> 43</span></a>
</span><span id="SysFiles.get_display_info-44"><a href="#SysFiles.get_display_info-44"><span class="linenos"> 44</span></a>        <span class="n">displays_by_edid</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SysFiles.get_display_info-45"><a href="#SysFiles.get_display_info-45"><span class="linenos"> 45</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="SysFiles.get_display_info-46"><a href="#SysFiles.get_display_info-46"><span class="linenos"> 46</span></a>
</span><span id="SysFiles.get_display_info-47"><a href="#SysFiles.get_display_info-47"><span class="linenos"> 47</span></a>        <span class="c1"># map drm devices to their pci device paths</span>
</span><span id="SysFiles.get_display_info-48"><a href="#SysFiles.get_display_info-48"><span class="linenos"> 48</span></a>        <span class="n">drm_paths</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SysFiles.get_display_info-49"><a href="#SysFiles.get_display_info-49"><span class="linenos"> 49</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm/card*-*&#39;</span><span class="p">):</span>
</span><span id="SysFiles.get_display_info-50"><a href="#SysFiles.get_display_info-50"><span class="linenos"> 50</span></a>            <span class="n">drm_paths</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="SysFiles.get_display_info-51"><a href="#SysFiles.get_display_info-51"><span class="linenos"> 51</span></a>
</span><span id="SysFiles.get_display_info-52"><a href="#SysFiles.get_display_info-52"><span class="linenos"> 52</span></a>        <span class="k">for</span> <span class="n">subsystem</span> <span class="ow">in</span> <span class="n">subsystems</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-53"><a href="#SysFiles.get_display_info-53"><span class="linenos"> 53</span></a>            <span class="n">device</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="SysFiles.get_display_info-54"><a href="#SysFiles.get_display_info-54"><span class="linenos"> 54</span></a>                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="SysFiles.get_display_info-55"><a href="#SysFiles.get_display_info-55"><span class="linenos"> 55</span></a>                <span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">subsystem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-56"><a href="#SysFiles.get_display_info-56"><span class="linenos"> 56</span></a>                <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-57"><a href="#SysFiles.get_display_info-57"><span class="linenos"> 57</span></a>                <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-58"><a href="#SysFiles.get_display_info-58"><span class="linenos"> 58</span></a>                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-59"><a href="#SysFiles.get_display_info-59"><span class="linenos"> 59</span></a>                <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-60"><a href="#SysFiles.get_display_info-60"><span class="linenos"> 60</span></a>                <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-61"><a href="#SysFiles.get_display_info-61"><span class="linenos"> 61</span></a>                <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-62"><a href="#SysFiles.get_display_info-62"><span class="linenos"> 62</span></a>                <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-63"><a href="#SysFiles.get_display_info-63"><span class="linenos"> 63</span></a>                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-64"><a href="#SysFiles.get_display_info-64"><span class="linenos"> 64</span></a>                <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SysFiles.get_display_info-65"><a href="#SysFiles.get_display_info-65"><span class="linenos"> 65</span></a>            <span class="p">}</span>
</span><span id="SysFiles.get_display_info-66"><a href="#SysFiles.get_display_info-66"><span class="linenos"> 66</span></a>
</span><span id="SysFiles.get_display_info-67"><a href="#SysFiles.get_display_info-67"><span class="linenos"> 67</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">subsystem</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-68"><a href="#SysFiles.get_display_info-68"><span class="linenos"> 68</span></a>                <span class="c1"># subsystems like intel_backlight usually have an acpi_video0</span>
</span><span id="SysFiles.get_display_info-69"><a href="#SysFiles.get_display_info-69"><span class="linenos"> 69</span></a>                <span class="c1"># counterpart, which we don&#39;t want so lets find the &#39;best&#39; candidate</span>
</span><span id="SysFiles.get_display_info-70"><a href="#SysFiles.get_display_info-70"><span class="linenos"> 70</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-71"><a href="#SysFiles.get_display_info-71"><span class="linenos"> 71</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/max_brightness&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-72"><a href="#SysFiles.get_display_info-72"><span class="linenos"> 72</span></a>                        <span class="c1"># scale for SysFiles is just a multiplier for the set/get brightness values</span>
</span><span id="SysFiles.get_display_info-73"><a href="#SysFiles.get_display_info-73"><span class="linenos"> 73</span></a>                        <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">100</span>
</span><span id="SysFiles.get_display_info-74"><a href="#SysFiles.get_display_info-74"><span class="linenos"> 74</span></a>
</span><span id="SysFiles.get_display_info-75"><a href="#SysFiles.get_display_info-75"><span class="linenos"> 75</span></a>                    <span class="c1"># use the display with the highest resolution scale</span>
</span><span id="SysFiles.get_display_info-76"><a href="#SysFiles.get_display_info-76"><span class="linenos"> 76</span></a>                    <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]:</span>
</span><span id="SysFiles.get_display_info-77"><a href="#SysFiles.get_display_info-77"><span class="linenos"> 77</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder</span>
</span><span id="SysFiles.get_display_info-78"><a href="#SysFiles.get_display_info-78"><span class="linenos"> 78</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="SysFiles.get_display_info-79"><a href="#SysFiles.get_display_info-79"><span class="linenos"> 79</span></a>                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span>
</span><span id="SysFiles.get_display_info-80"><a href="#SysFiles.get_display_info-80"><span class="linenos"> 80</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-81"><a href="#SysFiles.get_display_info-81"><span class="linenos"> 81</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error getting highest resolution scale for </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">format_exc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="SysFiles.get_display_info-82"><a href="#SysFiles.get_display_info-82"><span class="linenos"> 82</span></a>                    <span class="k">continue</span>
</span><span id="SysFiles.get_display_info-83"><a href="#SysFiles.get_display_info-83"><span class="linenos"> 83</span></a>
</span><span id="SysFiles.get_display_info-84"><a href="#SysFiles.get_display_info-84"><span class="linenos"> 84</span></a>                <span class="c1"># check if backlight subsystem device matches any of the PCI devices discovered earlier</span>
</span><span id="SysFiles.get_display_info-85"><a href="#SysFiles.get_display_info-85"><span class="linenos"> 85</span></a>                <span class="c1"># if so, extract the i2c bus from the drm device folder</span>
</span><span id="SysFiles.get_display_info-86"><a href="#SysFiles.get_display_info-86"><span class="linenos"> 86</span></a>                <span class="n">pci_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;/sys/class/backlight/</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">/device&#39;</span><span class="p">)</span>
</span><span id="SysFiles.get_display_info-87"><a href="#SysFiles.get_display_info-87"><span class="linenos"> 87</span></a>                <span class="k">if</span> <span class="n">pci_path</span> <span class="ow">in</span> <span class="n">drm_paths</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-88"><a href="#SysFiles.get_display_info-88"><span class="linenos"> 88</span></a>                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">i2c_bus_from_drm_device</span><span class="p">(</span><span class="n">drm_paths</span><span class="p">[</span><span class="n">pci_path</span><span class="p">])</span>
</span><span id="SysFiles.get_display_info-89"><a href="#SysFiles.get_display_info-89"><span class="linenos"> 89</span></a>
</span><span id="SysFiles.get_display_info-90"><a href="#SysFiles.get_display_info-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]):</span>
</span><span id="SysFiles.get_display_info-91"><a href="#SysFiles.get_display_info-91"><span class="linenos"> 91</span></a>                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">hexdump</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/device/edid&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="SysFiles.get_display_info-92"><a href="#SysFiles.get_display_info-92"><span class="linenos"> 92</span></a>
</span><span id="SysFiles.get_display_info-93"><a href="#SysFiles.get_display_info-93"><span class="linenos"> 93</span></a>                <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-94"><a href="#SysFiles.get_display_info-94"><span class="linenos"> 94</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EDID file exists but is empty for display </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="SysFiles.get_display_info-95"><a href="#SysFiles.get_display_info-95"><span class="linenos"> 95</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-96"><a href="#SysFiles.get_display_info-96"><span class="linenos"> 96</span></a>                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="SysFiles.get_display_info-97"><a href="#SysFiles.get_display_info-97"><span class="linenos"> 97</span></a>                        <span class="p">(</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">),</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">])</span>
</span><span id="SysFiles.get_display_info-98"><a href="#SysFiles.get_display_info-98"><span class="linenos"> 98</span></a>                    <span class="p">):</span>
</span><span id="SysFiles.get_display_info-99"><a href="#SysFiles.get_display_info-99"><span class="linenos"> 99</span></a>                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-100"><a href="#SysFiles.get_display_info-100"><span class="linenos">100</span></a>                            <span class="k">continue</span>
</span><span id="SysFiles.get_display_info-101"><a href="#SysFiles.get_display_info-101"><span class="linenos">101</span></a>                        <span class="n">device</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="SysFiles.get_display_info-102"><a href="#SysFiles.get_display_info-102"><span class="linenos">102</span></a>
</span><span id="SysFiles.get_display_info-103"><a href="#SysFiles.get_display_info-103"><span class="linenos">103</span></a>            <span class="n">displays_by_edid</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="SysFiles.get_display_info-104"><a href="#SysFiles.get_display_info-104"><span class="linenos">104</span></a>            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="SysFiles.get_display_info-105"><a href="#SysFiles.get_display_info-105"><span class="linenos">105</span></a>
</span><span id="SysFiles.get_display_info-106"><a href="#SysFiles.get_display_info-106"><span class="linenos">106</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">displays_by_edid</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="SysFiles.get_display_info-107"><a href="#SysFiles.get_display_info-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles.get_display_info-108"><a href="#SysFiles.get_display_info-108"><span class="linenos">108</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
</span><span id="SysFiles.get_display_info-109"><a href="#SysFiles.get_display_info-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span></pre></div>


            <div class="docstring"><p>Return information about detected displays.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display (<a href="types.html#DisplayIdentifier">screen_brightness_control.types.DisplayIdentifier</a>):</strong>  the specific display to return
information about. This parameter is passed to <code>filter_monitors</code></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of dictionaries, each representing a detected display.
  Each returned dictionary will have the following keys:</p>
  
  <ul>
  <li>name (<code>str</code>): the name of the display</li>
  <li>model (<code>str</code>): the model of the display</li>
  <li>manufacturer (<code>str</code>): the name of the display manufacturer</li>
  <li>manufacturer_id (<code>str</code>): the three letter manufacturer code (see <code>MONITOR_MANUFACTURER_CODES</code>)</li>
  <li>serial (<code>str</code>): the serial of the display OR some other unique identifier</li>
  <li>edid (<code>str</code>): the EDID string for the display</li>
  <li>method (<code>BrightnessMethod</code>): the brightness method associated with this display</li>
  <li>index (<code>int</code>): the index of the display, relative to the brightness method</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="SysFiles.get_brightness" class="classattr">
                                        <input id="SysFiles.get_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SysFiles.get_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SysFiles.get_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SysFiles.get_brightness-111"><a href="#SysFiles.get_brightness-111"><span class="linenos">111</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles.get_brightness-112"><a href="#SysFiles.get_brightness-112"><span class="linenos">112</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="SysFiles.get_brightness-113"><a href="#SysFiles.get_brightness-113"><span class="linenos">113</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="SysFiles.get_brightness-114"><a href="#SysFiles.get_brightness-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles.get_brightness-115"><a href="#SysFiles.get_brightness-115"><span class="linenos">115</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="SysFiles.get_brightness-116"><a href="#SysFiles.get_brightness-116"><span class="linenos">116</span></a>
</span><span id="SysFiles.get_brightness-117"><a href="#SysFiles.get_brightness-117"><span class="linenos">117</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SysFiles.get_brightness-118"><a href="#SysFiles.get_brightness-118"><span class="linenos">118</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="SysFiles.get_brightness-119"><a href="#SysFiles.get_brightness-119"><span class="linenos">119</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles.get_brightness-120"><a href="#SysFiles.get_brightness-120"><span class="linenos">120</span></a>                <span class="n">brightness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span>
</span><span id="SysFiles.get_brightness-121"><a href="#SysFiles.get_brightness-121"><span class="linenos">121</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">brightness</span> <span class="o">/</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]))</span>
</span><span id="SysFiles.get_brightness-122"><a href="#SysFiles.get_brightness-122"><span class="linenos">122</span></a>
</span><span id="SysFiles.get_brightness-123"><a href="#SysFiles.get_brightness-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display:</strong>  the index of the specific display to query.
If unspecified, all detected displays are queried</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of <code><a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a></code> values, one for each
  queried display</p>
</blockquote>
</div>


                            </div>
                            <div id="SysFiles.set_brightness" class="classattr">
                                        <input id="SysFiles.set_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">set_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SysFiles.set_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SysFiles.set_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SysFiles.set_brightness-125"><a href="#SysFiles.set_brightness-125"><span class="linenos">125</span></a>    <span class="nd">@classmethod</span>
</span><span id="SysFiles.set_brightness-126"><a href="#SysFiles.set_brightness-126"><span class="linenos">126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SysFiles.set_brightness-127"><a href="#SysFiles.set_brightness-127"><span class="linenos">127</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="SysFiles.set_brightness-128"><a href="#SysFiles.set_brightness-128"><span class="linenos">128</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SysFiles.set_brightness-129"><a href="#SysFiles.set_brightness-129"><span class="linenos">129</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="SysFiles.set_brightness-130"><a href="#SysFiles.set_brightness-130"><span class="linenos">130</span></a>
</span><span id="SysFiles.set_brightness-131"><a href="#SysFiles.set_brightness-131"><span class="linenos">131</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="SysFiles.set_brightness-132"><a href="#SysFiles.set_brightness-132"><span class="linenos">132</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="s1">&#39;brightness&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SysFiles.set_brightness-133"><a href="#SysFiles.set_brightness-133"><span class="linenos">133</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])))</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>value (<a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a>):</strong>  the new brightness value</li>
<li><strong>display:</strong>  the index of the specific display to adjust.
If unspecified, all detected displays are adjusted</li>
</ul>
</div>


                            </div>
                </section>
                <section id="I2C">
                            <input id="I2C-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">I2C</span><wbr>(<span class="base"><a href="helpers.html#BrightnessMethod">screen_brightness_control.helpers.BrightnessMethod</a></span>):

                <label class="view-source-button" for="I2C-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C-136"><a href="#I2C-136"><span class="linenos">136</span></a><span class="k">class</span><span class="w"> </span><span class="nc">I2C</span><span class="p">(</span><span class="n">BrightnessMethod</span><span class="p">):</span>
</span><span id="I2C-137"><a href="#I2C-137"><span class="linenos">137</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-138"><a href="#I2C-138"><span class="linenos">138</span></a><span class="sd">    In the same spirit as `SysFiles`, this class serves as a way of getting</span>
</span><span id="I2C-139"><a href="#I2C-139"><span class="linenos">139</span></a><span class="sd">    display information and adjusting the brightness without relying on any</span>
</span><span id="I2C-140"><a href="#I2C-140"><span class="linenos">140</span></a><span class="sd">    3rd party software.</span>
</span><span id="I2C-141"><a href="#I2C-141"><span class="linenos">141</span></a>
</span><span id="I2C-142"><a href="#I2C-142"><span class="linenos">142</span></a><span class="sd">    Usage of this class requires read and write permission for `/dev/i2c-*`.</span>
</span><span id="I2C-143"><a href="#I2C-143"><span class="linenos">143</span></a>
</span><span id="I2C-144"><a href="#I2C-144"><span class="linenos">144</span></a><span class="sd">    This class works over the I2C bus, primarily with desktop monitors as I</span>
</span><span id="I2C-145"><a href="#I2C-145"><span class="linenos">145</span></a><span class="sd">    haven&#39;t tested any e-DP displays yet.</span>
</span><span id="I2C-146"><a href="#I2C-146"><span class="linenos">146</span></a>
</span><span id="I2C-147"><a href="#I2C-147"><span class="linenos">147</span></a><span class="sd">    Massive thanks to [siemer](https://github.com/siemer) for</span>
</span><span id="I2C-148"><a href="#I2C-148"><span class="linenos">148</span></a><span class="sd">    his work on the [ddcci.py](https://github.com/siemer/ddcci) project,</span>
</span><span id="I2C-149"><a href="#I2C-149"><span class="linenos">149</span></a><span class="sd">    which served as a my main reference for this.</span>
</span><span id="I2C-150"><a href="#I2C-150"><span class="linenos">150</span></a>
</span><span id="I2C-151"><a href="#I2C-151"><span class="linenos">151</span></a><span class="sd">    References:</span>
</span><span id="I2C-152"><a href="#I2C-152"><span class="linenos">152</span></a><span class="sd">        * [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="I2C-153"><a href="#I2C-153"><span class="linenos">153</span></a><span class="sd">        * [DDCCI Spec](https://milek7.pl/ddcbacklight/ddcci.pdf)</span>
</span><span id="I2C-154"><a href="#I2C-154"><span class="linenos">154</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="I2C-155"><a href="#I2C-155"><span class="linenos">155</span></a>
</span><span id="I2C-156"><a href="#I2C-156"><span class="linenos">156</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;I2C&#39;</span><span class="p">)</span>
</span><span id="I2C-157"><a href="#I2C-157"><span class="linenos">157</span></a>
</span><span id="I2C-158"><a href="#I2C-158"><span class="linenos">158</span></a>    <span class="c1"># vcp commands</span>
</span><span id="I2C-159"><a href="#I2C-159"><span class="linenos">159</span></a>    <span class="n">GET_VCP_CMD</span> <span class="o">=</span> <span class="mh">0x01</span>
</span><span id="I2C-160"><a href="#I2C-160"><span class="linenos">160</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP command to get the value of a feature (eg: brightness)&#39;&#39;&#39;</span>
</span><span id="I2C-161"><a href="#I2C-161"><span class="linenos">161</span></a>    <span class="n">GET_VCP_REPLY</span> <span class="o">=</span> <span class="mh">0x02</span>
</span><span id="I2C-162"><a href="#I2C-162"><span class="linenos">162</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP feature reply op code&#39;&#39;&#39;</span>
</span><span id="I2C-163"><a href="#I2C-163"><span class="linenos">163</span></a>    <span class="n">SET_VCP_CMD</span> <span class="o">=</span> <span class="mh">0x03</span>
</span><span id="I2C-164"><a href="#I2C-164"><span class="linenos">164</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;VCP command to set the value of a feature (eg: brightness)&#39;&#39;&#39;</span>
</span><span id="I2C-165"><a href="#I2C-165"><span class="linenos">165</span></a>
</span><span id="I2C-166"><a href="#I2C-166"><span class="linenos">166</span></a>    <span class="c1"># addresses</span>
</span><span id="I2C-167"><a href="#I2C-167"><span class="linenos">167</span></a>    <span class="n">DDCCI_ADDR</span> <span class="o">=</span> <span class="mh">0x37</span>
</span><span id="I2C-168"><a href="#I2C-168"><span class="linenos">168</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;DDC packets are transmittred using this I2C address&#39;&#39;&#39;</span>
</span><span id="I2C-169"><a href="#I2C-169"><span class="linenos">169</span></a>    <span class="n">HOST_ADDR_R</span> <span class="o">=</span> <span class="mh">0x50</span>
</span><span id="I2C-170"><a href="#I2C-170"><span class="linenos">170</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet source address (the computer) when reading data&#39;&#39;&#39;</span>
</span><span id="I2C-171"><a href="#I2C-171"><span class="linenos">171</span></a>    <span class="n">HOST_ADDR_W</span> <span class="o">=</span> <span class="mh">0x51</span>
</span><span id="I2C-172"><a href="#I2C-172"><span class="linenos">172</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet source address (the computer) when writing data&#39;&#39;&#39;</span>
</span><span id="I2C-173"><a href="#I2C-173"><span class="linenos">173</span></a>    <span class="n">DESTINATION_ADDR_W</span> <span class="o">=</span> <span class="mh">0x6E</span>
</span><span id="I2C-174"><a href="#I2C-174"><span class="linenos">174</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Packet destination address (the monitor) when writing data&#39;&#39;&#39;</span>
</span><span id="I2C-175"><a href="#I2C-175"><span class="linenos">175</span></a>    <span class="n">I2C_SLAVE</span> <span class="o">=</span> <span class="mh">0x0703</span>
</span><span id="I2C-176"><a href="#I2C-176"><span class="linenos">176</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;The I2C slave address&#39;&#39;&#39;</span>
</span><span id="I2C-177"><a href="#I2C-177"><span class="linenos">177</span></a>
</span><span id="I2C-178"><a href="#I2C-178"><span class="linenos">178</span></a>    <span class="c1"># timings</span>
</span><span id="I2C-179"><a href="#I2C-179"><span class="linenos">179</span></a>    <span class="n">WAIT_TIME</span> <span class="o">=</span> <span class="mf">0.05</span>
</span><span id="I2C-180"><a href="#I2C-180"><span class="linenos">180</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;How long to wait between I2C commands&#39;&#39;&#39;</span>
</span><span id="I2C-181"><a href="#I2C-181"><span class="linenos">181</span></a>
</span><span id="I2C-182"><a href="#I2C-182"><span class="linenos">182</span></a>    <span class="n">_max_brightness_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="I2C-183"><a href="#I2C-183"><span class="linenos">183</span></a>
</span><span id="I2C-184"><a href="#I2C-184"><span class="linenos">184</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">I2CDevice</span><span class="p">:</span>
</span><span id="I2C-185"><a href="#I2C-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-186"><a href="#I2C-186"><span class="linenos">186</span></a><span class="sd">        Class to read and write data to an I2C bus,</span>
</span><span id="I2C-187"><a href="#I2C-187"><span class="linenos">187</span></a><span class="sd">        based on the `I2CDev` class from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="I2C-188"><a href="#I2C-188"><span class="linenos">188</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="I2C-189"><a href="#I2C-189"><span class="linenos">189</span></a>
</span><span id="I2C-190"><a href="#I2C-190"><span class="linenos">190</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="I2C-191"><a href="#I2C-191"><span class="linenos">191</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-192"><a href="#I2C-192"><span class="linenos">192</span></a><span class="sd">            Args:</span>
</span><span id="I2C-193"><a href="#I2C-193"><span class="linenos">193</span></a><span class="sd">                fname: the I2C path, eg: `/dev/i2c-2`</span>
</span><span id="I2C-194"><a href="#I2C-194"><span class="linenos">194</span></a><span class="sd">                slave_addr: not entirely sure what this is meant to be</span>
</span><span id="I2C-195"><a href="#I2C-195"><span class="linenos">195</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-196"><a href="#I2C-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">)</span>
</span><span id="I2C-197"><a href="#I2C-197"><span class="linenos">197</span></a>            <span class="c1"># I2C_SLAVE address setup</span>
</span><span id="I2C-198"><a href="#I2C-198"><span class="linenos">198</span></a>            <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">I2C_SLAVE</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">)</span>
</span><span id="I2C-199"><a href="#I2C-199"><span class="linenos">199</span></a>
</span><span id="I2C-200"><a href="#I2C-200"><span class="linenos">200</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C-201"><a href="#I2C-201"><span class="linenos">201</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-202"><a href="#I2C-202"><span class="linenos">202</span></a><span class="sd">            Read a certain number of bytes from the I2C bus</span>
</span><span id="I2C-203"><a href="#I2C-203"><span class="linenos">203</span></a>
</span><span id="I2C-204"><a href="#I2C-204"><span class="linenos">204</span></a><span class="sd">            Args:</span>
</span><span id="I2C-205"><a href="#I2C-205"><span class="linenos">205</span></a><span class="sd">                length: the number of bytes to read</span>
</span><span id="I2C-206"><a href="#I2C-206"><span class="linenos">206</span></a>
</span><span id="I2C-207"><a href="#I2C-207"><span class="linenos">207</span></a><span class="sd">            Returns:</span>
</span><span id="I2C-208"><a href="#I2C-208"><span class="linenos">208</span></a><span class="sd">                bytes</span>
</span><span id="I2C-209"><a href="#I2C-209"><span class="linenos">209</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-210"><a href="#I2C-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="I2C-211"><a href="#I2C-211"><span class="linenos">211</span></a>
</span><span id="I2C-212"><a href="#I2C-212"><span class="linenos">212</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C-213"><a href="#I2C-213"><span class="linenos">213</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-214"><a href="#I2C-214"><span class="linenos">214</span></a><span class="sd">            Writes data to the I2C bus</span>
</span><span id="I2C-215"><a href="#I2C-215"><span class="linenos">215</span></a>
</span><span id="I2C-216"><a href="#I2C-216"><span class="linenos">216</span></a><span class="sd">            Args:</span>
</span><span id="I2C-217"><a href="#I2C-217"><span class="linenos">217</span></a><span class="sd">                data: the data to write</span>
</span><span id="I2C-218"><a href="#I2C-218"><span class="linenos">218</span></a>
</span><span id="I2C-219"><a href="#I2C-219"><span class="linenos">219</span></a><span class="sd">            Returns:</span>
</span><span id="I2C-220"><a href="#I2C-220"><span class="linenos">220</span></a><span class="sd">                The number of bytes written</span>
</span><span id="I2C-221"><a href="#I2C-221"><span class="linenos">221</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-222"><a href="#I2C-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="I2C-223"><a href="#I2C-223"><span class="linenos">223</span></a>
</span><span id="I2C-224"><a href="#I2C-224"><span class="linenos">224</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DDCInterface</span><span class="p">(</span><span class="n">I2CDevice</span><span class="p">):</span>
</span><span id="I2C-225"><a href="#I2C-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-226"><a href="#I2C-226"><span class="linenos">226</span></a><span class="sd">        Class to send DDC (Display Data Channel) commands to an I2C device,</span>
</span><span id="I2C-227"><a href="#I2C-227"><span class="linenos">227</span></a><span class="sd">        based on the `Ddcci` and `Mccs` classes from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="I2C-228"><a href="#I2C-228"><span class="linenos">228</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="I2C-229"><a href="#I2C-229"><span class="linenos">229</span></a>
</span><span id="I2C-230"><a href="#I2C-230"><span class="linenos">230</span></a>        <span class="n">PROTOCOL_FLAG</span> <span class="o">=</span> <span class="mh">0x80</span>
</span><span id="I2C-231"><a href="#I2C-231"><span class="linenos">231</span></a>
</span><span id="I2C-232"><a href="#I2C-232"><span class="linenos">232</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2c_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="I2C-233"><a href="#I2C-233"><span class="linenos">233</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-234"><a href="#I2C-234"><span class="linenos">234</span></a><span class="sd">            Args:</span>
</span><span id="I2C-235"><a href="#I2C-235"><span class="linenos">235</span></a><span class="sd">                i2c_path: the path to the I2C device, eg: `/dev/i2c-2`</span>
</span><span id="I2C-236"><a href="#I2C-236"><span class="linenos">236</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-237"><a href="#I2C-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">)</span>
</span><span id="I2C-238"><a href="#I2C-238"><span class="linenos">238</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DDCCI_ADDR</span><span class="p">)</span>
</span><span id="I2C-239"><a href="#I2C-239"><span class="linenos">239</span></a>
</span><span id="I2C-240"><a href="#I2C-240"><span class="linenos">240</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C-241"><a href="#I2C-241"><span class="linenos">241</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-242"><a href="#I2C-242"><span class="linenos">242</span></a><span class="sd">            Write some data to the I2C device.</span>
</span><span id="I2C-243"><a href="#I2C-243"><span class="linenos">243</span></a>
</span><span id="I2C-244"><a href="#I2C-244"><span class="linenos">244</span></a><span class="sd">            It is recommended to use `setvcp` to set VCP values on the DDC device</span>
</span><span id="I2C-245"><a href="#I2C-245"><span class="linenos">245</span></a><span class="sd">            instead of using this function directly.</span>
</span><span id="I2C-246"><a href="#I2C-246"><span class="linenos">246</span></a>
</span><span id="I2C-247"><a href="#I2C-247"><span class="linenos">247</span></a><span class="sd">            Args:</span>
</span><span id="I2C-248"><a href="#I2C-248"><span class="linenos">248</span></a><span class="sd">                *args: variable length list of arguments. This will be put</span>
</span><span id="I2C-249"><a href="#I2C-249"><span class="linenos">249</span></a><span class="sd">                    into a `bytearray` and wrapped up in various flags and</span>
</span><span id="I2C-250"><a href="#I2C-250"><span class="linenos">250</span></a><span class="sd">                    checksums before being written to the I2C device</span>
</span><span id="I2C-251"><a href="#I2C-251"><span class="linenos">251</span></a>
</span><span id="I2C-252"><a href="#I2C-252"><span class="linenos">252</span></a><span class="sd">            Returns:</span>
</span><span id="I2C-253"><a href="#I2C-253"><span class="linenos">253</span></a><span class="sd">                The number of bytes that were written</span>
</span><span id="I2C-254"><a href="#I2C-254"><span class="linenos">254</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-255"><a href="#I2C-255"><span class="linenos">255</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C-256"><a href="#I2C-256"><span class="linenos">256</span></a>
</span><span id="I2C-257"><a href="#I2C-257"><span class="linenos">257</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="I2C-258"><a href="#I2C-258"><span class="linenos">258</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span>  <span class="c1"># add length info</span>
</span><span id="I2C-259"><a href="#I2C-259"><span class="linenos">259</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_W</span><span class="p">)</span>  <span class="c1"># insert source address</span>
</span><span id="I2C-260"><a href="#I2C-260"><span class="linenos">260</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">))</span>  <span class="c1"># checksum</span>
</span><span id="I2C-261"><a href="#I2C-261"><span class="linenos">261</span></a>
</span><span id="I2C-262"><a href="#I2C-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
</span><span id="I2C-263"><a href="#I2C-263"><span class="linenos">263</span></a>
</span><span id="I2C-264"><a href="#I2C-264"><span class="linenos">264</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">setvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C-265"><a href="#I2C-265"><span class="linenos">265</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-266"><a href="#I2C-266"><span class="linenos">266</span></a><span class="sd">            Set a VCP value on the device</span>
</span><span id="I2C-267"><a href="#I2C-267"><span class="linenos">267</span></a>
</span><span id="I2C-268"><a href="#I2C-268"><span class="linenos">268</span></a><span class="sd">            Args:</span>
</span><span id="I2C-269"><a href="#I2C-269"><span class="linenos">269</span></a><span class="sd">                vcp_code: the VCP command to send, eg: `0x10` is brightness</span>
</span><span id="I2C-270"><a href="#I2C-270"><span class="linenos">270</span></a><span class="sd">                value: what to set the value to</span>
</span><span id="I2C-271"><a href="#I2C-271"><span class="linenos">271</span></a>
</span><span id="I2C-272"><a href="#I2C-272"><span class="linenos">272</span></a><span class="sd">            Returns:</span>
</span><span id="I2C-273"><a href="#I2C-273"><span class="linenos">273</span></a><span class="sd">                The number of bytes written to the device</span>
</span><span id="I2C-274"><a href="#I2C-274"><span class="linenos">274</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-275"><a href="#I2C-275"><span class="linenos">275</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">SET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">))</span>
</span><span id="I2C-276"><a href="#I2C-276"><span class="linenos">276</span></a>
</span><span id="I2C-277"><a href="#I2C-277"><span class="linenos">277</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C-278"><a href="#I2C-278"><span class="linenos">278</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-279"><a href="#I2C-279"><span class="linenos">279</span></a><span class="sd">            Reads data from the DDC device.</span>
</span><span id="I2C-280"><a href="#I2C-280"><span class="linenos">280</span></a>
</span><span id="I2C-281"><a href="#I2C-281"><span class="linenos">281</span></a><span class="sd">            It is recommended to use `getvcp` to retrieve VCP values from the</span>
</span><span id="I2C-282"><a href="#I2C-282"><span class="linenos">282</span></a><span class="sd">            DDC device instead of using this function directly.</span>
</span><span id="I2C-283"><a href="#I2C-283"><span class="linenos">283</span></a>
</span><span id="I2C-284"><a href="#I2C-284"><span class="linenos">284</span></a><span class="sd">            Args:</span>
</span><span id="I2C-285"><a href="#I2C-285"><span class="linenos">285</span></a><span class="sd">                amount: the number of bytes to read</span>
</span><span id="I2C-286"><a href="#I2C-286"><span class="linenos">286</span></a>
</span><span id="I2C-287"><a href="#I2C-287"><span class="linenos">287</span></a><span class="sd">            Raises:</span>
</span><span id="I2C-288"><a href="#I2C-288"><span class="linenos">288</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C-289"><a href="#I2C-289"><span class="linenos">289</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-290"><a href="#I2C-290"><span class="linenos">290</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C-291"><a href="#I2C-291"><span class="linenos">291</span></a>
</span><span id="I2C-292"><a href="#I2C-292"><span class="linenos">292</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amount</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="I2C-293"><a href="#I2C-293"><span class="linenos">293</span></a>
</span><span id="I2C-294"><a href="#I2C-294"><span class="linenos">294</span></a>            <span class="c1"># check the bytes read</span>
</span><span id="I2C-295"><a href="#I2C-295"><span class="linenos">295</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C-296"><a href="#I2C-296"><span class="linenos">296</span></a>                <span class="s1">&#39;source address&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">,</span>
</span><span id="I2C-297"><a href="#I2C-297"><span class="linenos">297</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">)</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">,</span>
</span><span id="I2C-298"><a href="#I2C-298"><span class="linenos">298</span></a>                <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="I2C-299"><a href="#I2C-299"><span class="linenos">299</span></a>            <span class="p">}</span>
</span><span id="I2C-300"><a href="#I2C-300"><span class="linenos">300</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C-301"><a href="#I2C-301"><span class="linenos">301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C-302"><a href="#I2C-302"><span class="linenos">302</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C-303"><a href="#I2C-303"><span class="linenos">303</span></a>
</span><span id="I2C-304"><a href="#I2C-304"><span class="linenos">304</span></a>            <span class="k">return</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="I2C-305"><a href="#I2C-305"><span class="linenos">305</span></a>
</span><span id="I2C-306"><a href="#I2C-306"><span class="linenos">306</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">getvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="I2C-307"><a href="#I2C-307"><span class="linenos">307</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C-308"><a href="#I2C-308"><span class="linenos">308</span></a><span class="sd">            Retrieves a VCP value from the DDC device.</span>
</span><span id="I2C-309"><a href="#I2C-309"><span class="linenos">309</span></a>
</span><span id="I2C-310"><a href="#I2C-310"><span class="linenos">310</span></a><span class="sd">            Args:</span>
</span><span id="I2C-311"><a href="#I2C-311"><span class="linenos">311</span></a><span class="sd">                vcp_code: the VCP value to read, eg: `0x10` is brightness</span>
</span><span id="I2C-312"><a href="#I2C-312"><span class="linenos">312</span></a>
</span><span id="I2C-313"><a href="#I2C-313"><span class="linenos">313</span></a><span class="sd">            Returns:</span>
</span><span id="I2C-314"><a href="#I2C-314"><span class="linenos">314</span></a><span class="sd">                The current and maximum value respectively</span>
</span><span id="I2C-315"><a href="#I2C-315"><span class="linenos">315</span></a>
</span><span id="I2C-316"><a href="#I2C-316"><span class="linenos">316</span></a><span class="sd">            Raises:</span>
</span><span id="I2C-317"><a href="#I2C-317"><span class="linenos">317</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C-318"><a href="#I2C-318"><span class="linenos">318</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C-319"><a href="#I2C-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">)</span>
</span><span id="I2C-320"><a href="#I2C-320"><span class="linenos">320</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span><span id="I2C-321"><a href="#I2C-321"><span class="linenos">321</span></a>
</span><span id="I2C-322"><a href="#I2C-322"><span class="linenos">322</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C-323"><a href="#I2C-323"><span class="linenos">323</span></a>                <span class="s1">&#39;is feature reply&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_REPLY</span><span class="p">,</span>
</span><span id="I2C-324"><a href="#I2C-324"><span class="linenos">324</span></a>                <span class="s1">&#39;supported VCP opcode&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="I2C-325"><a href="#I2C-325"><span class="linenos">325</span></a>                <span class="s1">&#39;answer matches request&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">vcp_code</span><span class="p">,</span>
</span><span id="I2C-326"><a href="#I2C-326"><span class="linenos">326</span></a>            <span class="p">}</span>
</span><span id="I2C-327"><a href="#I2C-327"><span class="linenos">327</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C-328"><a href="#I2C-328"><span class="linenos">328</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C-329"><a href="#I2C-329"><span class="linenos">329</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C-330"><a href="#I2C-330"><span class="linenos">330</span></a>
</span><span id="I2C-331"><a href="#I2C-331"><span class="linenos">331</span></a>            <span class="c1"># current and max values</span>
</span><span id="I2C-332"><a href="#I2C-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span><span id="I2C-333"><a href="#I2C-333"><span class="linenos">333</span></a>
</span><span id="I2C-334"><a href="#I2C-334"><span class="linenos">334</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C-335"><a href="#I2C-335"><span class="linenos">335</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="I2C-336"><a href="#I2C-336"><span class="linenos">336</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">)</span>
</span><span id="I2C-337"><a href="#I2C-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">all_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C-338"><a href="#I2C-338"><span class="linenos">338</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="I2C-339"><a href="#I2C-339"><span class="linenos">339</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="I2C-340"><a href="#I2C-340"><span class="linenos">340</span></a>
</span><span id="I2C-341"><a href="#I2C-341"><span class="linenos">341</span></a>            <span class="k">for</span> <span class="n">i2c_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-*&#39;</span><span class="p">):</span>
</span><span id="I2C-342"><a href="#I2C-342"><span class="linenos">342</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">):</span>
</span><span id="I2C-343"><a href="#I2C-343"><span class="linenos">343</span></a>                    <span class="k">continue</span>
</span><span id="I2C-344"><a href="#I2C-344"><span class="linenos">344</span></a>
</span><span id="I2C-345"><a href="#I2C-345"><span class="linenos">345</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="I2C-346"><a href="#I2C-346"><span class="linenos">346</span></a>                    <span class="c1"># open the I2C device using the host read address</span>
</span><span id="I2C-347"><a href="#I2C-347"><span class="linenos">347</span></a>                    <span class="n">device</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">I2CDevice</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">)</span>
</span><span id="I2C-348"><a href="#I2C-348"><span class="linenos">348</span></a>                    <span class="c1"># read some 512 bytes from the device</span>
</span><span id="I2C-349"><a href="#I2C-349"><span class="linenos">349</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</span><span id="I2C-350"><a href="#I2C-350"><span class="linenos">350</span></a>                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="I2C-351"><a href="#I2C-351"><span class="linenos">351</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;IOError reading from device </span><span class="si">{</span><span class="n">i2c_path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="I2C-352"><a href="#I2C-352"><span class="linenos">352</span></a>                    <span class="k">continue</span>
</span><span id="I2C-353"><a href="#I2C-353"><span class="linenos">353</span></a>
</span><span id="I2C-354"><a href="#I2C-354"><span class="linenos">354</span></a>                <span class="c1"># search for the EDID header within our 512 read bytes</span>
</span><span id="I2C-355"><a href="#I2C-355"><span class="linenos">355</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;00 FF FF FF FF FF FF 00&#39;</span><span class="p">))</span>
</span><span id="I2C-356"><a href="#I2C-356"><span class="linenos">356</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="I2C-357"><a href="#I2C-357"><span class="linenos">357</span></a>                    <span class="k">continue</span>
</span><span id="I2C-358"><a href="#I2C-358"><span class="linenos">358</span></a>
</span><span id="I2C-359"><a href="#I2C-359"><span class="linenos">359</span></a>                <span class="c1"># grab 128 bytes of the edid</span>
</span><span id="I2C-360"><a href="#I2C-360"><span class="linenos">360</span></a>                <span class="n">edid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">128</span><span class="p">]</span>
</span><span id="I2C-361"><a href="#I2C-361"><span class="linenos">361</span></a>                <span class="c1"># parse the EDID</span>
</span><span id="I2C-362"><a href="#I2C-362"><span class="linenos">362</span></a>                <span class="n">manufacturer_id</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">serial</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">edid</span><span class="p">)</span>
</span><span id="I2C-363"><a href="#I2C-363"><span class="linenos">363</span></a>
</span><span id="I2C-364"><a href="#I2C-364"><span class="linenos">364</span></a>                <span class="n">all_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="I2C-365"><a href="#I2C-365"><span class="linenos">365</span></a>                    <span class="p">{</span>
</span><span id="I2C-366"><a href="#I2C-366"><span class="linenos">366</span></a>                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="I2C-367"><a href="#I2C-367"><span class="linenos">367</span></a>                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="I2C-368"><a href="#I2C-368"><span class="linenos">368</span></a>                        <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="n">manufacturer</span><span class="p">,</span>
</span><span id="I2C-369"><a href="#I2C-369"><span class="linenos">369</span></a>                        <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="n">manufacturer_id</span><span class="p">,</span>
</span><span id="I2C-370"><a href="#I2C-370"><span class="linenos">370</span></a>                        <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="n">serial</span><span class="p">,</span>
</span><span id="I2C-371"><a href="#I2C-371"><span class="linenos">371</span></a>                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="I2C-372"><a href="#I2C-372"><span class="linenos">372</span></a>                        <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="I2C-373"><a href="#I2C-373"><span class="linenos">373</span></a>                        <span class="c1"># convert edid to hex string</span>
</span><span id="I2C-374"><a href="#I2C-374"><span class="linenos">374</span></a>                        <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edid</span><span class="p">),</span>
</span><span id="I2C-375"><a href="#I2C-375"><span class="linenos">375</span></a>                        <span class="s1">&#39;i2c_bus&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="p">,</span>
</span><span id="I2C-376"><a href="#I2C-376"><span class="linenos">376</span></a>                        <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="I2C-377"><a href="#I2C-377"><span class="linenos">377</span></a>                    <span class="p">}</span>
</span><span id="I2C-378"><a href="#I2C-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="I2C-379"><a href="#I2C-379"><span class="linenos">379</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="I2C-380"><a href="#I2C-380"><span class="linenos">380</span></a>
</span><span id="I2C-381"><a href="#I2C-381"><span class="linenos">381</span></a>            <span class="k">if</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C-382"><a href="#I2C-382"><span class="linenos">382</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">,</span> <span class="n">all_displays</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="I2C-383"><a href="#I2C-383"><span class="linenos">383</span></a>
</span><span id="I2C-384"><a href="#I2C-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C-385"><a href="#I2C-385"><span class="linenos">385</span></a>            <span class="k">return</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C-386"><a href="#I2C-386"><span class="linenos">386</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span><span id="I2C-387"><a href="#I2C-387"><span class="linenos">387</span></a>
</span><span id="I2C-388"><a href="#I2C-388"><span class="linenos">388</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C-389"><a href="#I2C-389"><span class="linenos">389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="I2C-390"><a href="#I2C-390"><span class="linenos">390</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="I2C-391"><a href="#I2C-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C-392"><a href="#I2C-392"><span class="linenos">392</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="I2C-393"><a href="#I2C-393"><span class="linenos">393</span></a>
</span><span id="I2C-394"><a href="#I2C-394"><span class="linenos">394</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="I2C-395"><a href="#I2C-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C-396"><a href="#I2C-396"><span class="linenos">396</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C-397"><a href="#I2C-397"><span class="linenos">397</span></a>            <span class="n">value</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">getvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span>
</span><span id="I2C-398"><a href="#I2C-398"><span class="linenos">398</span></a>
</span><span id="I2C-399"><a href="#I2C-399"><span class="linenos">399</span></a>            <span class="c1"># make sure display&#39;s max brighness is cached</span>
</span><span id="I2C-400"><a href="#I2C-400"><span class="linenos">400</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="I2C-401"><a href="#I2C-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="I2C-402"><a href="#I2C-402"><span class="linenos">402</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="I2C-403"><a href="#I2C-403"><span class="linenos">403</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="I2C-404"><a href="#I2C-404"><span class="linenos">404</span></a>
</span><span id="I2C-405"><a href="#I2C-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="I2C-406"><a href="#I2C-406"><span class="linenos">406</span></a>                <span class="c1"># if max value is not 100 then we have to adjust the scale to be</span>
</span><span id="I2C-407"><a href="#I2C-407"><span class="linenos">407</span></a>                <span class="c1"># a percentage</span>
</span><span id="I2C-408"><a href="#I2C-408"><span class="linenos">408</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="I2C-409"><a href="#I2C-409"><span class="linenos">409</span></a>
</span><span id="I2C-410"><a href="#I2C-410"><span class="linenos">410</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="I2C-411"><a href="#I2C-411"><span class="linenos">411</span></a>
</span><span id="I2C-412"><a href="#I2C-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="n">results</span>
</span><span id="I2C-413"><a href="#I2C-413"><span class="linenos">413</span></a>
</span><span id="I2C-414"><a href="#I2C-414"><span class="linenos">414</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C-415"><a href="#I2C-415"><span class="linenos">415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="I2C-416"><a href="#I2C-416"><span class="linenos">416</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="I2C-417"><a href="#I2C-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C-418"><a href="#I2C-418"><span class="linenos">418</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="I2C-419"><a href="#I2C-419"><span class="linenos">419</span></a>
</span><span id="I2C-420"><a href="#I2C-420"><span class="linenos">420</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C-421"><a href="#I2C-421"><span class="linenos">421</span></a>            <span class="c1"># make sure display brightness max value is cached</span>
</span><span id="I2C-422"><a href="#I2C-422"><span class="linenos">422</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="I2C-423"><a href="#I2C-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="I2C-424"><a href="#I2C-424"><span class="linenos">424</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="I2C-425"><a href="#I2C-425"><span class="linenos">425</span></a>
</span><span id="I2C-426"><a href="#I2C-426"><span class="linenos">426</span></a>            <span class="c1"># scale the brightness value according to the max brightness</span>
</span><span id="I2C-427"><a href="#I2C-427"><span class="linenos">427</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span>
</span><span id="I2C-428"><a href="#I2C-428"><span class="linenos">428</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="I2C-429"><a href="#I2C-429"><span class="linenos">429</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_value</span><span class="p">)</span>
</span><span id="I2C-430"><a href="#I2C-430"><span class="linenos">430</span></a>
</span><span id="I2C-431"><a href="#I2C-431"><span class="linenos">431</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C-432"><a href="#I2C-432"><span class="linenos">432</span></a>            <span class="n">interface</span><span class="o">.</span><span class="n">setvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>In the same spirit as <code><a href="#SysFiles">SysFiles</a></code>, this class serves as a way of getting
display information and adjusting the brightness without relying on any
3rd party software.</p>

<p>Usage of this class requires read and write permission for <code>/dev/i2c-*</code>.</p>

<p>This class works over the I2C bus, primarily with desktop monitors as I
haven't tested any e-DP displays yet.</p>

<p>Massive thanks to <a href="https://github.com/siemer">siemer</a> for
his work on the <a href="https://github.com/siemer/ddcci">ddcci.py</a> project,
which served as a my main reference for this.</p>

<h6 id="references">References:</h6>

<blockquote>
  <ul>
  <li><a href="https://github.com/siemer/ddcci">ddcci.py</a></li>
  <li><a href="https://milek7.pl/ddcbacklight/ddcci.pdf">DDCCI Spec</a></li>
  </ul>
</blockquote>
</div>


                            <div id="I2C.GET_VCP_CMD" class="classattr">
                                <div class="attr variable">
            <span class="name">GET_VCP_CMD</span>        =
<span class="default_value">1</span>

        
    </div>
    <a class="headerlink" href="#I2C.GET_VCP_CMD"></a>
    
            <div class="docstring"><p>VCP command to get the value of a feature (eg: brightness)</p>
</div>


                            </div>
                            <div id="I2C.GET_VCP_REPLY" class="classattr">
                                <div class="attr variable">
            <span class="name">GET_VCP_REPLY</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#I2C.GET_VCP_REPLY"></a>
    
            <div class="docstring"><p>VCP feature reply op code</p>
</div>


                            </div>
                            <div id="I2C.SET_VCP_CMD" class="classattr">
                                <div class="attr variable">
            <span class="name">SET_VCP_CMD</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#I2C.SET_VCP_CMD"></a>
    
            <div class="docstring"><p>VCP command to set the value of a feature (eg: brightness)</p>
</div>


                            </div>
                            <div id="I2C.DDCCI_ADDR" class="classattr">
                                <div class="attr variable">
            <span class="name">DDCCI_ADDR</span>        =
<span class="default_value">55</span>

        
    </div>
    <a class="headerlink" href="#I2C.DDCCI_ADDR"></a>
    
            <div class="docstring"><p>DDC packets are transmittred using this I2C address</p>
</div>


                            </div>
                            <div id="I2C.HOST_ADDR_R" class="classattr">
                                <div class="attr variable">
            <span class="name">HOST_ADDR_R</span>        =
<span class="default_value">80</span>

        
    </div>
    <a class="headerlink" href="#I2C.HOST_ADDR_R"></a>
    
            <div class="docstring"><p>Packet source address (the computer) when reading data</p>
</div>


                            </div>
                            <div id="I2C.HOST_ADDR_W" class="classattr">
                                <div class="attr variable">
            <span class="name">HOST_ADDR_W</span>        =
<span class="default_value">81</span>

        
    </div>
    <a class="headerlink" href="#I2C.HOST_ADDR_W"></a>
    
            <div class="docstring"><p>Packet source address (the computer) when writing data</p>
</div>


                            </div>
                            <div id="I2C.DESTINATION_ADDR_W" class="classattr">
                                <div class="attr variable">
            <span class="name">DESTINATION_ADDR_W</span>        =
<span class="default_value">110</span>

        
    </div>
    <a class="headerlink" href="#I2C.DESTINATION_ADDR_W"></a>
    
            <div class="docstring"><p>Packet destination address (the monitor) when writing data</p>
</div>


                            </div>
                            <div id="I2C.I2C_SLAVE" class="classattr">
                                <div class="attr variable">
            <span class="name">I2C_SLAVE</span>        =
<span class="default_value">1795</span>

        
    </div>
    <a class="headerlink" href="#I2C.I2C_SLAVE"></a>
    
            <div class="docstring"><p>The I2C slave address</p>
</div>


                            </div>
                            <div id="I2C.WAIT_TIME" class="classattr">
                                <div class="attr variable">
            <span class="name">WAIT_TIME</span>        =
<span class="default_value">0.05</span>

        
    </div>
    <a class="headerlink" href="#I2C.WAIT_TIME"></a>
    
            <div class="docstring"><p>How long to wait between I2C commands</p>
</div>


                            </div>
                            <div id="I2C.get_display_info" class="classattr">
                                        <input id="I2C.get_display_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_display_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="I2C.get_display_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.get_display_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.get_display_info-334"><a href="#I2C.get_display_info-334"><span class="linenos">334</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C.get_display_info-335"><a href="#I2C.get_display_info-335"><span class="linenos">335</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="I2C.get_display_info-336"><a href="#I2C.get_display_info-336"><span class="linenos">336</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">)</span>
</span><span id="I2C.get_display_info-337"><a href="#I2C.get_display_info-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">all_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C.get_display_info-338"><a href="#I2C.get_display_info-338"><span class="linenos">338</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="I2C.get_display_info-339"><a href="#I2C.get_display_info-339"><span class="linenos">339</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="I2C.get_display_info-340"><a href="#I2C.get_display_info-340"><span class="linenos">340</span></a>
</span><span id="I2C.get_display_info-341"><a href="#I2C.get_display_info-341"><span class="linenos">341</span></a>            <span class="k">for</span> <span class="n">i2c_path</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-*&#39;</span><span class="p">):</span>
</span><span id="I2C.get_display_info-342"><a href="#I2C.get_display_info-342"><span class="linenos">342</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">):</span>
</span><span id="I2C.get_display_info-343"><a href="#I2C.get_display_info-343"><span class="linenos">343</span></a>                    <span class="k">continue</span>
</span><span id="I2C.get_display_info-344"><a href="#I2C.get_display_info-344"><span class="linenos">344</span></a>
</span><span id="I2C.get_display_info-345"><a href="#I2C.get_display_info-345"><span class="linenos">345</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="I2C.get_display_info-346"><a href="#I2C.get_display_info-346"><span class="linenos">346</span></a>                    <span class="c1"># open the I2C device using the host read address</span>
</span><span id="I2C.get_display_info-347"><a href="#I2C.get_display_info-347"><span class="linenos">347</span></a>                    <span class="n">device</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">I2CDevice</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">)</span>
</span><span id="I2C.get_display_info-348"><a href="#I2C.get_display_info-348"><span class="linenos">348</span></a>                    <span class="c1"># read some 512 bytes from the device</span>
</span><span id="I2C.get_display_info-349"><a href="#I2C.get_display_info-349"><span class="linenos">349</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</span><span id="I2C.get_display_info-350"><a href="#I2C.get_display_info-350"><span class="linenos">350</span></a>                <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="I2C.get_display_info-351"><a href="#I2C.get_display_info-351"><span class="linenos">351</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;IOError reading from device </span><span class="si">{</span><span class="n">i2c_path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="I2C.get_display_info-352"><a href="#I2C.get_display_info-352"><span class="linenos">352</span></a>                    <span class="k">continue</span>
</span><span id="I2C.get_display_info-353"><a href="#I2C.get_display_info-353"><span class="linenos">353</span></a>
</span><span id="I2C.get_display_info-354"><a href="#I2C.get_display_info-354"><span class="linenos">354</span></a>                <span class="c1"># search for the EDID header within our 512 read bytes</span>
</span><span id="I2C.get_display_info-355"><a href="#I2C.get_display_info-355"><span class="linenos">355</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;00 FF FF FF FF FF FF 00&#39;</span><span class="p">))</span>
</span><span id="I2C.get_display_info-356"><a href="#I2C.get_display_info-356"><span class="linenos">356</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="I2C.get_display_info-357"><a href="#I2C.get_display_info-357"><span class="linenos">357</span></a>                    <span class="k">continue</span>
</span><span id="I2C.get_display_info-358"><a href="#I2C.get_display_info-358"><span class="linenos">358</span></a>
</span><span id="I2C.get_display_info-359"><a href="#I2C.get_display_info-359"><span class="linenos">359</span></a>                <span class="c1"># grab 128 bytes of the edid</span>
</span><span id="I2C.get_display_info-360"><a href="#I2C.get_display_info-360"><span class="linenos">360</span></a>                <span class="n">edid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">128</span><span class="p">]</span>
</span><span id="I2C.get_display_info-361"><a href="#I2C.get_display_info-361"><span class="linenos">361</span></a>                <span class="c1"># parse the EDID</span>
</span><span id="I2C.get_display_info-362"><a href="#I2C.get_display_info-362"><span class="linenos">362</span></a>                <span class="n">manufacturer_id</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">serial</span> <span class="o">=</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">edid</span><span class="p">)</span>
</span><span id="I2C.get_display_info-363"><a href="#I2C.get_display_info-363"><span class="linenos">363</span></a>
</span><span id="I2C.get_display_info-364"><a href="#I2C.get_display_info-364"><span class="linenos">364</span></a>                <span class="n">all_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="I2C.get_display_info-365"><a href="#I2C.get_display_info-365"><span class="linenos">365</span></a>                    <span class="p">{</span>
</span><span id="I2C.get_display_info-366"><a href="#I2C.get_display_info-366"><span class="linenos">366</span></a>                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="I2C.get_display_info-367"><a href="#I2C.get_display_info-367"><span class="linenos">367</span></a>                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="I2C.get_display_info-368"><a href="#I2C.get_display_info-368"><span class="linenos">368</span></a>                        <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="n">manufacturer</span><span class="p">,</span>
</span><span id="I2C.get_display_info-369"><a href="#I2C.get_display_info-369"><span class="linenos">369</span></a>                        <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="n">manufacturer_id</span><span class="p">,</span>
</span><span id="I2C.get_display_info-370"><a href="#I2C.get_display_info-370"><span class="linenos">370</span></a>                        <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="n">serial</span><span class="p">,</span>
</span><span id="I2C.get_display_info-371"><a href="#I2C.get_display_info-371"><span class="linenos">371</span></a>                        <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="I2C.get_display_info-372"><a href="#I2C.get_display_info-372"><span class="linenos">372</span></a>                        <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span>
</span><span id="I2C.get_display_info-373"><a href="#I2C.get_display_info-373"><span class="linenos">373</span></a>                        <span class="c1"># convert edid to hex string</span>
</span><span id="I2C.get_display_info-374"><a href="#I2C.get_display_info-374"><span class="linenos">374</span></a>                        <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">02x</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">edid</span><span class="p">),</span>
</span><span id="I2C.get_display_info-375"><a href="#I2C.get_display_info-375"><span class="linenos">375</span></a>                        <span class="s1">&#39;i2c_bus&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="p">,</span>
</span><span id="I2C.get_display_info-376"><a href="#I2C.get_display_info-376"><span class="linenos">376</span></a>                        <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">i2c_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="I2C.get_display_info-377"><a href="#I2C.get_display_info-377"><span class="linenos">377</span></a>                    <span class="p">}</span>
</span><span id="I2C.get_display_info-378"><a href="#I2C.get_display_info-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="I2C.get_display_info-379"><a href="#I2C.get_display_info-379"><span class="linenos">379</span></a>                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="I2C.get_display_info-380"><a href="#I2C.get_display_info-380"><span class="linenos">380</span></a>
</span><span id="I2C.get_display_info-381"><a href="#I2C.get_display_info-381"><span class="linenos">381</span></a>            <span class="k">if</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C.get_display_info-382"><a href="#I2C.get_display_info-382"><span class="linenos">382</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;i2c_display_info&#39;</span><span class="p">,</span> <span class="n">all_displays</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="I2C.get_display_info-383"><a href="#I2C.get_display_info-383"><span class="linenos">383</span></a>
</span><span id="I2C.get_display_info-384"><a href="#I2C.get_display_info-384"><span class="linenos">384</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C.get_display_info-385"><a href="#I2C.get_display_info-385"><span class="linenos">385</span></a>            <span class="k">return</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">all_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C.get_display_info-386"><a href="#I2C.get_display_info-386"><span class="linenos">386</span></a>        <span class="k">return</span> <span class="n">all_displays</span>
</span></pre></div>


            <div class="docstring"><p>Return information about detected displays.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display (<a href="types.html#DisplayIdentifier">screen_brightness_control.types.DisplayIdentifier</a>):</strong>  the specific display to return
information about. This parameter is passed to <code>filter_monitors</code></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of dictionaries, each representing a detected display.
  Each returned dictionary will have the following keys:</p>
  
  <ul>
  <li>name (<code>str</code>): the name of the display</li>
  <li>model (<code>str</code>): the model of the display</li>
  <li>manufacturer (<code>str</code>): the name of the display manufacturer</li>
  <li>manufacturer_id (<code>str</code>): the three letter manufacturer code (see <code>MONITOR_MANUFACTURER_CODES</code>)</li>
  <li>serial (<code>str</code>): the serial of the display OR some other unique identifier</li>
  <li>edid (<code>str</code>): the EDID string for the display</li>
  <li>method (<code>BrightnessMethod</code>): the brightness method associated with this display</li>
  <li>index (<code>int</code>): the index of the display, relative to the brightness method</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="I2C.get_brightness" class="classattr">
                                        <input id="I2C.get_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="I2C.get_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.get_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.get_brightness-388"><a href="#I2C.get_brightness-388"><span class="linenos">388</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C.get_brightness-389"><a href="#I2C.get_brightness-389"><span class="linenos">389</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="I2C.get_brightness-390"><a href="#I2C.get_brightness-390"><span class="linenos">390</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="I2C.get_brightness-391"><a href="#I2C.get_brightness-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C.get_brightness-392"><a href="#I2C.get_brightness-392"><span class="linenos">392</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="I2C.get_brightness-393"><a href="#I2C.get_brightness-393"><span class="linenos">393</span></a>
</span><span id="I2C.get_brightness-394"><a href="#I2C.get_brightness-394"><span class="linenos">394</span></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="I2C.get_brightness-395"><a href="#I2C.get_brightness-395"><span class="linenos">395</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C.get_brightness-396"><a href="#I2C.get_brightness-396"><span class="linenos">396</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C.get_brightness-397"><a href="#I2C.get_brightness-397"><span class="linenos">397</span></a>            <span class="n">value</span><span class="p">,</span> <span class="n">max_value</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">getvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span>
</span><span id="I2C.get_brightness-398"><a href="#I2C.get_brightness-398"><span class="linenos">398</span></a>
</span><span id="I2C.get_brightness-399"><a href="#I2C.get_brightness-399"><span class="linenos">399</span></a>            <span class="c1"># make sure display&#39;s max brighness is cached</span>
</span><span id="I2C.get_brightness-400"><a href="#I2C.get_brightness-400"><span class="linenos">400</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="I2C.get_brightness-401"><a href="#I2C.get_brightness-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="I2C.get_brightness-402"><a href="#I2C.get_brightness-402"><span class="linenos">402</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="I2C.get_brightness-403"><a href="#I2C.get_brightness-403"><span class="linenos">403</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="I2C.get_brightness-404"><a href="#I2C.get_brightness-404"><span class="linenos">404</span></a>
</span><span id="I2C.get_brightness-405"><a href="#I2C.get_brightness-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="I2C.get_brightness-406"><a href="#I2C.get_brightness-406"><span class="linenos">406</span></a>                <span class="c1"># if max value is not 100 then we have to adjust the scale to be</span>
</span><span id="I2C.get_brightness-407"><a href="#I2C.get_brightness-407"><span class="linenos">407</span></a>                <span class="c1"># a percentage</span>
</span><span id="I2C.get_brightness-408"><a href="#I2C.get_brightness-408"><span class="linenos">408</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="I2C.get_brightness-409"><a href="#I2C.get_brightness-409"><span class="linenos">409</span></a>
</span><span id="I2C.get_brightness-410"><a href="#I2C.get_brightness-410"><span class="linenos">410</span></a>            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="I2C.get_brightness-411"><a href="#I2C.get_brightness-411"><span class="linenos">411</span></a>
</span><span id="I2C.get_brightness-412"><a href="#I2C.get_brightness-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display:</strong>  the index of the specific display to query.
If unspecified, all detected displays are queried</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of <code><a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a></code> values, one for each
  queried display</p>
</blockquote>
</div>


                            </div>
                            <div id="I2C.set_brightness" class="classattr">
                                        <input id="I2C.set_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">set_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="I2C.set_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.set_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.set_brightness-414"><a href="#I2C.set_brightness-414"><span class="linenos">414</span></a>    <span class="nd">@classmethod</span>
</span><span id="I2C.set_brightness-415"><a href="#I2C.set_brightness-415"><span class="linenos">415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="I2C.set_brightness-416"><a href="#I2C.set_brightness-416"><span class="linenos">416</span></a>        <span class="n">all_displays</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="I2C.set_brightness-417"><a href="#I2C.set_brightness-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="I2C.set_brightness-418"><a href="#I2C.set_brightness-418"><span class="linenos">418</span></a>            <span class="n">all_displays</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_displays</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="I2C.set_brightness-419"><a href="#I2C.set_brightness-419"><span class="linenos">419</span></a>
</span><span id="I2C.set_brightness-420"><a href="#I2C.set_brightness-420"><span class="linenos">420</span></a>        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_displays</span><span class="p">:</span>
</span><span id="I2C.set_brightness-421"><a href="#I2C.set_brightness-421"><span class="linenos">421</span></a>            <span class="c1"># make sure display brightness max value is cached</span>
</span><span id="I2C.set_brightness-422"><a href="#I2C.set_brightness-422"><span class="linenos">422</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">])</span>
</span><span id="I2C.set_brightness-423"><a href="#I2C.set_brightness-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="I2C.set_brightness-424"><a href="#I2C.set_brightness-424"><span class="linenos">424</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="I2C.set_brightness-425"><a href="#I2C.set_brightness-425"><span class="linenos">425</span></a>
</span><span id="I2C.set_brightness-426"><a href="#I2C.set_brightness-426"><span class="linenos">426</span></a>            <span class="c1"># scale the brightness value according to the max brightness</span>
</span><span id="I2C.set_brightness-427"><a href="#I2C.set_brightness-427"><span class="linenos">427</span></a>            <span class="n">max_value</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span>
</span><span id="I2C.set_brightness-428"><a href="#I2C.set_brightness-428"><span class="linenos">428</span></a>            <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="I2C.set_brightness-429"><a href="#I2C.set_brightness-429"><span class="linenos">429</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_value</span><span class="p">)</span>
</span><span id="I2C.set_brightness-430"><a href="#I2C.set_brightness-430"><span class="linenos">430</span></a>
</span><span id="I2C.set_brightness-431"><a href="#I2C.set_brightness-431"><span class="linenos">431</span></a>            <span class="n">interface</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DDCInterface</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="I2C.set_brightness-432"><a href="#I2C.set_brightness-432"><span class="linenos">432</span></a>            <span class="n">interface</span><span class="o">.</span><span class="n">setvcp</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>value (<a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a>):</strong>  the new brightness value</li>
<li><strong>display:</strong>  the index of the specific display to adjust.
If unspecified, all detected displays are adjusted</li>
</ul>
</div>


                            </div>
                </section>
                <section id="I2C.I2CDevice">
                            <input id="I2C.I2CDevice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">I2C.I2CDevice</span>:

                <label class="view-source-button" for="I2C.I2CDevice-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.I2CDevice"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.I2CDevice-184"><a href="#I2C.I2CDevice-184"><span class="linenos">184</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">I2CDevice</span><span class="p">:</span>
</span><span id="I2C.I2CDevice-185"><a href="#I2C.I2CDevice-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-186"><a href="#I2C.I2CDevice-186"><span class="linenos">186</span></a><span class="sd">        Class to read and write data to an I2C bus,</span>
</span><span id="I2C.I2CDevice-187"><a href="#I2C.I2CDevice-187"><span class="linenos">187</span></a><span class="sd">        based on the `I2CDev` class from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="I2C.I2CDevice-188"><a href="#I2C.I2CDevice-188"><span class="linenos">188</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-189"><a href="#I2C.I2CDevice-189"><span class="linenos">189</span></a>
</span><span id="I2C.I2CDevice-190"><a href="#I2C.I2CDevice-190"><span class="linenos">190</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="I2C.I2CDevice-191"><a href="#I2C.I2CDevice-191"><span class="linenos">191</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-192"><a href="#I2C.I2CDevice-192"><span class="linenos">192</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice-193"><a href="#I2C.I2CDevice-193"><span class="linenos">193</span></a><span class="sd">                fname: the I2C path, eg: `/dev/i2c-2`</span>
</span><span id="I2C.I2CDevice-194"><a href="#I2C.I2CDevice-194"><span class="linenos">194</span></a><span class="sd">                slave_addr: not entirely sure what this is meant to be</span>
</span><span id="I2C.I2CDevice-195"><a href="#I2C.I2CDevice-195"><span class="linenos">195</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-196"><a href="#I2C.I2CDevice-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">)</span>
</span><span id="I2C.I2CDevice-197"><a href="#I2C.I2CDevice-197"><span class="linenos">197</span></a>            <span class="c1"># I2C_SLAVE address setup</span>
</span><span id="I2C.I2CDevice-198"><a href="#I2C.I2CDevice-198"><span class="linenos">198</span></a>            <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">I2C_SLAVE</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">)</span>
</span><span id="I2C.I2CDevice-199"><a href="#I2C.I2CDevice-199"><span class="linenos">199</span></a>
</span><span id="I2C.I2CDevice-200"><a href="#I2C.I2CDevice-200"><span class="linenos">200</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C.I2CDevice-201"><a href="#I2C.I2CDevice-201"><span class="linenos">201</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-202"><a href="#I2C.I2CDevice-202"><span class="linenos">202</span></a><span class="sd">            Read a certain number of bytes from the I2C bus</span>
</span><span id="I2C.I2CDevice-203"><a href="#I2C.I2CDevice-203"><span class="linenos">203</span></a>
</span><span id="I2C.I2CDevice-204"><a href="#I2C.I2CDevice-204"><span class="linenos">204</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice-205"><a href="#I2C.I2CDevice-205"><span class="linenos">205</span></a><span class="sd">                length: the number of bytes to read</span>
</span><span id="I2C.I2CDevice-206"><a href="#I2C.I2CDevice-206"><span class="linenos">206</span></a>
</span><span id="I2C.I2CDevice-207"><a href="#I2C.I2CDevice-207"><span class="linenos">207</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.I2CDevice-208"><a href="#I2C.I2CDevice-208"><span class="linenos">208</span></a><span class="sd">                bytes</span>
</span><span id="I2C.I2CDevice-209"><a href="#I2C.I2CDevice-209"><span class="linenos">209</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-210"><a href="#I2C.I2CDevice-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span><span id="I2C.I2CDevice-211"><a href="#I2C.I2CDevice-211"><span class="linenos">211</span></a>
</span><span id="I2C.I2CDevice-212"><a href="#I2C.I2CDevice-212"><span class="linenos">212</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.I2CDevice-213"><a href="#I2C.I2CDevice-213"><span class="linenos">213</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-214"><a href="#I2C.I2CDevice-214"><span class="linenos">214</span></a><span class="sd">            Writes data to the I2C bus</span>
</span><span id="I2C.I2CDevice-215"><a href="#I2C.I2CDevice-215"><span class="linenos">215</span></a>
</span><span id="I2C.I2CDevice-216"><a href="#I2C.I2CDevice-216"><span class="linenos">216</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice-217"><a href="#I2C.I2CDevice-217"><span class="linenos">217</span></a><span class="sd">                data: the data to write</span>
</span><span id="I2C.I2CDevice-218"><a href="#I2C.I2CDevice-218"><span class="linenos">218</span></a>
</span><span id="I2C.I2CDevice-219"><a href="#I2C.I2CDevice-219"><span class="linenos">219</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.I2CDevice-220"><a href="#I2C.I2CDevice-220"><span class="linenos">220</span></a><span class="sd">                The number of bytes written</span>
</span><span id="I2C.I2CDevice-221"><a href="#I2C.I2CDevice-221"><span class="linenos">221</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice-222"><a href="#I2C.I2CDevice-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class to read and write data to an I2C bus,
based on the <code>I2CDev</code> class from <a href="https://github.com/siemer/ddcci">ddcci.py</a></p>
</div>


                            <div id="I2C.I2CDevice.__init__" class="classattr">
                                        <input id="I2C.I2CDevice.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">I2C.I2CDevice</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fname</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">slave_addr</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="I2C.I2CDevice.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.I2CDevice.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.I2CDevice.__init__-190"><a href="#I2C.I2CDevice.__init__-190"><span class="linenos">190</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="I2C.I2CDevice.__init__-191"><a href="#I2C.I2CDevice.__init__-191"><span class="linenos">191</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.__init__-192"><a href="#I2C.I2CDevice.__init__-192"><span class="linenos">192</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice.__init__-193"><a href="#I2C.I2CDevice.__init__-193"><span class="linenos">193</span></a><span class="sd">                fname: the I2C path, eg: `/dev/i2c-2`</span>
</span><span id="I2C.I2CDevice.__init__-194"><a href="#I2C.I2CDevice.__init__-194"><span class="linenos">194</span></a><span class="sd">                slave_addr: not entirely sure what this is meant to be</span>
</span><span id="I2C.I2CDevice.__init__-195"><a href="#I2C.I2CDevice.__init__-195"><span class="linenos">195</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.__init__-196"><a href="#I2C.I2CDevice.__init__-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span><span class="p">)</span>
</span><span id="I2C.I2CDevice.__init__-197"><a href="#I2C.I2CDevice.__init__-197"><span class="linenos">197</span></a>            <span class="c1"># I2C_SLAVE address setup</span>
</span><span id="I2C.I2CDevice.__init__-198"><a href="#I2C.I2CDevice.__init__-198"><span class="linenos">198</span></a>            <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">I2C_SLAVE</span><span class="p">,</span> <span class="n">slave_addr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>fname:</strong>  the I2C path, eg: <code>/dev/i2c-2</code></li>
<li><strong>slave_addr:</strong>  not entirely sure what this is meant to be</li>
</ul>
</div>


                            </div>
                            <div id="I2C.I2CDevice.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span>

        
    </div>
    <a class="headerlink" href="#I2C.I2CDevice.device"></a>
    
    

                            </div>
                            <div id="I2C.I2CDevice.read" class="classattr">
                                        <input id="I2C.I2CDevice.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">length</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="I2C.I2CDevice.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.I2CDevice.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.I2CDevice.read-200"><a href="#I2C.I2CDevice.read-200"><span class="linenos">200</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C.I2CDevice.read-201"><a href="#I2C.I2CDevice.read-201"><span class="linenos">201</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.read-202"><a href="#I2C.I2CDevice.read-202"><span class="linenos">202</span></a><span class="sd">            Read a certain number of bytes from the I2C bus</span>
</span><span id="I2C.I2CDevice.read-203"><a href="#I2C.I2CDevice.read-203"><span class="linenos">203</span></a>
</span><span id="I2C.I2CDevice.read-204"><a href="#I2C.I2CDevice.read-204"><span class="linenos">204</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice.read-205"><a href="#I2C.I2CDevice.read-205"><span class="linenos">205</span></a><span class="sd">                length: the number of bytes to read</span>
</span><span id="I2C.I2CDevice.read-206"><a href="#I2C.I2CDevice.read-206"><span class="linenos">206</span></a>
</span><span id="I2C.I2CDevice.read-207"><a href="#I2C.I2CDevice.read-207"><span class="linenos">207</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.I2CDevice.read-208"><a href="#I2C.I2CDevice.read-208"><span class="linenos">208</span></a><span class="sd">                bytes</span>
</span><span id="I2C.I2CDevice.read-209"><a href="#I2C.I2CDevice.read-209"><span class="linenos">209</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.read-210"><a href="#I2C.I2CDevice.read-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read a certain number of bytes from the I2C bus</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>length:</strong>  the number of bytes to read</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bytes</p>
</blockquote>
</div>


                            </div>
                            <div id="I2C.I2CDevice.write" class="classattr">
                                        <input id="I2C.I2CDevice.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="I2C.I2CDevice.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.I2CDevice.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.I2CDevice.write-212"><a href="#I2C.I2CDevice.write-212"><span class="linenos">212</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.I2CDevice.write-213"><a href="#I2C.I2CDevice.write-213"><span class="linenos">213</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.write-214"><a href="#I2C.I2CDevice.write-214"><span class="linenos">214</span></a><span class="sd">            Writes data to the I2C bus</span>
</span><span id="I2C.I2CDevice.write-215"><a href="#I2C.I2CDevice.write-215"><span class="linenos">215</span></a>
</span><span id="I2C.I2CDevice.write-216"><a href="#I2C.I2CDevice.write-216"><span class="linenos">216</span></a><span class="sd">            Args:</span>
</span><span id="I2C.I2CDevice.write-217"><a href="#I2C.I2CDevice.write-217"><span class="linenos">217</span></a><span class="sd">                data: the data to write</span>
</span><span id="I2C.I2CDevice.write-218"><a href="#I2C.I2CDevice.write-218"><span class="linenos">218</span></a>
</span><span id="I2C.I2CDevice.write-219"><a href="#I2C.I2CDevice.write-219"><span class="linenos">219</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.I2CDevice.write-220"><a href="#I2C.I2CDevice.write-220"><span class="linenos">220</span></a><span class="sd">                The number of bytes written</span>
</span><span id="I2C.I2CDevice.write-221"><a href="#I2C.I2CDevice.write-221"><span class="linenos">221</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.I2CDevice.write-222"><a href="#I2C.I2CDevice.write-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Writes data to the I2C bus</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data:</strong>  the data to write</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The number of bytes written</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="I2C.DDCInterface">
                            <input id="I2C.DDCInterface-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">I2C.DDCInterface</span><wbr>(<span class="base"><a href="#I2C.I2CDevice">I2C.I2CDevice</a></span>):

                <label class="view-source-button" for="I2C.DDCInterface-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface-224"><a href="#I2C.DDCInterface-224"><span class="linenos">224</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DDCInterface</span><span class="p">(</span><span class="n">I2CDevice</span><span class="p">):</span>
</span><span id="I2C.DDCInterface-225"><a href="#I2C.DDCInterface-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-226"><a href="#I2C.DDCInterface-226"><span class="linenos">226</span></a><span class="sd">        Class to send DDC (Display Data Channel) commands to an I2C device,</span>
</span><span id="I2C.DDCInterface-227"><a href="#I2C.DDCInterface-227"><span class="linenos">227</span></a><span class="sd">        based on the `Ddcci` and `Mccs` classes from [ddcci.py](https://github.com/siemer/ddcci)</span>
</span><span id="I2C.DDCInterface-228"><a href="#I2C.DDCInterface-228"><span class="linenos">228</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-229"><a href="#I2C.DDCInterface-229"><span class="linenos">229</span></a>
</span><span id="I2C.DDCInterface-230"><a href="#I2C.DDCInterface-230"><span class="linenos">230</span></a>        <span class="n">PROTOCOL_FLAG</span> <span class="o">=</span> <span class="mh">0x80</span>
</span><span id="I2C.DDCInterface-231"><a href="#I2C.DDCInterface-231"><span class="linenos">231</span></a>
</span><span id="I2C.DDCInterface-232"><a href="#I2C.DDCInterface-232"><span class="linenos">232</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2c_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="I2C.DDCInterface-233"><a href="#I2C.DDCInterface-233"><span class="linenos">233</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-234"><a href="#I2C.DDCInterface-234"><span class="linenos">234</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface-235"><a href="#I2C.DDCInterface-235"><span class="linenos">235</span></a><span class="sd">                i2c_path: the path to the I2C device, eg: `/dev/i2c-2`</span>
</span><span id="I2C.DDCInterface-236"><a href="#I2C.DDCInterface-236"><span class="linenos">236</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-237"><a href="#I2C.DDCInterface-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-238"><a href="#I2C.DDCInterface-238"><span class="linenos">238</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DDCCI_ADDR</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-239"><a href="#I2C.DDCInterface-239"><span class="linenos">239</span></a>
</span><span id="I2C.DDCInterface-240"><a href="#I2C.DDCInterface-240"><span class="linenos">240</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.DDCInterface-241"><a href="#I2C.DDCInterface-241"><span class="linenos">241</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-242"><a href="#I2C.DDCInterface-242"><span class="linenos">242</span></a><span class="sd">            Write some data to the I2C device.</span>
</span><span id="I2C.DDCInterface-243"><a href="#I2C.DDCInterface-243"><span class="linenos">243</span></a>
</span><span id="I2C.DDCInterface-244"><a href="#I2C.DDCInterface-244"><span class="linenos">244</span></a><span class="sd">            It is recommended to use `setvcp` to set VCP values on the DDC device</span>
</span><span id="I2C.DDCInterface-245"><a href="#I2C.DDCInterface-245"><span class="linenos">245</span></a><span class="sd">            instead of using this function directly.</span>
</span><span id="I2C.DDCInterface-246"><a href="#I2C.DDCInterface-246"><span class="linenos">246</span></a>
</span><span id="I2C.DDCInterface-247"><a href="#I2C.DDCInterface-247"><span class="linenos">247</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface-248"><a href="#I2C.DDCInterface-248"><span class="linenos">248</span></a><span class="sd">                *args: variable length list of arguments. This will be put</span>
</span><span id="I2C.DDCInterface-249"><a href="#I2C.DDCInterface-249"><span class="linenos">249</span></a><span class="sd">                    into a `bytearray` and wrapped up in various flags and</span>
</span><span id="I2C.DDCInterface-250"><a href="#I2C.DDCInterface-250"><span class="linenos">250</span></a><span class="sd">                    checksums before being written to the I2C device</span>
</span><span id="I2C.DDCInterface-251"><a href="#I2C.DDCInterface-251"><span class="linenos">251</span></a>
</span><span id="I2C.DDCInterface-252"><a href="#I2C.DDCInterface-252"><span class="linenos">252</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface-253"><a href="#I2C.DDCInterface-253"><span class="linenos">253</span></a><span class="sd">                The number of bytes that were written</span>
</span><span id="I2C.DDCInterface-254"><a href="#I2C.DDCInterface-254"><span class="linenos">254</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-255"><a href="#I2C.DDCInterface-255"><span class="linenos">255</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-256"><a href="#I2C.DDCInterface-256"><span class="linenos">256</span></a>
</span><span id="I2C.DDCInterface-257"><a href="#I2C.DDCInterface-257"><span class="linenos">257</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-258"><a href="#I2C.DDCInterface-258"><span class="linenos">258</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span>  <span class="c1"># add length info</span>
</span><span id="I2C.DDCInterface-259"><a href="#I2C.DDCInterface-259"><span class="linenos">259</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_W</span><span class="p">)</span>  <span class="c1"># insert source address</span>
</span><span id="I2C.DDCInterface-260"><a href="#I2C.DDCInterface-260"><span class="linenos">260</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">))</span>  <span class="c1"># checksum</span>
</span><span id="I2C.DDCInterface-261"><a href="#I2C.DDCInterface-261"><span class="linenos">261</span></a>
</span><span id="I2C.DDCInterface-262"><a href="#I2C.DDCInterface-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-263"><a href="#I2C.DDCInterface-263"><span class="linenos">263</span></a>
</span><span id="I2C.DDCInterface-264"><a href="#I2C.DDCInterface-264"><span class="linenos">264</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">setvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.DDCInterface-265"><a href="#I2C.DDCInterface-265"><span class="linenos">265</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-266"><a href="#I2C.DDCInterface-266"><span class="linenos">266</span></a><span class="sd">            Set a VCP value on the device</span>
</span><span id="I2C.DDCInterface-267"><a href="#I2C.DDCInterface-267"><span class="linenos">267</span></a>
</span><span id="I2C.DDCInterface-268"><a href="#I2C.DDCInterface-268"><span class="linenos">268</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface-269"><a href="#I2C.DDCInterface-269"><span class="linenos">269</span></a><span class="sd">                vcp_code: the VCP command to send, eg: `0x10` is brightness</span>
</span><span id="I2C.DDCInterface-270"><a href="#I2C.DDCInterface-270"><span class="linenos">270</span></a><span class="sd">                value: what to set the value to</span>
</span><span id="I2C.DDCInterface-271"><a href="#I2C.DDCInterface-271"><span class="linenos">271</span></a>
</span><span id="I2C.DDCInterface-272"><a href="#I2C.DDCInterface-272"><span class="linenos">272</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface-273"><a href="#I2C.DDCInterface-273"><span class="linenos">273</span></a><span class="sd">                The number of bytes written to the device</span>
</span><span id="I2C.DDCInterface-274"><a href="#I2C.DDCInterface-274"><span class="linenos">274</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-275"><a href="#I2C.DDCInterface-275"><span class="linenos">275</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">SET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">))</span>
</span><span id="I2C.DDCInterface-276"><a href="#I2C.DDCInterface-276"><span class="linenos">276</span></a>
</span><span id="I2C.DDCInterface-277"><a href="#I2C.DDCInterface-277"><span class="linenos">277</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C.DDCInterface-278"><a href="#I2C.DDCInterface-278"><span class="linenos">278</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-279"><a href="#I2C.DDCInterface-279"><span class="linenos">279</span></a><span class="sd">            Reads data from the DDC device.</span>
</span><span id="I2C.DDCInterface-280"><a href="#I2C.DDCInterface-280"><span class="linenos">280</span></a>
</span><span id="I2C.DDCInterface-281"><a href="#I2C.DDCInterface-281"><span class="linenos">281</span></a><span class="sd">            It is recommended to use `getvcp` to retrieve VCP values from the</span>
</span><span id="I2C.DDCInterface-282"><a href="#I2C.DDCInterface-282"><span class="linenos">282</span></a><span class="sd">            DDC device instead of using this function directly.</span>
</span><span id="I2C.DDCInterface-283"><a href="#I2C.DDCInterface-283"><span class="linenos">283</span></a>
</span><span id="I2C.DDCInterface-284"><a href="#I2C.DDCInterface-284"><span class="linenos">284</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface-285"><a href="#I2C.DDCInterface-285"><span class="linenos">285</span></a><span class="sd">                amount: the number of bytes to read</span>
</span><span id="I2C.DDCInterface-286"><a href="#I2C.DDCInterface-286"><span class="linenos">286</span></a>
</span><span id="I2C.DDCInterface-287"><a href="#I2C.DDCInterface-287"><span class="linenos">287</span></a><span class="sd">            Raises:</span>
</span><span id="I2C.DDCInterface-288"><a href="#I2C.DDCInterface-288"><span class="linenos">288</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C.DDCInterface-289"><a href="#I2C.DDCInterface-289"><span class="linenos">289</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-290"><a href="#I2C.DDCInterface-290"><span class="linenos">290</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-291"><a href="#I2C.DDCInterface-291"><span class="linenos">291</span></a>
</span><span id="I2C.DDCInterface-292"><a href="#I2C.DDCInterface-292"><span class="linenos">292</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amount</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-293"><a href="#I2C.DDCInterface-293"><span class="linenos">293</span></a>
</span><span id="I2C.DDCInterface-294"><a href="#I2C.DDCInterface-294"><span class="linenos">294</span></a>            <span class="c1"># check the bytes read</span>
</span><span id="I2C.DDCInterface-295"><a href="#I2C.DDCInterface-295"><span class="linenos">295</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C.DDCInterface-296"><a href="#I2C.DDCInterface-296"><span class="linenos">296</span></a>                <span class="s1">&#39;source address&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-297"><a href="#I2C.DDCInterface-297"><span class="linenos">297</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">)</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-298"><a href="#I2C.DDCInterface-298"><span class="linenos">298</span></a>                <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-299"><a href="#I2C.DDCInterface-299"><span class="linenos">299</span></a>            <span class="p">}</span>
</span><span id="I2C.DDCInterface-300"><a href="#I2C.DDCInterface-300"><span class="linenos">300</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C.DDCInterface-301"><a href="#I2C.DDCInterface-301"><span class="linenos">301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface-302"><a href="#I2C.DDCInterface-302"><span class="linenos">302</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface-303"><a href="#I2C.DDCInterface-303"><span class="linenos">303</span></a>
</span><span id="I2C.DDCInterface-304"><a href="#I2C.DDCInterface-304"><span class="linenos">304</span></a>            <span class="k">return</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="I2C.DDCInterface-305"><a href="#I2C.DDCInterface-305"><span class="linenos">305</span></a>
</span><span id="I2C.DDCInterface-306"><a href="#I2C.DDCInterface-306"><span class="linenos">306</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">getvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="I2C.DDCInterface-307"><a href="#I2C.DDCInterface-307"><span class="linenos">307</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-308"><a href="#I2C.DDCInterface-308"><span class="linenos">308</span></a><span class="sd">            Retrieves a VCP value from the DDC device.</span>
</span><span id="I2C.DDCInterface-309"><a href="#I2C.DDCInterface-309"><span class="linenos">309</span></a>
</span><span id="I2C.DDCInterface-310"><a href="#I2C.DDCInterface-310"><span class="linenos">310</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface-311"><a href="#I2C.DDCInterface-311"><span class="linenos">311</span></a><span class="sd">                vcp_code: the VCP value to read, eg: `0x10` is brightness</span>
</span><span id="I2C.DDCInterface-312"><a href="#I2C.DDCInterface-312"><span class="linenos">312</span></a>
</span><span id="I2C.DDCInterface-313"><a href="#I2C.DDCInterface-313"><span class="linenos">313</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface-314"><a href="#I2C.DDCInterface-314"><span class="linenos">314</span></a><span class="sd">                The current and maximum value respectively</span>
</span><span id="I2C.DDCInterface-315"><a href="#I2C.DDCInterface-315"><span class="linenos">315</span></a>
</span><span id="I2C.DDCInterface-316"><a href="#I2C.DDCInterface-316"><span class="linenos">316</span></a><span class="sd">            Raises:</span>
</span><span id="I2C.DDCInterface-317"><a href="#I2C.DDCInterface-317"><span class="linenos">317</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C.DDCInterface-318"><a href="#I2C.DDCInterface-318"><span class="linenos">318</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface-319"><a href="#I2C.DDCInterface-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-320"><a href="#I2C.DDCInterface-320"><span class="linenos">320</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span><span id="I2C.DDCInterface-321"><a href="#I2C.DDCInterface-321"><span class="linenos">321</span></a>
</span><span id="I2C.DDCInterface-322"><a href="#I2C.DDCInterface-322"><span class="linenos">322</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C.DDCInterface-323"><a href="#I2C.DDCInterface-323"><span class="linenos">323</span></a>                <span class="s1">&#39;is feature reply&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_REPLY</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-324"><a href="#I2C.DDCInterface-324"><span class="linenos">324</span></a>                <span class="s1">&#39;supported VCP opcode&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-325"><a href="#I2C.DDCInterface-325"><span class="linenos">325</span></a>                <span class="s1">&#39;answer matches request&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">vcp_code</span><span class="p">,</span>
</span><span id="I2C.DDCInterface-326"><a href="#I2C.DDCInterface-326"><span class="linenos">326</span></a>            <span class="p">}</span>
</span><span id="I2C.DDCInterface-327"><a href="#I2C.DDCInterface-327"><span class="linenos">327</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C.DDCInterface-328"><a href="#I2C.DDCInterface-328"><span class="linenos">328</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface-329"><a href="#I2C.DDCInterface-329"><span class="linenos">329</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface-330"><a href="#I2C.DDCInterface-330"><span class="linenos">330</span></a>
</span><span id="I2C.DDCInterface-331"><a href="#I2C.DDCInterface-331"><span class="linenos">331</span></a>            <span class="c1"># current and max values</span>
</span><span id="I2C.DDCInterface-332"><a href="#I2C.DDCInterface-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Class to send DDC (Display Data Channel) commands to an I2C device,
based on the <code>Ddcci</code> and <code>Mccs</code> classes from <a href="https://github.com/siemer/ddcci">ddcci.py</a></p>
</div>


                            <div id="I2C.DDCInterface.__init__" class="classattr">
                                        <input id="I2C.DDCInterface.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">I2C.DDCInterface</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i2c_path</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="I2C.DDCInterface.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface.__init__-232"><a href="#I2C.DDCInterface.__init__-232"><span class="linenos">232</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i2c_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="I2C.DDCInterface.__init__-233"><a href="#I2C.DDCInterface.__init__-233"><span class="linenos">233</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.__init__-234"><a href="#I2C.DDCInterface.__init__-234"><span class="linenos">234</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface.__init__-235"><a href="#I2C.DDCInterface.__init__-235"><span class="linenos">235</span></a><span class="sd">                i2c_path: the path to the I2C device, eg: `/dev/i2c-2`</span>
</span><span id="I2C.DDCInterface.__init__-236"><a href="#I2C.DDCInterface.__init__-236"><span class="linenos">236</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.__init__-237"><a href="#I2C.DDCInterface.__init__-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.__init__-238"><a href="#I2C.DDCInterface.__init__-238"><span class="linenos">238</span></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">i2c_path</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DDCCI_ADDR</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>i2c_path:</strong>  the path to the I2C device, eg: <code>/dev/i2c-2</code></li>
</ul>
</div>


                            </div>
                            <div id="I2C.DDCInterface.PROTOCOL_FLAG" class="classattr">
                                <div class="attr variable">
            <span class="name">PROTOCOL_FLAG</span>        =
<span class="default_value">128</span>

        
    </div>
    <a class="headerlink" href="#I2C.DDCInterface.PROTOCOL_FLAG"></a>
    
    

                            </div>
                            <div id="I2C.DDCInterface.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#I2C.DDCInterface.logger"></a>
    
    

                            </div>
                            <div id="I2C.DDCInterface.write" class="classattr">
                                        <input id="I2C.DDCInterface.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="I2C.DDCInterface.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface.write-240"><a href="#I2C.DDCInterface.write-240"><span class="linenos">240</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.DDCInterface.write-241"><a href="#I2C.DDCInterface.write-241"><span class="linenos">241</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.write-242"><a href="#I2C.DDCInterface.write-242"><span class="linenos">242</span></a><span class="sd">            Write some data to the I2C device.</span>
</span><span id="I2C.DDCInterface.write-243"><a href="#I2C.DDCInterface.write-243"><span class="linenos">243</span></a>
</span><span id="I2C.DDCInterface.write-244"><a href="#I2C.DDCInterface.write-244"><span class="linenos">244</span></a><span class="sd">            It is recommended to use `setvcp` to set VCP values on the DDC device</span>
</span><span id="I2C.DDCInterface.write-245"><a href="#I2C.DDCInterface.write-245"><span class="linenos">245</span></a><span class="sd">            instead of using this function directly.</span>
</span><span id="I2C.DDCInterface.write-246"><a href="#I2C.DDCInterface.write-246"><span class="linenos">246</span></a>
</span><span id="I2C.DDCInterface.write-247"><a href="#I2C.DDCInterface.write-247"><span class="linenos">247</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface.write-248"><a href="#I2C.DDCInterface.write-248"><span class="linenos">248</span></a><span class="sd">                *args: variable length list of arguments. This will be put</span>
</span><span id="I2C.DDCInterface.write-249"><a href="#I2C.DDCInterface.write-249"><span class="linenos">249</span></a><span class="sd">                    into a `bytearray` and wrapped up in various flags and</span>
</span><span id="I2C.DDCInterface.write-250"><a href="#I2C.DDCInterface.write-250"><span class="linenos">250</span></a><span class="sd">                    checksums before being written to the I2C device</span>
</span><span id="I2C.DDCInterface.write-251"><a href="#I2C.DDCInterface.write-251"><span class="linenos">251</span></a>
</span><span id="I2C.DDCInterface.write-252"><a href="#I2C.DDCInterface.write-252"><span class="linenos">252</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface.write-253"><a href="#I2C.DDCInterface.write-253"><span class="linenos">253</span></a><span class="sd">                The number of bytes that were written</span>
</span><span id="I2C.DDCInterface.write-254"><a href="#I2C.DDCInterface.write-254"><span class="linenos">254</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.write-255"><a href="#I2C.DDCInterface.write-255"><span class="linenos">255</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.write-256"><a href="#I2C.DDCInterface.write-256"><span class="linenos">256</span></a>
</span><span id="I2C.DDCInterface.write-257"><a href="#I2C.DDCInterface.write-257"><span class="linenos">257</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.write-258"><a href="#I2C.DDCInterface.write-258"><span class="linenos">258</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span>  <span class="c1"># add length info</span>
</span><span id="I2C.DDCInterface.write-259"><a href="#I2C.DDCInterface.write-259"><span class="linenos">259</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_W</span><span class="p">)</span>  <span class="c1"># insert source address</span>
</span><span id="I2C.DDCInterface.write-260"><a href="#I2C.DDCInterface.write-260"><span class="linenos">260</span></a>            <span class="n">ba</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">))</span>  <span class="c1"># checksum</span>
</span><span id="I2C.DDCInterface.write-261"><a href="#I2C.DDCInterface.write-261"><span class="linenos">261</span></a>
</span><span id="I2C.DDCInterface.write-262"><a href="#I2C.DDCInterface.write-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write some data to the I2C device.</p>

<p>It is recommended to use <code><a href="#I2C.DDCInterface.setvcp">setvcp</a></code> to set VCP values on the DDC device
instead of using this function directly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*args:</strong>  variable length list of arguments. This will be put
into a <code>bytearray</code> and wrapped up in various flags and
checksums before being written to the I2C device</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The number of bytes that were written</p>
</blockquote>
</div>


                            </div>
                            <div id="I2C.DDCInterface.setvcp" class="classattr">
                                        <input id="I2C.DDCInterface.setvcp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setvcp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="I2C.DDCInterface.setvcp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface.setvcp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface.setvcp-264"><a href="#I2C.DDCInterface.setvcp-264"><span class="linenos">264</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">setvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="I2C.DDCInterface.setvcp-265"><a href="#I2C.DDCInterface.setvcp-265"><span class="linenos">265</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.setvcp-266"><a href="#I2C.DDCInterface.setvcp-266"><span class="linenos">266</span></a><span class="sd">            Set a VCP value on the device</span>
</span><span id="I2C.DDCInterface.setvcp-267"><a href="#I2C.DDCInterface.setvcp-267"><span class="linenos">267</span></a>
</span><span id="I2C.DDCInterface.setvcp-268"><a href="#I2C.DDCInterface.setvcp-268"><span class="linenos">268</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface.setvcp-269"><a href="#I2C.DDCInterface.setvcp-269"><span class="linenos">269</span></a><span class="sd">                vcp_code: the VCP command to send, eg: `0x10` is brightness</span>
</span><span id="I2C.DDCInterface.setvcp-270"><a href="#I2C.DDCInterface.setvcp-270"><span class="linenos">270</span></a><span class="sd">                value: what to set the value to</span>
</span><span id="I2C.DDCInterface.setvcp-271"><a href="#I2C.DDCInterface.setvcp-271"><span class="linenos">271</span></a>
</span><span id="I2C.DDCInterface.setvcp-272"><a href="#I2C.DDCInterface.setvcp-272"><span class="linenos">272</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface.setvcp-273"><a href="#I2C.DDCInterface.setvcp-273"><span class="linenos">273</span></a><span class="sd">                The number of bytes written to the device</span>
</span><span id="I2C.DDCInterface.setvcp-274"><a href="#I2C.DDCInterface.setvcp-274"><span class="linenos">274</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.setvcp-275"><a href="#I2C.DDCInterface.setvcp-275"><span class="linenos">275</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">SET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Set a VCP value on the device</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>vcp_code:</strong>  the VCP command to send, eg: <code>0x10</code> is brightness</li>
<li><strong>value:</strong>  what to set the value to</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The number of bytes written to the device</p>
</blockquote>
</div>


                            </div>
                            <div id="I2C.DDCInterface.read" class="classattr">
                                        <input id="I2C.DDCInterface.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">amount</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="I2C.DDCInterface.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface.read-277"><a href="#I2C.DDCInterface.read-277"><span class="linenos">277</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="I2C.DDCInterface.read-278"><a href="#I2C.DDCInterface.read-278"><span class="linenos">278</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.read-279"><a href="#I2C.DDCInterface.read-279"><span class="linenos">279</span></a><span class="sd">            Reads data from the DDC device.</span>
</span><span id="I2C.DDCInterface.read-280"><a href="#I2C.DDCInterface.read-280"><span class="linenos">280</span></a>
</span><span id="I2C.DDCInterface.read-281"><a href="#I2C.DDCInterface.read-281"><span class="linenos">281</span></a><span class="sd">            It is recommended to use `getvcp` to retrieve VCP values from the</span>
</span><span id="I2C.DDCInterface.read-282"><a href="#I2C.DDCInterface.read-282"><span class="linenos">282</span></a><span class="sd">            DDC device instead of using this function directly.</span>
</span><span id="I2C.DDCInterface.read-283"><a href="#I2C.DDCInterface.read-283"><span class="linenos">283</span></a>
</span><span id="I2C.DDCInterface.read-284"><a href="#I2C.DDCInterface.read-284"><span class="linenos">284</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface.read-285"><a href="#I2C.DDCInterface.read-285"><span class="linenos">285</span></a><span class="sd">                amount: the number of bytes to read</span>
</span><span id="I2C.DDCInterface.read-286"><a href="#I2C.DDCInterface.read-286"><span class="linenos">286</span></a>
</span><span id="I2C.DDCInterface.read-287"><a href="#I2C.DDCInterface.read-287"><span class="linenos">287</span></a><span class="sd">            Raises:</span>
</span><span id="I2C.DDCInterface.read-288"><a href="#I2C.DDCInterface.read-288"><span class="linenos">288</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C.DDCInterface.read-289"><a href="#I2C.DDCInterface.read-289"><span class="linenos">289</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.read-290"><a href="#I2C.DDCInterface.read-290"><span class="linenos">290</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">WAIT_TIME</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.read-291"><a href="#I2C.DDCInterface.read-291"><span class="linenos">291</span></a>
</span><span id="I2C.DDCInterface.read-292"><a href="#I2C.DDCInterface.read-292"><span class="linenos">292</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amount</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.read-293"><a href="#I2C.DDCInterface.read-293"><span class="linenos">293</span></a>
</span><span id="I2C.DDCInterface.read-294"><a href="#I2C.DDCInterface.read-294"><span class="linenos">294</span></a>            <span class="c1"># check the bytes read</span>
</span><span id="I2C.DDCInterface.read-295"><a href="#I2C.DDCInterface.read-295"><span class="linenos">295</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C.DDCInterface.read-296"><a href="#I2C.DDCInterface.read-296"><span class="linenos">296</span></a>                <span class="s1">&#39;source address&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">DESTINATION_ADDR_W</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.read-297"><a href="#I2C.DDCInterface.read-297"><span class="linenos">297</span></a>                <span class="s1">&#39;checksum&#39;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">ba</span><span class="p">)</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">HOST_ADDR_R</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.read-298"><a href="#I2C.DDCInterface.read-298"><span class="linenos">298</span></a>                <span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">PROTOCOL_FLAG</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.read-299"><a href="#I2C.DDCInterface.read-299"><span class="linenos">299</span></a>            <span class="p">}</span>
</span><span id="I2C.DDCInterface.read-300"><a href="#I2C.DDCInterface.read-300"><span class="linenos">300</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C.DDCInterface.read-301"><a href="#I2C.DDCInterface.read-301"><span class="linenos">301</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface.read-302"><a href="#I2C.DDCInterface.read-302"><span class="linenos">302</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface.read-303"><a href="#I2C.DDCInterface.read-303"><span class="linenos">303</span></a>
</span><span id="I2C.DDCInterface.read-304"><a href="#I2C.DDCInterface.read-304"><span class="linenos">304</span></a>            <span class="k">return</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Reads data from the DDC device.</p>

<p>It is recommended to use <code><a href="#I2C.DDCInterface.getvcp">getvcp</a></code> to retrieve VCP values from the
DDC device instead of using this function directly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>amount:</strong>  the number of bytes to read</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  if the read data is deemed invalid</li>
</ul>
</div>


                            </div>
                            <div id="I2C.DDCInterface.getvcp" class="classattr">
                                        <input id="I2C.DDCInterface.getvcp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getvcp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="I2C.DDCInterface.getvcp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#I2C.DDCInterface.getvcp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="I2C.DDCInterface.getvcp-306"><a href="#I2C.DDCInterface.getvcp-306"><span class="linenos">306</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">getvcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="I2C.DDCInterface.getvcp-307"><a href="#I2C.DDCInterface.getvcp-307"><span class="linenos">307</span></a><span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.getvcp-308"><a href="#I2C.DDCInterface.getvcp-308"><span class="linenos">308</span></a><span class="sd">            Retrieves a VCP value from the DDC device.</span>
</span><span id="I2C.DDCInterface.getvcp-309"><a href="#I2C.DDCInterface.getvcp-309"><span class="linenos">309</span></a>
</span><span id="I2C.DDCInterface.getvcp-310"><a href="#I2C.DDCInterface.getvcp-310"><span class="linenos">310</span></a><span class="sd">            Args:</span>
</span><span id="I2C.DDCInterface.getvcp-311"><a href="#I2C.DDCInterface.getvcp-311"><span class="linenos">311</span></a><span class="sd">                vcp_code: the VCP value to read, eg: `0x10` is brightness</span>
</span><span id="I2C.DDCInterface.getvcp-312"><a href="#I2C.DDCInterface.getvcp-312"><span class="linenos">312</span></a>
</span><span id="I2C.DDCInterface.getvcp-313"><a href="#I2C.DDCInterface.getvcp-313"><span class="linenos">313</span></a><span class="sd">            Returns:</span>
</span><span id="I2C.DDCInterface.getvcp-314"><a href="#I2C.DDCInterface.getvcp-314"><span class="linenos">314</span></a><span class="sd">                The current and maximum value respectively</span>
</span><span id="I2C.DDCInterface.getvcp-315"><a href="#I2C.DDCInterface.getvcp-315"><span class="linenos">315</span></a>
</span><span id="I2C.DDCInterface.getvcp-316"><a href="#I2C.DDCInterface.getvcp-316"><span class="linenos">316</span></a><span class="sd">            Raises:</span>
</span><span id="I2C.DDCInterface.getvcp-317"><a href="#I2C.DDCInterface.getvcp-317"><span class="linenos">317</span></a><span class="sd">                ValueError: if the read data is deemed invalid</span>
</span><span id="I2C.DDCInterface.getvcp-318"><a href="#I2C.DDCInterface.getvcp-318"><span class="linenos">318</span></a><span class="sd">            &#39;&#39;&#39;</span>
</span><span id="I2C.DDCInterface.getvcp-319"><a href="#I2C.DDCInterface.getvcp-319"><span class="linenos">319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_CMD</span><span class="p">,</span> <span class="n">vcp_code</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.getvcp-320"><a href="#I2C.DDCInterface.getvcp-320"><span class="linenos">320</span></a>            <span class="n">ba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</span><span id="I2C.DDCInterface.getvcp-321"><a href="#I2C.DDCInterface.getvcp-321"><span class="linenos">321</span></a>
</span><span id="I2C.DDCInterface.getvcp-322"><a href="#I2C.DDCInterface.getvcp-322"><span class="linenos">322</span></a>            <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="I2C.DDCInterface.getvcp-323"><a href="#I2C.DDCInterface.getvcp-323"><span class="linenos">323</span></a>                <span class="s1">&#39;is feature reply&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">I2C</span><span class="o">.</span><span class="n">GET_VCP_REPLY</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.getvcp-324"><a href="#I2C.DDCInterface.getvcp-324"><span class="linenos">324</span></a>                <span class="s1">&#39;supported VCP opcode&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.getvcp-325"><a href="#I2C.DDCInterface.getvcp-325"><span class="linenos">325</span></a>                <span class="s1">&#39;answer matches request&#39;</span><span class="p">:</span> <span class="n">ba</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">vcp_code</span><span class="p">,</span>
</span><span id="I2C.DDCInterface.getvcp-326"><a href="#I2C.DDCInterface.getvcp-326"><span class="linenos">326</span></a>            <span class="p">}</span>
</span><span id="I2C.DDCInterface.getvcp-327"><a href="#I2C.DDCInterface.getvcp-327"><span class="linenos">327</span></a>            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="n">checks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="I2C.DDCInterface.getvcp-328"><a href="#I2C.DDCInterface.getvcp-328"><span class="linenos">328</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface.getvcp-329"><a href="#I2C.DDCInterface.getvcp-329"><span class="linenos">329</span></a>                <span class="k">raise</span> <span class="n">I2CValidationError</span><span class="p">(</span><span class="s1">&#39;i2c read check failed: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">checks</span><span class="p">))</span>
</span><span id="I2C.DDCInterface.getvcp-330"><a href="#I2C.DDCInterface.getvcp-330"><span class="linenos">330</span></a>
</span><span id="I2C.DDCInterface.getvcp-331"><a href="#I2C.DDCInterface.getvcp-331"><span class="linenos">331</span></a>            <span class="c1"># current and max values</span>
</span><span id="I2C.DDCInterface.getvcp-332"><a href="#I2C.DDCInterface.getvcp-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">ba</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves a VCP value from the DDC device.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>vcp_code:</strong>  the VCP value to read, eg: <code>0x10</code> is brightness</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The current and maximum value respectively</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  if the read data is deemed invalid</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#I2C.I2CDevice">I2C.I2CDevice</a></dt>
                                <dd id="I2C.DDCInterface.device" class="variable"><a href="#I2C.I2CDevice.device">device</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="XRandr">
                            <input id="XRandr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">XRandr</span><wbr>(<span class="base"><a href="helpers.html#BrightnessMethodAdv">screen_brightness_control.helpers.BrightnessMethodAdv</a></span>):

                <label class="view-source-button" for="XRandr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XRandr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XRandr-435"><a href="#XRandr-435"><span class="linenos">435</span></a><span class="k">class</span><span class="w"> </span><span class="nc">XRandr</span><span class="p">(</span><span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="XRandr-436"><a href="#XRandr-436"><span class="linenos">436</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="XRandr-437"><a href="#XRandr-437"><span class="linenos">437</span></a><span class="sd">    .. warning:: Deprecated</span>
</span><span id="XRandr-438"><a href="#XRandr-438"><span class="linenos">438</span></a><span class="sd">       The XRandr brightness method has been deprecated and will be removed in a future release.</span>
</span><span id="XRandr-439"><a href="#XRandr-439"><span class="linenos">439</span></a><span class="sd">       XRandr only works on X11, which is starting to be dropped by most distributions.</span>
</span><span id="XRandr-440"><a href="#XRandr-440"><span class="linenos">440</span></a><span class="sd">       Furthermore, the xrandr executable doesn&#39;t change backlight brightness like the other methods here,</span>
</span><span id="XRandr-441"><a href="#XRandr-441"><span class="linenos">441</span></a><span class="sd">       but changes the gamma instead, making the behaviour inconsistent with the rest of the library.</span>
</span><span id="XRandr-442"><a href="#XRandr-442"><span class="linenos">442</span></a>
</span><span id="XRandr-443"><a href="#XRandr-443"><span class="linenos">443</span></a><span class="sd">    Collection of screen brightness related methods using the xrandr executable</span>
</span><span id="XRandr-444"><a href="#XRandr-444"><span class="linenos">444</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="XRandr-445"><a href="#XRandr-445"><span class="linenos">445</span></a>
</span><span id="XRandr-446"><a href="#XRandr-446"><span class="linenos">446</span></a>    <span class="n">executable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;xrandr&#39;</span>
</span><span id="XRandr-447"><a href="#XRandr-447"><span class="linenos">447</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;the xrandr executable to be called&#39;&#39;&#39;</span>
</span><span id="XRandr-448"><a href="#XRandr-448"><span class="linenos">448</span></a>
</span><span id="XRandr-449"><a href="#XRandr-449"><span class="linenos">449</span></a>    <span class="nd">@staticmethod</span>
</span><span id="XRandr-450"><a href="#XRandr-450"><span class="linenos">450</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_uid</span><span class="p">(</span><span class="n">interface</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="XRandr-451"><a href="#XRandr-451"><span class="linenos">451</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="XRandr-452"><a href="#XRandr-452"><span class="linenos">452</span></a><span class="sd">        Attempts to find a UID (I2C bus path) for a given display interface.</span>
</span><span id="XRandr-453"><a href="#XRandr-453"><span class="linenos">453</span></a>
</span><span id="XRandr-454"><a href="#XRandr-454"><span class="linenos">454</span></a><span class="sd">        This works by parsing the interface name and matching it up to the entries in `/sys/class/drm`.</span>
</span><span id="XRandr-455"><a href="#XRandr-455"><span class="linenos">455</span></a><span class="sd">        `i2c_bus_from_drm_device` is then used to extract the bus number</span>
</span><span id="XRandr-456"><a href="#XRandr-456"><span class="linenos">456</span></a>
</span><span id="XRandr-457"><a href="#XRandr-457"><span class="linenos">457</span></a><span class="sd">        Args:</span>
</span><span id="XRandr-458"><a href="#XRandr-458"><span class="linenos">458</span></a><span class="sd">            interface: the interface in question. EG: `eDP-1`, `eDP1`, `HDMI-1`...</span>
</span><span id="XRandr-459"><a href="#XRandr-459"><span class="linenos">459</span></a>
</span><span id="XRandr-460"><a href="#XRandr-460"><span class="linenos">460</span></a><span class="sd">        Returns:</span>
</span><span id="XRandr-461"><a href="#XRandr-461"><span class="linenos">461</span></a><span class="sd">            The bus number as a string if found. Otherwise, none.</span>
</span><span id="XRandr-462"><a href="#XRandr-462"><span class="linenos">462</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="XRandr-463"><a href="#XRandr-463"><span class="linenos">463</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm&#39;</span><span class="p">):</span>
</span><span id="XRandr-464"><a href="#XRandr-464"><span class="linenos">464</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="XRandr-465"><a href="#XRandr-465"><span class="linenos">465</span></a>
</span><span id="XRandr-466"><a href="#XRandr-466"><span class="linenos">466</span></a>        <span class="c1"># use regex because sometimes it can be `eDP-1` and sometimes it&#39;s `eDP1`</span>
</span><span id="XRandr-467"><a href="#XRandr-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="n">interface_match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([a-z]+)-?(\d+)&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
</span><span id="XRandr-468"><a href="#XRandr-468"><span class="linenos">468</span></a>            <span class="n">interface</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">interface_match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</span><span id="XRandr-469"><a href="#XRandr-469"><span class="linenos">469</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="XRandr-470"><a href="#XRandr-470"><span class="linenos">470</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="XRandr-471"><a href="#XRandr-471"><span class="linenos">471</span></a>
</span><span id="XRandr-472"><a href="#XRandr-472"><span class="linenos">472</span></a>        <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/sys/class/drm/&#39;</span><span class="p">):</span>
</span><span id="XRandr-473"><a href="#XRandr-473"><span class="linenos">473</span></a>            <span class="c1"># use regex here for case insensitivity on the interface</span>
</span><span id="XRandr-474"><a href="#XRandr-474"><span class="linenos">474</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;card\d+-</span><span class="si">%s</span><span class="s1">(?:-[A-Z])?-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">count</span><span class="p">),</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
</span><span id="XRandr-475"><a href="#XRandr-475"><span class="linenos">475</span></a>                <span class="k">continue</span>
</span><span id="XRandr-476"><a href="#XRandr-476"><span class="linenos">476</span></a>            <span class="nb">dir</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;/sys/class/drm/</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="XRandr-477"><a href="#XRandr-477"><span class="linenos">477</span></a>            <span class="k">if</span> <span class="n">bus</span> <span class="o">:=</span> <span class="n">i2c_bus_from_drm_device</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
</span><span id="XRandr-478"><a href="#XRandr-478"><span class="linenos">478</span></a>                <span class="k">return</span> <span class="n">bus</span>
</span><span id="XRandr-479"><a href="#XRandr-479"><span class="linenos">479</span></a>
</span><span id="XRandr-480"><a href="#XRandr-480"><span class="linenos">480</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr-481"><a href="#XRandr-481"><span class="linenos">481</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_gdi</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="XRandr-482"><a href="#XRandr-482"><span class="linenos">482</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="XRandr-483"><a href="#XRandr-483"><span class="linenos">483</span></a><span class="sd">        .. warning:: Don&#39;t use this</span>
</span><span id="XRandr-484"><a href="#XRandr-484"><span class="linenos">484</span></a><span class="sd">           This function isn&#39;t final and I will probably make breaking changes to it.</span>
</span><span id="XRandr-485"><a href="#XRandr-485"><span class="linenos">485</span></a><span class="sd">           You have been warned</span>
</span><span id="XRandr-486"><a href="#XRandr-486"><span class="linenos">486</span></a>
</span><span id="XRandr-487"><a href="#XRandr-487"><span class="linenos">487</span></a><span class="sd">        Gets all displays reported by XRandr even if they&#39;re not supported</span>
</span><span id="XRandr-488"><a href="#XRandr-488"><span class="linenos">488</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="XRandr-489"><a href="#XRandr-489"><span class="linenos">489</span></a>        <span class="n">xrandr_output</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;--verbose&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="XRandr-490"><a href="#XRandr-490"><span class="linenos">490</span></a>
</span><span id="XRandr-491"><a href="#XRandr-491"><span class="linenos">491</span></a>        <span class="n">display_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="XRandr-492"><a href="#XRandr-492"><span class="linenos">492</span></a>        <span class="n">tmp_display</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="XRandr-493"><a href="#XRandr-493"><span class="linenos">493</span></a>
</span><span id="XRandr-494"><a href="#XRandr-494"><span class="linenos">494</span></a>        <span class="k">for</span> <span class="n">line_index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xrandr_output</span><span class="p">):</span>
</span><span id="XRandr-495"><a href="#XRandr-495"><span class="linenos">495</span></a>            <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="XRandr-496"><a href="#XRandr-496"><span class="linenos">496</span></a>                <span class="k">continue</span>
</span><span id="XRandr-497"><a href="#XRandr-497"><span class="linenos">497</span></a>
</span><span id="XRandr-498"><a href="#XRandr-498"><span class="linenos">498</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="s1">&#39;connected&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s1">&#39;disconnected&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="XRandr-499"><a href="#XRandr-499"><span class="linenos">499</span></a>                <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="XRandr-500"><a href="#XRandr-500"><span class="linenos">500</span></a>                    <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="XRandr-501"><a href="#XRandr-501"><span class="linenos">501</span></a>
</span><span id="XRandr-502"><a href="#XRandr-502"><span class="linenos">502</span></a>                <span class="n">tmp_display</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="XRandr-503"><a href="#XRandr-503"><span class="linenos">503</span></a>                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="XRandr-504"><a href="#XRandr-504"><span class="linenos">504</span></a>                    <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="XRandr-505"><a href="#XRandr-505"><span class="linenos">505</span></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="XRandr-506"><a href="#XRandr-506"><span class="linenos">506</span></a>                    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">display_count</span><span class="p">,</span>
</span><span id="XRandr-507"><a href="#XRandr-507"><span class="linenos">507</span></a>                    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="XRandr-508"><a href="#XRandr-508"><span class="linenos">508</span></a>                    <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="XRandr-509"><a href="#XRandr-509"><span class="linenos">509</span></a>                    <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="XRandr-510"><a href="#XRandr-510"><span class="linenos">510</span></a>                    <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="XRandr-511"><a href="#XRandr-511"><span class="linenos">511</span></a>                    <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="XRandr-512"><a href="#XRandr-512"><span class="linenos">512</span></a>                    <span class="s1">&#39;unsupported&#39;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;XWAYLAND&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;WAYLAND_DISPLAY&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">,</span>
</span><span id="XRandr-513"><a href="#XRandr-513"><span class="linenos">513</span></a>                    <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_uid</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="XRandr-514"><a href="#XRandr-514"><span class="linenos">514</span></a>                <span class="p">}</span>
</span><span id="XRandr-515"><a href="#XRandr-515"><span class="linenos">515</span></a>                <span class="n">display_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="XRandr-516"><a href="#XRandr-516"><span class="linenos">516</span></a>
</span><span id="XRandr-517"><a href="#XRandr-517"><span class="linenos">517</span></a>            <span class="k">elif</span> <span class="s1">&#39;EDID:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="XRandr-518"><a href="#XRandr-518"><span class="linenos">518</span></a>                <span class="c1"># extract the edid from the chunk of the output that will contain the edid</span>
</span><span id="XRandr-519"><a href="#XRandr-519"><span class="linenos">519</span></a>                <span class="n">edid</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="XRandr-520"><a href="#XRandr-520"><span class="linenos">520</span></a>                    <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrandr_output</span><span class="p">[</span><span class="n">line_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">line_index</span> <span class="o">+</span> <span class="mi">9</span><span class="p">]</span>
</span><span id="XRandr-521"><a href="#XRandr-521"><span class="linenos">521</span></a>                <span class="p">)</span>
</span><span id="XRandr-522"><a href="#XRandr-522"><span class="linenos">522</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edid</span>
</span><span id="XRandr-523"><a href="#XRandr-523"><span class="linenos">523</span></a>
</span><span id="XRandr-524"><a href="#XRandr-524"><span class="linenos">524</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="XRandr-525"><a href="#XRandr-525"><span class="linenos">525</span></a>                    <span class="p">(</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;serial&#39;</span><span class="p">),</span> <span class="n">EDID</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">])</span>
</span><span id="XRandr-526"><a href="#XRandr-526"><span class="linenos">526</span></a>                <span class="p">):</span>
</span><span id="XRandr-527"><a href="#XRandr-527"><span class="linenos">527</span></a>                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr-528"><a href="#XRandr-528"><span class="linenos">528</span></a>                        <span class="k">continue</span>
</span><span id="XRandr-529"><a href="#XRandr-529"><span class="linenos">529</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="XRandr-530"><a href="#XRandr-530"><span class="linenos">530</span></a>
</span><span id="XRandr-531"><a href="#XRandr-531"><span class="linenos">531</span></a>            <span class="k">elif</span> <span class="s1">&#39;Brightness:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="XRandr-532"><a href="#XRandr-532"><span class="linenos">532</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Brightness:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="XRandr-533"><a href="#XRandr-533"><span class="linenos">533</span></a>
</span><span id="XRandr-534"><a href="#XRandr-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="XRandr-535"><a href="#XRandr-535"><span class="linenos">535</span></a>            <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="XRandr-536"><a href="#XRandr-536"><span class="linenos">536</span></a>
</span><span id="XRandr-537"><a href="#XRandr-537"><span class="linenos">537</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr-538"><a href="#XRandr-538"><span class="linenos">538</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="XRandr-539"><a href="#XRandr-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="XRandr-540"><a href="#XRandr-540"><span class="linenos">540</span></a><span class="sd">        Implements `BrightnessMethod.get_display_info`.</span>
</span><span id="XRandr-541"><a href="#XRandr-541"><span class="linenos">541</span></a>
</span><span id="XRandr-542"><a href="#XRandr-542"><span class="linenos">542</span></a><span class="sd">        Args:</span>
</span><span id="XRandr-543"><a href="#XRandr-543"><span class="linenos">543</span></a><span class="sd">            display: the index of the specific display to query.</span>
</span><span id="XRandr-544"><a href="#XRandr-544"><span class="linenos">544</span></a><span class="sd">                If unspecified, all detected displays are queried</span>
</span><span id="XRandr-545"><a href="#XRandr-545"><span class="linenos">545</span></a><span class="sd">            brightness: whether to include the current brightness</span>
</span><span id="XRandr-546"><a href="#XRandr-546"><span class="linenos">546</span></a><span class="sd">                in the returned info</span>
</span><span id="XRandr-547"><a href="#XRandr-547"><span class="linenos">547</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="XRandr-548"><a href="#XRandr-548"><span class="linenos">548</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="XRandr-549"><a href="#XRandr-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="XRandr-550"><a href="#XRandr-550"><span class="linenos">550</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="XRandr-551"><a href="#XRandr-551"><span class="linenos">551</span></a>                <span class="k">continue</span>
</span><span id="XRandr-552"><a href="#XRandr-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">brightness</span><span class="p">:</span>
</span><span id="XRandr-553"><a href="#XRandr-553"><span class="linenos">553</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span>
</span><span id="XRandr-554"><a href="#XRandr-554"><span class="linenos">554</span></a>            <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="XRandr-555"><a href="#XRandr-555"><span class="linenos">555</span></a>            <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="XRandr-556"><a href="#XRandr-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr-557"><a href="#XRandr-557"><span class="linenos">557</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">])</span>
</span><span id="XRandr-558"><a href="#XRandr-558"><span class="linenos">558</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span><span id="XRandr-559"><a href="#XRandr-559"><span class="linenos">559</span></a>
</span><span id="XRandr-560"><a href="#XRandr-560"><span class="linenos">560</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr-561"><a href="#XRandr-561"><span class="linenos">561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="XRandr-562"><a href="#XRandr-562"><span class="linenos">562</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="XRandr-563"><a href="#XRandr-563"><span class="linenos">563</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">(</span><span class="n">brightness</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="XRandr-564"><a href="#XRandr-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr-565"><a href="#XRandr-565"><span class="linenos">565</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="XRandr-566"><a href="#XRandr-566"><span class="linenos">566</span></a>        <span class="n">brightness</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">]</span>
</span><span id="XRandr-567"><a href="#XRandr-567"><span class="linenos">567</span></a>
</span><span id="XRandr-568"><a href="#XRandr-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="n">brightness</span>
</span><span id="XRandr-569"><a href="#XRandr-569"><span class="linenos">569</span></a>
</span><span id="XRandr-570"><a href="#XRandr-570"><span class="linenos">570</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr-571"><a href="#XRandr-571"><span class="linenos">571</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="XRandr-572"><a href="#XRandr-572"><span class="linenos">572</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="XRandr-573"><a href="#XRandr-573"><span class="linenos">573</span></a>        <span class="n">value_as_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="XRandr-574"><a href="#XRandr-574"><span class="linenos">574</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="XRandr-575"><a href="#XRandr-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr-576"><a href="#XRandr-576"><span class="linenos">576</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="XRandr-577"><a href="#XRandr-577"><span class="linenos">577</span></a>
</span><span id="XRandr-578"><a href="#XRandr-578"><span class="linenos">578</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="XRandr-579"><a href="#XRandr-579"><span class="linenos">579</span></a>            <span class="n">check_output</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">],</span> <span class="s1">&#39;--brightness&#39;</span><span class="p">,</span> <span class="n">value_as_str</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><div class="pdoc-alert pdoc-alert-warning">

<h6 id="deprecated">Deprecated</h6>

<p>The XRandr brightness method has been deprecated and will be removed in a future release.
XRandr only works on X11, which is starting to be dropped by most distributions.
Furthermore, the xrandr executable doesn't change backlight brightness like the other methods here,
but changes the gamma instead, making the behaviour inconsistent with the rest of the library.</p>

</div>

<p>Collection of screen brightness related methods using the xrandr executable</p>
</div>


                            <div id="XRandr.executable" class="classattr">
                                <div class="attr variable">
            <span class="name">executable</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;xrandr&#39;</span>

        
    </div>
    <a class="headerlink" href="#XRandr.executable"></a>
    
            <div class="docstring"><p>the xrandr executable to be called</p>
</div>


                            </div>
                            <div id="XRandr.get_display_info" class="classattr">
                                        <input id="XRandr.get_display_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_display_info</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">display</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">brightness</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="XRandr.get_display_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XRandr.get_display_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XRandr.get_display_info-537"><a href="#XRandr.get_display_info-537"><span class="linenos">537</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr.get_display_info-538"><a href="#XRandr.get_display_info-538"><span class="linenos">538</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="XRandr.get_display_info-539"><a href="#XRandr.get_display_info-539"><span class="linenos">539</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="XRandr.get_display_info-540"><a href="#XRandr.get_display_info-540"><span class="linenos">540</span></a><span class="sd">        Implements `BrightnessMethod.get_display_info`.</span>
</span><span id="XRandr.get_display_info-541"><a href="#XRandr.get_display_info-541"><span class="linenos">541</span></a>
</span><span id="XRandr.get_display_info-542"><a href="#XRandr.get_display_info-542"><span class="linenos">542</span></a><span class="sd">        Args:</span>
</span><span id="XRandr.get_display_info-543"><a href="#XRandr.get_display_info-543"><span class="linenos">543</span></a><span class="sd">            display: the index of the specific display to query.</span>
</span><span id="XRandr.get_display_info-544"><a href="#XRandr.get_display_info-544"><span class="linenos">544</span></a><span class="sd">                If unspecified, all detected displays are queried</span>
</span><span id="XRandr.get_display_info-545"><a href="#XRandr.get_display_info-545"><span class="linenos">545</span></a><span class="sd">            brightness: whether to include the current brightness</span>
</span><span id="XRandr.get_display_info-546"><a href="#XRandr.get_display_info-546"><span class="linenos">546</span></a><span class="sd">                in the returned info</span>
</span><span id="XRandr.get_display_info-547"><a href="#XRandr.get_display_info-547"><span class="linenos">547</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="XRandr.get_display_info-548"><a href="#XRandr.get_display_info-548"><span class="linenos">548</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="XRandr.get_display_info-549"><a href="#XRandr.get_display_info-549"><span class="linenos">549</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="XRandr.get_display_info-550"><a href="#XRandr.get_display_info-550"><span class="linenos">550</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="XRandr.get_display_info-551"><a href="#XRandr.get_display_info-551"><span class="linenos">551</span></a>                <span class="k">continue</span>
</span><span id="XRandr.get_display_info-552"><a href="#XRandr.get_display_info-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">brightness</span><span class="p">:</span>
</span><span id="XRandr.get_display_info-553"><a href="#XRandr.get_display_info-553"><span class="linenos">553</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span>
</span><span id="XRandr.get_display_info-554"><a href="#XRandr.get_display_info-554"><span class="linenos">554</span></a>            <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="XRandr.get_display_info-555"><a href="#XRandr.get_display_info-555"><span class="linenos">555</span></a>            <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="XRandr.get_display_info-556"><a href="#XRandr.get_display_info-556"><span class="linenos">556</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr.get_display_info-557"><a href="#XRandr.get_display_info-557"><span class="linenos">557</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">])</span>
</span><span id="XRandr.get_display_info-558"><a href="#XRandr.get_display_info-558"><span class="linenos">558</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span></pre></div>


            <div class="docstring"><p>Implements <code>BrightnessMethod.get_display_info</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display:</strong>  the index of the specific display to query.
If unspecified, all detected displays are queried</li>
<li><strong>brightness:</strong>  whether to include the current brightness
in the returned info</li>
</ul>
</div>


                            </div>
                            <div id="XRandr.get_brightness" class="classattr">
                                        <input id="XRandr.get_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="XRandr.get_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XRandr.get_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XRandr.get_brightness-560"><a href="#XRandr.get_brightness-560"><span class="linenos">560</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr.get_brightness-561"><a href="#XRandr.get_brightness-561"><span class="linenos">561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="XRandr.get_brightness-562"><a href="#XRandr.get_brightness-562"><span class="linenos">562</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="XRandr.get_brightness-563"><a href="#XRandr.get_brightness-563"><span class="linenos">563</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">(</span><span class="n">brightness</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="XRandr.get_brightness-564"><a href="#XRandr.get_brightness-564"><span class="linenos">564</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr.get_brightness-565"><a href="#XRandr.get_brightness-565"><span class="linenos">565</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="XRandr.get_brightness-566"><a href="#XRandr.get_brightness-566"><span class="linenos">566</span></a>        <span class="n">brightness</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;brightness&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">]</span>
</span><span id="XRandr.get_brightness-567"><a href="#XRandr.get_brightness-567"><span class="linenos">567</span></a>
</span><span id="XRandr.get_brightness-568"><a href="#XRandr.get_brightness-568"><span class="linenos">568</span></a>        <span class="k">return</span> <span class="n">brightness</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display:</strong>  the index of the specific display to query.
If unspecified, all detected displays are queried</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of <code><a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a></code> values, one for each
  queried display</p>
</blockquote>
</div>


                            </div>
                            <div id="XRandr.set_brightness" class="classattr">
                                        <input id="XRandr.set_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">set_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="XRandr.set_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#XRandr.set_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="XRandr.set_brightness-570"><a href="#XRandr.set_brightness-570"><span class="linenos">570</span></a>    <span class="nd">@classmethod</span>
</span><span id="XRandr.set_brightness-571"><a href="#XRandr.set_brightness-571"><span class="linenos">571</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="XRandr.set_brightness-572"><a href="#XRandr.set_brightness-572"><span class="linenos">572</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The xrandr method is deprecated. Please use another brightness method&#39;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="XRandr.set_brightness-573"><a href="#XRandr.set_brightness-573"><span class="linenos">573</span></a>        <span class="n">value_as_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="XRandr.set_brightness-574"><a href="#XRandr.set_brightness-574"><span class="linenos">574</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="XRandr.set_brightness-575"><a href="#XRandr.set_brightness-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="XRandr.set_brightness-576"><a href="#XRandr.set_brightness-576"><span class="linenos">576</span></a>            <span class="n">info</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="XRandr.set_brightness-577"><a href="#XRandr.set_brightness-577"><span class="linenos">577</span></a>
</span><span id="XRandr.set_brightness-578"><a href="#XRandr.set_brightness-578"><span class="linenos">578</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
</span><span id="XRandr.set_brightness-579"><a href="#XRandr.set_brightness-579"><span class="linenos">579</span></a>            <span class="n">check_output</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;--output&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;interface&#39;</span><span class="p">],</span> <span class="s1">&#39;--brightness&#39;</span><span class="p">,</span> <span class="n">value_as_str</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>value (<a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a>):</strong>  the new brightness value</li>
<li><strong>display:</strong>  the index of the specific display to adjust.
If unspecified, all detected displays are adjusted</li>
</ul>
</div>


                            </div>
                </section>
                <section id="DDCUtil">
                            <input id="DDCUtil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DDCUtil</span><wbr>(<span class="base"><a href="helpers.html#BrightnessMethodAdv">screen_brightness_control.helpers.BrightnessMethodAdv</a></span>):

                <label class="view-source-button" for="DDCUtil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DDCUtil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DDCUtil-582"><a href="#DDCUtil-582"><span class="linenos">582</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DDCUtil</span><span class="p">(</span><span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="DDCUtil-583"><a href="#DDCUtil-583"><span class="linenos">583</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;collection of screen brightness related methods using the ddcutil executable&#39;&#39;&#39;</span>
</span><span id="DDCUtil-584"><a href="#DDCUtil-584"><span class="linenos">584</span></a>
</span><span id="DDCUtil-585"><a href="#DDCUtil-585"><span class="linenos">585</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;DDCUtil&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-586"><a href="#DDCUtil-586"><span class="linenos">586</span></a>
</span><span id="DDCUtil-587"><a href="#DDCUtil-587"><span class="linenos">587</span></a>    <span class="n">executable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ddcutil&#39;</span>
</span><span id="DDCUtil-588"><a href="#DDCUtil-588"><span class="linenos">588</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;The ddcutil executable to be called&#39;&#39;&#39;</span>
</span><span id="DDCUtil-589"><a href="#DDCUtil-589"><span class="linenos">589</span></a>    <span class="n">sleep_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span id="DDCUtil-590"><a href="#DDCUtil-590"><span class="linenos">590</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="DDCUtil-591"><a href="#DDCUtil-591"><span class="linenos">591</span></a><span class="sd">    How long ddcutil should sleep between each DDC request (lower is shorter).</span>
</span><span id="DDCUtil-592"><a href="#DDCUtil-592"><span class="linenos">592</span></a><span class="sd">    See [the ddcutil docs](https://www.ddcutil.com/performance_options/#option-sleep-multiplier).</span>
</span><span id="DDCUtil-593"><a href="#DDCUtil-593"><span class="linenos">593</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="DDCUtil-594"><a href="#DDCUtil-594"><span class="linenos">594</span></a>    <span class="n">cmd_max_tries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="DDCUtil-595"><a href="#DDCUtil-595"><span class="linenos">595</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Max number of retries when calling the ddcutil&#39;&#39;&#39;</span>
</span><span id="DDCUtil-596"><a href="#DDCUtil-596"><span class="linenos">596</span></a>    <span class="n">enable_async</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DDCUtil-597"><a href="#DDCUtil-597"><span class="linenos">597</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="DDCUtil-598"><a href="#DDCUtil-598"><span class="linenos">598</span></a><span class="sd">    Use the `--async` flag when calling ddcutil.</span>
</span><span id="DDCUtil-599"><a href="#DDCUtil-599"><span class="linenos">599</span></a><span class="sd">    See [ddcutil docs](https://www.ddcutil.com/performance_options/#option-async)</span>
</span><span id="DDCUtil-600"><a href="#DDCUtil-600"><span class="linenos">600</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="DDCUtil-601"><a href="#DDCUtil-601"><span class="linenos">601</span></a>    <span class="n">_max_brightness_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DDCUtil-602"><a href="#DDCUtil-602"><span class="linenos">602</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Cache for displays and their maximum brightness values&#39;&#39;&#39;</span>
</span><span id="DDCUtil-603"><a href="#DDCUtil-603"><span class="linenos">603</span></a>
</span><span id="DDCUtil-604"><a href="#DDCUtil-604"><span class="linenos">604</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil-605"><a href="#DDCUtil-605"><span class="linenos">605</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_gdi</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="DDCUtil-606"><a href="#DDCUtil-606"><span class="linenos">606</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="DDCUtil-607"><a href="#DDCUtil-607"><span class="linenos">607</span></a><span class="sd">        .. warning:: Don&#39;t use this</span>
</span><span id="DDCUtil-608"><a href="#DDCUtil-608"><span class="linenos">608</span></a><span class="sd">           This function isn&#39;t final and I will probably make breaking changes to it.</span>
</span><span id="DDCUtil-609"><a href="#DDCUtil-609"><span class="linenos">609</span></a><span class="sd">           You have been warned</span>
</span><span id="DDCUtil-610"><a href="#DDCUtil-610"><span class="linenos">610</span></a>
</span><span id="DDCUtil-611"><a href="#DDCUtil-611"><span class="linenos">611</span></a><span class="sd">        Gets all displays reported by DDCUtil even if they&#39;re not supported</span>
</span><span id="DDCUtil-612"><a href="#DDCUtil-612"><span class="linenos">612</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="DDCUtil-613"><a href="#DDCUtil-613"><span class="linenos">613</span></a>        <span class="n">raw_ddcutil_output</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="DDCUtil-614"><a href="#DDCUtil-614"><span class="linenos">614</span></a>            <span class="n">check_output</span><span class="p">(</span>
</span><span id="DDCUtil-615"><a href="#DDCUtil-615"><span class="linenos">615</span></a>                <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;detect&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--async&#39;</span><span class="p">]</span>
</span><span id="DDCUtil-616"><a href="#DDCUtil-616"><span class="linenos">616</span></a>                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">enable_async</span>
</span><span id="DDCUtil-617"><a href="#DDCUtil-617"><span class="linenos">617</span></a>                <span class="k">else</span> <span class="p">[],</span>
</span><span id="DDCUtil-618"><a href="#DDCUtil-618"><span class="linenos">618</span></a>                <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="DDCUtil-619"><a href="#DDCUtil-619"><span class="linenos">619</span></a>            <span class="p">)</span>
</span><span id="DDCUtil-620"><a href="#DDCUtil-620"><span class="linenos">620</span></a>        <span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-621"><a href="#DDCUtil-621"><span class="linenos">621</span></a>        <span class="c1"># Use -v to get EDID string but this means output cannot be decoded.</span>
</span><span id="DDCUtil-622"><a href="#DDCUtil-622"><span class="linenos">622</span></a>        <span class="c1"># Or maybe it can. I don&#39;t know the encoding though, so let&#39;s assume it cannot be decoded.</span>
</span><span id="DDCUtil-623"><a href="#DDCUtil-623"><span class="linenos">623</span></a>        <span class="c1"># Use str()[2:-1] workaround</span>
</span><span id="DDCUtil-624"><a href="#DDCUtil-624"><span class="linenos">624</span></a>
</span><span id="DDCUtil-625"><a href="#DDCUtil-625"><span class="linenos">625</span></a>        <span class="c1"># include &quot;Invalid display&quot; sections because they tell us where one displays metadata ends</span>
</span><span id="DDCUtil-626"><a href="#DDCUtil-626"><span class="linenos">626</span></a>        <span class="c1"># and another begins. We filter out invalid displays later on</span>
</span><span id="DDCUtil-627"><a href="#DDCUtil-627"><span class="linenos">627</span></a>        <span class="n">ddcutil_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">raw_ddcutil_output</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;Invalid display&#39;</span><span class="p">,</span> <span class="s1">&#39;Display&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">))]</span>
</span><span id="DDCUtil-628"><a href="#DDCUtil-628"><span class="linenos">628</span></a>        <span class="n">tmp_display</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DDCUtil-629"><a href="#DDCUtil-629"><span class="linenos">629</span></a>        <span class="n">display_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DDCUtil-630"><a href="#DDCUtil-630"><span class="linenos">630</span></a>
</span><span id="DDCUtil-631"><a href="#DDCUtil-631"><span class="linenos">631</span></a>        <span class="k">for</span> <span class="n">line_index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ddcutil_output</span><span class="p">):</span>
</span><span id="DDCUtil-632"><a href="#DDCUtil-632"><span class="linenos">632</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)):</span>
</span><span id="DDCUtil-633"><a href="#DDCUtil-633"><span class="linenos">633</span></a>                <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="DDCUtil-634"><a href="#DDCUtil-634"><span class="linenos">634</span></a>                    <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="DDCUtil-635"><a href="#DDCUtil-635"><span class="linenos">635</span></a>
</span><span id="DDCUtil-636"><a href="#DDCUtil-636"><span class="linenos">636</span></a>                <span class="n">tmp_display</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DDCUtil-637"><a href="#DDCUtil-637"><span class="linenos">637</span></a>                    <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="p">,</span>
</span><span id="DDCUtil-638"><a href="#DDCUtil-638"><span class="linenos">638</span></a>                    <span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">display_count</span><span class="p">,</span>
</span><span id="DDCUtil-639"><a href="#DDCUtil-639"><span class="linenos">639</span></a>                    <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-640"><a href="#DDCUtil-640"><span class="linenos">640</span></a>                    <span class="s1">&#39;serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-641"><a href="#DDCUtil-641"><span class="linenos">641</span></a>                    <span class="s1">&#39;bin_serial&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-642"><a href="#DDCUtil-642"><span class="linenos">642</span></a>                    <span class="s1">&#39;manufacturer&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-643"><a href="#DDCUtil-643"><span class="linenos">643</span></a>                    <span class="s1">&#39;manufacturer_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-644"><a href="#DDCUtil-644"><span class="linenos">644</span></a>                    <span class="s1">&#39;edid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-645"><a href="#DDCUtil-645"><span class="linenos">645</span></a>                    <span class="s1">&#39;unsupported&#39;</span><span class="p">:</span> <span class="s1">&#39;invalid display&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
</span><span id="DDCUtil-646"><a href="#DDCUtil-646"><span class="linenos">646</span></a>                    <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DDCUtil-647"><a href="#DDCUtil-647"><span class="linenos">647</span></a>                <span class="p">}</span>
</span><span id="DDCUtil-648"><a href="#DDCUtil-648"><span class="linenos">648</span></a>                <span class="n">display_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DDCUtil-649"><a href="#DDCUtil-649"><span class="linenos">649</span></a>
</span><span id="DDCUtil-650"><a href="#DDCUtil-650"><span class="linenos">650</span></a>            <span class="k">elif</span> <span class="s1">&#39;I2C bus&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-651"><a href="#DDCUtil-651"><span class="linenos">651</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">:]</span>
</span><span id="DDCUtil-652"><a href="#DDCUtil-652"><span class="linenos">652</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span><span id="DDCUtil-653"><a href="#DDCUtil-653"><span class="linenos">653</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DDCUtil-654"><a href="#DDCUtil-654"><span class="linenos">654</span></a>
</span><span id="DDCUtil-655"><a href="#DDCUtil-655"><span class="linenos">655</span></a>            <span class="k">elif</span> <span class="s1">&#39;Mfg id&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-656"><a href="#DDCUtil-656"><span class="linenos">656</span></a>                <span class="c1"># Recently ddcutil has started reporting manufacturer IDs like</span>
</span><span id="DDCUtil-657"><a href="#DDCUtil-657"><span class="linenos">657</span></a>                <span class="c1"># &#39;BNQ - UNK&#39; or &#39;MSI - Microstep&#39; so we have to split the line</span>
</span><span id="DDCUtil-658"><a href="#DDCUtil-658"><span class="linenos">658</span></a>                <span class="c1"># into chunks of alpha chars and check for a valid mfg id</span>
</span><span id="DDCUtil-659"><a href="#DDCUtil-659"><span class="linenos">659</span></a>                <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z]&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Mfg id:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
</span><span id="DDCUtil-660"><a href="#DDCUtil-660"><span class="linenos">660</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="DDCUtil-661"><a href="#DDCUtil-661"><span class="linenos">661</span></a>                        <span class="c1"># all mfg ids are 3 chars long</span>
</span><span id="DDCUtil-662"><a href="#DDCUtil-662"><span class="linenos">662</span></a>                        <span class="k">continue</span>
</span><span id="DDCUtil-663"><a href="#DDCUtil-663"><span class="linenos">663</span></a>
</span><span id="DDCUtil-664"><a href="#DDCUtil-664"><span class="linenos">664</span></a>                    <span class="k">if</span> <span class="n">brand</span> <span class="o">:=</span> <span class="n">_monitor_brand_lookup</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
</span><span id="DDCUtil-665"><a href="#DDCUtil-665"><span class="linenos">665</span></a>                        <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;manufacturer_id&#39;</span><span class="p">],</span> <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;manufacturer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brand</span>
</span><span id="DDCUtil-666"><a href="#DDCUtil-666"><span class="linenos">666</span></a>                        <span class="k">break</span>
</span><span id="DDCUtil-667"><a href="#DDCUtil-667"><span class="linenos">667</span></a>
</span><span id="DDCUtil-668"><a href="#DDCUtil-668"><span class="linenos">668</span></a>            <span class="k">elif</span> <span class="s1">&#39;Model&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-669"><a href="#DDCUtil-669"><span class="linenos">669</span></a>                <span class="c1"># the split() removes extra spaces</span>
</span><span id="DDCUtil-670"><a href="#DDCUtil-670"><span class="linenos">670</span></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Model:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="DDCUtil-671"><a href="#DDCUtil-671"><span class="linenos">671</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="DDCUtil-672"><a href="#DDCUtil-672"><span class="linenos">672</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DDCUtil-673"><a href="#DDCUtil-673"><span class="linenos">673</span></a>                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="DDCUtil-674"><a href="#DDCUtil-674"><span class="linenos">674</span></a>                    <span class="k">pass</span>
</span><span id="DDCUtil-675"><a href="#DDCUtil-675"><span class="linenos">675</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="DDCUtil-676"><a href="#DDCUtil-676"><span class="linenos">676</span></a>
</span><span id="DDCUtil-677"><a href="#DDCUtil-677"><span class="linenos">677</span></a>            <span class="k">elif</span> <span class="s1">&#39;Serial number&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-678"><a href="#DDCUtil-678"><span class="linenos">678</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Serial number:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="DDCUtil-679"><a href="#DDCUtil-679"><span class="linenos">679</span></a>
</span><span id="DDCUtil-680"><a href="#DDCUtil-680"><span class="linenos">680</span></a>            <span class="k">elif</span> <span class="s1">&#39;Binary serial number:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-681"><a href="#DDCUtil-681"><span class="linenos">681</span></a>                <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="DDCUtil-682"><a href="#DDCUtil-682"><span class="linenos">682</span></a>
</span><span id="DDCUtil-683"><a href="#DDCUtil-683"><span class="linenos">683</span></a>            <span class="k">elif</span> <span class="s1">&#39;EDID hex dump:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span><span id="DDCUtil-684"><a href="#DDCUtil-684"><span class="linenos">684</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="DDCUtil-685"><a href="#DDCUtil-685"><span class="linenos">685</span></a>                    <span class="n">tmp_display</span><span class="p">[</span><span class="s1">&#39;edid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="DDCUtil-686"><a href="#DDCUtil-686"><span class="linenos">686</span></a>                        <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="mi">17</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ddcutil_output</span><span class="p">[</span><span class="n">line_index</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">line_index</span> <span class="o">+</span> <span class="mi">10</span><span class="p">]</span>
</span><span id="DDCUtil-687"><a href="#DDCUtil-687"><span class="linenos">687</span></a>                    <span class="p">)</span>
</span><span id="DDCUtil-688"><a href="#DDCUtil-688"><span class="linenos">688</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="DDCUtil-689"><a href="#DDCUtil-689"><span class="linenos">689</span></a>                    <span class="k">pass</span>
</span><span id="DDCUtil-690"><a href="#DDCUtil-690"><span class="linenos">690</span></a>
</span><span id="DDCUtil-691"><a href="#DDCUtil-691"><span class="linenos">691</span></a>        <span class="k">if</span> <span class="n">tmp_display</span><span class="p">:</span>
</span><span id="DDCUtil-692"><a href="#DDCUtil-692"><span class="linenos">692</span></a>            <span class="k">yield</span> <span class="n">tmp_display</span>
</span><span id="DDCUtil-693"><a href="#DDCUtil-693"><span class="linenos">693</span></a>
</span><span id="DDCUtil-694"><a href="#DDCUtil-694"><span class="linenos">694</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil-695"><a href="#DDCUtil-695"><span class="linenos">695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="DDCUtil-696"><a href="#DDCUtil-696"><span class="linenos">696</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-697"><a href="#DDCUtil-697"><span class="linenos">697</span></a>        <span class="k">if</span> <span class="n">valid_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil-698"><a href="#DDCUtil-698"><span class="linenos">698</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DDCUtil-699"><a href="#DDCUtil-699"><span class="linenos">699</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="DDCUtil-700"><a href="#DDCUtil-700"><span class="linenos">700</span></a>                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="DDCUtil-701"><a href="#DDCUtil-701"><span class="linenos">701</span></a>                    <span class="k">continue</span>
</span><span id="DDCUtil-702"><a href="#DDCUtil-702"><span class="linenos">702</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="DDCUtil-703"><a href="#DDCUtil-703"><span class="linenos">703</span></a>                <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="DDCUtil-704"><a href="#DDCUtil-704"><span class="linenos">704</span></a>
</span><span id="DDCUtil-705"><a href="#DDCUtil-705"><span class="linenos">705</span></a>            <span class="k">if</span> <span class="n">valid_displays</span><span class="p">:</span>
</span><span id="DDCUtil-706"><a href="#DDCUtil-706"><span class="linenos">706</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">,</span> <span class="n">valid_displays</span><span class="p">)</span>
</span><span id="DDCUtil-707"><a href="#DDCUtil-707"><span class="linenos">707</span></a>
</span><span id="DDCUtil-708"><a href="#DDCUtil-708"><span class="linenos">708</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil-709"><a href="#DDCUtil-709"><span class="linenos">709</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="DDCUtil-710"><a href="#DDCUtil-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span><span id="DDCUtil-711"><a href="#DDCUtil-711"><span class="linenos">711</span></a>
</span><span id="DDCUtil-712"><a href="#DDCUtil-712"><span class="linenos">712</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil-713"><a href="#DDCUtil-713"><span class="linenos">713</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="DDCUtil-714"><a href="#DDCUtil-714"><span class="linenos">714</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="DDCUtil-715"><a href="#DDCUtil-715"><span class="linenos">715</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil-716"><a href="#DDCUtil-716"><span class="linenos">716</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="DDCUtil-717"><a href="#DDCUtil-717"><span class="linenos">717</span></a>
</span><span id="DDCUtil-718"><a href="#DDCUtil-718"><span class="linenos">718</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DDCUtil-719"><a href="#DDCUtil-719"><span class="linenos">719</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="DDCUtil-720"><a href="#DDCUtil-720"><span class="linenos">720</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-721"><a href="#DDCUtil-721"><span class="linenos">721</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil-722"><a href="#DDCUtil-722"><span class="linenos">722</span></a>                <span class="n">cmd_out</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DDCUtil-723"><a href="#DDCUtil-723"><span class="linenos">723</span></a>                    <span class="n">check_output</span><span class="p">(</span>
</span><span id="DDCUtil-724"><a href="#DDCUtil-724"><span class="linenos">724</span></a>                        <span class="p">[</span>
</span><span id="DDCUtil-725"><a href="#DDCUtil-725"><span class="linenos">725</span></a>                            <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="DDCUtil-726"><a href="#DDCUtil-726"><span class="linenos">726</span></a>                            <span class="s1">&#39;getvcp&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-727"><a href="#DDCUtil-727"><span class="linenos">727</span></a>                            <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-728"><a href="#DDCUtil-728"><span class="linenos">728</span></a>                            <span class="s1">&#39;-t&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-729"><a href="#DDCUtil-729"><span class="linenos">729</span></a>                            <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-730"><a href="#DDCUtil-730"><span class="linenos">730</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="DDCUtil-731"><a href="#DDCUtil-731"><span class="linenos">731</span></a>                            <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-732"><a href="#DDCUtil-732"><span class="linenos">732</span></a>                        <span class="p">],</span>
</span><span id="DDCUtil-733"><a href="#DDCUtil-733"><span class="linenos">733</span></a>                        <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="DDCUtil-734"><a href="#DDCUtil-734"><span class="linenos">734</span></a>                    <span class="p">)</span>
</span><span id="DDCUtil-735"><a href="#DDCUtil-735"><span class="linenos">735</span></a>                    <span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="DDCUtil-736"><a href="#DDCUtil-736"><span class="linenos">736</span></a>                    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="DDCUtil-737"><a href="#DDCUtil-737"><span class="linenos">737</span></a>                <span class="p">)</span>
</span><span id="DDCUtil-738"><a href="#DDCUtil-738"><span class="linenos">738</span></a>
</span><span id="DDCUtil-739"><a href="#DDCUtil-739"><span class="linenos">739</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="DDCUtil-740"><a href="#DDCUtil-740"><span class="linenos">740</span></a>                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DDCUtil-741"><a href="#DDCUtil-741"><span class="linenos">741</span></a>                <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="DDCUtil-742"><a href="#DDCUtil-742"><span class="linenos">742</span></a>                    <span class="c1"># if the max brightness is not 100 then the number is not a percentage</span>
</span><span id="DDCUtil-743"><a href="#DDCUtil-743"><span class="linenos">743</span></a>                    <span class="c1"># and will need to be scaled</span>
</span><span id="DDCUtil-744"><a href="#DDCUtil-744"><span class="linenos">744</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="DDCUtil-745"><a href="#DDCUtil-745"><span class="linenos">745</span></a>
</span><span id="DDCUtil-746"><a href="#DDCUtil-746"><span class="linenos">746</span></a>                <span class="c1"># now make sure max brightness is recorded so set_brightness can use it</span>
</span><span id="DDCUtil-747"><a href="#DDCUtil-747"><span class="linenos">747</span></a>                <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="DDCUtil-748"><a href="#DDCUtil-748"><span class="linenos">748</span></a>                <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="DDCUtil-749"><a href="#DDCUtil-749"><span class="linenos">749</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="DDCUtil-750"><a href="#DDCUtil-750"><span class="linenos">750</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-751"><a href="#DDCUtil-751"><span class="linenos">751</span></a>
</span><span id="DDCUtil-752"><a href="#DDCUtil-752"><span class="linenos">752</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DDCUtil-753"><a href="#DDCUtil-753"><span class="linenos">753</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="DDCUtil-754"><a href="#DDCUtil-754"><span class="linenos">754</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="DDCUtil-755"><a href="#DDCUtil-755"><span class="linenos">755</span></a>
</span><span id="DDCUtil-756"><a href="#DDCUtil-756"><span class="linenos">756</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil-757"><a href="#DDCUtil-757"><span class="linenos">757</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="DDCUtil-758"><a href="#DDCUtil-758"><span class="linenos">758</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="DDCUtil-759"><a href="#DDCUtil-759"><span class="linenos">759</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil-760"><a href="#DDCUtil-760"><span class="linenos">760</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="DDCUtil-761"><a href="#DDCUtil-761"><span class="linenos">761</span></a>
</span><span id="DDCUtil-762"><a href="#DDCUtil-762"><span class="linenos">762</span></a>        <span class="n">__cache__</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">startswith</span><span class="o">=</span><span class="s1">&#39;ddcutil_brightness_&#39;</span><span class="p">)</span>
</span><span id="DDCUtil-763"><a href="#DDCUtil-763"><span class="linenos">763</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="DDCUtil-764"><a href="#DDCUtil-764"><span class="linenos">764</span></a>            <span class="c1"># check if monitor has a max brightness that requires us to scale this value</span>
</span><span id="DDCUtil-765"><a href="#DDCUtil-765"><span class="linenos">765</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="DDCUtil-766"><a href="#DDCUtil-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="DDCUtil-767"><a href="#DDCUtil-767"><span class="linenos">767</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="DDCUtil-768"><a href="#DDCUtil-768"><span class="linenos">768</span></a>
</span><span id="DDCUtil-769"><a href="#DDCUtil-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="DDCUtil-770"><a href="#DDCUtil-770"><span class="linenos">770</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">])</span>
</span><span id="DDCUtil-771"><a href="#DDCUtil-771"><span class="linenos">771</span></a>
</span><span id="DDCUtil-772"><a href="#DDCUtil-772"><span class="linenos">772</span></a>            <span class="n">check_output</span><span class="p">(</span>
</span><span id="DDCUtil-773"><a href="#DDCUtil-773"><span class="linenos">773</span></a>                <span class="p">[</span>
</span><span id="DDCUtil-774"><a href="#DDCUtil-774"><span class="linenos">774</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="DDCUtil-775"><a href="#DDCUtil-775"><span class="linenos">775</span></a>                    <span class="s1">&#39;setvcp&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-776"><a href="#DDCUtil-776"><span class="linenos">776</span></a>                    <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-777"><a href="#DDCUtil-777"><span class="linenos">777</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span id="DDCUtil-778"><a href="#DDCUtil-778"><span class="linenos">778</span></a>                    <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-779"><a href="#DDCUtil-779"><span class="linenos">779</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="DDCUtil-780"><a href="#DDCUtil-780"><span class="linenos">780</span></a>                    <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="DDCUtil-781"><a href="#DDCUtil-781"><span class="linenos">781</span></a>                <span class="p">],</span>
</span><span id="DDCUtil-782"><a href="#DDCUtil-782"><span class="linenos">782</span></a>                <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="DDCUtil-783"><a href="#DDCUtil-783"><span class="linenos">783</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>collection of screen brightness related methods using the ddcutil executable</p>
</div>


                            <div id="DDCUtil.executable" class="classattr">
                                <div class="attr variable">
            <span class="name">executable</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;ddcutil&#39;</span>

        
    </div>
    <a class="headerlink" href="#DDCUtil.executable"></a>
    
            <div class="docstring"><p>The ddcutil executable to be called</p>
</div>


                            </div>
                            <div id="DDCUtil.sleep_multiplier" class="classattr">
                                <div class="attr variable">
            <span class="name">sleep_multiplier</span><span class="annotation">: float</span>        =
<span class="default_value">0.5</span>

        
    </div>
    <a class="headerlink" href="#DDCUtil.sleep_multiplier"></a>
    
            <div class="docstring"><p>How long ddcutil should sleep between each DDC request (lower is shorter).
See <a href="https://www.ddcutil.com/performance_options/#option-sleep-multiplier">the ddcutil docs</a>.</p>
</div>


                            </div>
                            <div id="DDCUtil.cmd_max_tries" class="classattr">
                                <div class="attr variable">
            <span class="name">cmd_max_tries</span><span class="annotation">: int</span>        =
<span class="default_value">10</span>

        
    </div>
    <a class="headerlink" href="#DDCUtil.cmd_max_tries"></a>
    
            <div class="docstring"><p>Max number of retries when calling the ddcutil</p>
</div>


                            </div>
                            <div id="DDCUtil.enable_async" class="classattr">
                                <div class="attr variable">
            <span class="name">enable_async</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#DDCUtil.enable_async"></a>
    
            <div class="docstring"><p>Use the <code>--async</code> flag when calling ddcutil.
See <a href="https://www.ddcutil.com/performance_options/#option-async">ddcutil docs</a></p>
</div>


                            </div>
                            <div id="DDCUtil.get_display_info" class="classattr">
                                        <input id="DDCUtil.get_display_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_display_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DDCUtil.get_display_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DDCUtil.get_display_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DDCUtil.get_display_info-694"><a href="#DDCUtil.get_display_info-694"><span class="linenos">694</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil.get_display_info-695"><a href="#DDCUtil.get_display_info-695"><span class="linenos">695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DisplayIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="DDCUtil.get_display_info-696"><a href="#DDCUtil.get_display_info-696"><span class="linenos">696</span></a>        <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">)</span>
</span><span id="DDCUtil.get_display_info-697"><a href="#DDCUtil.get_display_info-697"><span class="linenos">697</span></a>        <span class="k">if</span> <span class="n">valid_displays</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil.get_display_info-698"><a href="#DDCUtil.get_display_info-698"><span class="linenos">698</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DDCUtil.get_display_info-699"><a href="#DDCUtil.get_display_info-699"><span class="linenos">699</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_gdi</span><span class="p">():</span>
</span><span id="DDCUtil.get_display_info-700"><a href="#DDCUtil.get_display_info-700"><span class="linenos">700</span></a>                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]:</span>
</span><span id="DDCUtil.get_display_info-701"><a href="#DDCUtil.get_display_info-701"><span class="linenos">701</span></a>                    <span class="k">continue</span>
</span><span id="DDCUtil.get_display_info-702"><a href="#DDCUtil.get_display_info-702"><span class="linenos">702</span></a>                <span class="k">del</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;unsupported&#39;</span><span class="p">]</span>
</span><span id="DDCUtil.get_display_info-703"><a href="#DDCUtil.get_display_info-703"><span class="linenos">703</span></a>                <span class="n">valid_displays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="DDCUtil.get_display_info-704"><a href="#DDCUtil.get_display_info-704"><span class="linenos">704</span></a>
</span><span id="DDCUtil.get_display_info-705"><a href="#DDCUtil.get_display_info-705"><span class="linenos">705</span></a>            <span class="k">if</span> <span class="n">valid_displays</span><span class="p">:</span>
</span><span id="DDCUtil.get_display_info-706"><a href="#DDCUtil.get_display_info-706"><span class="linenos">706</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;ddcutil_monitors_info&#39;</span><span class="p">,</span> <span class="n">valid_displays</span><span class="p">)</span>
</span><span id="DDCUtil.get_display_info-707"><a href="#DDCUtil.get_display_info-707"><span class="linenos">707</span></a>
</span><span id="DDCUtil.get_display_info-708"><a href="#DDCUtil.get_display_info-708"><span class="linenos">708</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil.get_display_info-709"><a href="#DDCUtil.get_display_info-709"><span class="linenos">709</span></a>            <span class="n">valid_displays</span> <span class="o">=</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">,</span> <span class="n">haystack</span><span class="o">=</span><span class="n">valid_displays</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i2c_bus&#39;</span><span class="p">])</span>
</span><span id="DDCUtil.get_display_info-710"><a href="#DDCUtil.get_display_info-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">valid_displays</span>
</span></pre></div>


            <div class="docstring"><p>Return information about detected displays.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display (<a href="types.html#DisplayIdentifier">screen_brightness_control.types.DisplayIdentifier</a>):</strong>  the specific display to return
information about. This parameter is passed to <code>filter_monitors</code></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of dictionaries, each representing a detected display.
  Each returned dictionary will have the following keys:</p>
  
  <ul>
  <li>name (<code>str</code>): the name of the display</li>
  <li>model (<code>str</code>): the model of the display</li>
  <li>manufacturer (<code>str</code>): the name of the display manufacturer</li>
  <li>manufacturer_id (<code>str</code>): the three letter manufacturer code (see <code>MONITOR_MANUFACTURER_CODES</code>)</li>
  <li>serial (<code>str</code>): the serial of the display OR some other unique identifier</li>
  <li>edid (<code>str</code>): the EDID string for the display</li>
  <li>method (<code>BrightnessMethod</code>): the brightness method associated with this display</li>
  <li>index (<code>int</code>): the index of the display, relative to the brightness method</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="DDCUtil.get_brightness" class="classattr">
                                        <input id="DDCUtil.get_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DDCUtil.get_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DDCUtil.get_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DDCUtil.get_brightness-712"><a href="#DDCUtil.get_brightness-712"><span class="linenos">712</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil.get_brightness-713"><a href="#DDCUtil.get_brightness-713"><span class="linenos">713</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">IntPercentage</span><span class="p">]:</span>
</span><span id="DDCUtil.get_brightness-714"><a href="#DDCUtil.get_brightness-714"><span class="linenos">714</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="DDCUtil.get_brightness-715"><a href="#DDCUtil.get_brightness-715"><span class="linenos">715</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil.get_brightness-716"><a href="#DDCUtil.get_brightness-716"><span class="linenos">716</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="DDCUtil.get_brightness-717"><a href="#DDCUtil.get_brightness-717"><span class="linenos">717</span></a>
</span><span id="DDCUtil.get_brightness-718"><a href="#DDCUtil.get_brightness-718"><span class="linenos">718</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DDCUtil.get_brightness-719"><a href="#DDCUtil.get_brightness-719"><span class="linenos">719</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="DDCUtil.get_brightness-720"><a href="#DDCUtil.get_brightness-720"><span class="linenos">720</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">__cache__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-721"><a href="#DDCUtil.get_brightness-721"><span class="linenos">721</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil.get_brightness-722"><a href="#DDCUtil.get_brightness-722"><span class="linenos">722</span></a>                <span class="n">cmd_out</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DDCUtil.get_brightness-723"><a href="#DDCUtil.get_brightness-723"><span class="linenos">723</span></a>                    <span class="n">check_output</span><span class="p">(</span>
</span><span id="DDCUtil.get_brightness-724"><a href="#DDCUtil.get_brightness-724"><span class="linenos">724</span></a>                        <span class="p">[</span>
</span><span id="DDCUtil.get_brightness-725"><a href="#DDCUtil.get_brightness-725"><span class="linenos">725</span></a>                            <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-726"><a href="#DDCUtil.get_brightness-726"><span class="linenos">726</span></a>                            <span class="s1">&#39;getvcp&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-727"><a href="#DDCUtil.get_brightness-727"><span class="linenos">727</span></a>                            <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-728"><a href="#DDCUtil.get_brightness-728"><span class="linenos">728</span></a>                            <span class="s1">&#39;-t&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-729"><a href="#DDCUtil.get_brightness-729"><span class="linenos">729</span></a>                            <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-730"><a href="#DDCUtil.get_brightness-730"><span class="linenos">730</span></a>                            <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="DDCUtil.get_brightness-731"><a href="#DDCUtil.get_brightness-731"><span class="linenos">731</span></a>                            <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-732"><a href="#DDCUtil.get_brightness-732"><span class="linenos">732</span></a>                        <span class="p">],</span>
</span><span id="DDCUtil.get_brightness-733"><a href="#DDCUtil.get_brightness-733"><span class="linenos">733</span></a>                        <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="DDCUtil.get_brightness-734"><a href="#DDCUtil.get_brightness-734"><span class="linenos">734</span></a>                    <span class="p">)</span>
</span><span id="DDCUtil.get_brightness-735"><a href="#DDCUtil.get_brightness-735"><span class="linenos">735</span></a>                    <span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="DDCUtil.get_brightness-736"><a href="#DDCUtil.get_brightness-736"><span class="linenos">736</span></a>                    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-737"><a href="#DDCUtil.get_brightness-737"><span class="linenos">737</span></a>                <span class="p">)</span>
</span><span id="DDCUtil.get_brightness-738"><a href="#DDCUtil.get_brightness-738"><span class="linenos">738</span></a>
</span><span id="DDCUtil.get_brightness-739"><a href="#DDCUtil.get_brightness-739"><span class="linenos">739</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</span><span id="DDCUtil.get_brightness-740"><a href="#DDCUtil.get_brightness-740"><span class="linenos">740</span></a>                <span class="n">max_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd_out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DDCUtil.get_brightness-741"><a href="#DDCUtil.get_brightness-741"><span class="linenos">741</span></a>                <span class="k">if</span> <span class="n">max_value</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="DDCUtil.get_brightness-742"><a href="#DDCUtil.get_brightness-742"><span class="linenos">742</span></a>                    <span class="c1"># if the max brightness is not 100 then the number is not a percentage</span>
</span><span id="DDCUtil.get_brightness-743"><a href="#DDCUtil.get_brightness-743"><span class="linenos">743</span></a>                    <span class="c1"># and will need to be scaled</span>
</span><span id="DDCUtil.get_brightness-744"><a href="#DDCUtil.get_brightness-744"><span class="linenos">744</span></a>                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="n">max_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-745"><a href="#DDCUtil.get_brightness-745"><span class="linenos">745</span></a>
</span><span id="DDCUtil.get_brightness-746"><a href="#DDCUtil.get_brightness-746"><span class="linenos">746</span></a>                <span class="c1"># now make sure max brightness is recorded so set_brightness can use it</span>
</span><span id="DDCUtil.get_brightness-747"><a href="#DDCUtil.get_brightness-747"><span class="linenos">747</span></a>                <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="DDCUtil.get_brightness-748"><a href="#DDCUtil.get_brightness-748"><span class="linenos">748</span></a>                <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="DDCUtil.get_brightness-749"><a href="#DDCUtil.get_brightness-749"><span class="linenos">749</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_value</span>
</span><span id="DDCUtil.get_brightness-750"><a href="#DDCUtil.get_brightness-750"><span class="linenos">750</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cache_ident</span><span class="si">}</span><span class="s1"> max brightness:</span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s1"> (current: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-751"><a href="#DDCUtil.get_brightness-751"><span class="linenos">751</span></a>
</span><span id="DDCUtil.get_brightness-752"><a href="#DDCUtil.get_brightness-752"><span class="linenos">752</span></a>                <span class="n">__cache__</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ddcutil_brightness_</span><span class="si">{</span><span class="n">monitor</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expires</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-753"><a href="#DDCUtil.get_brightness-753"><span class="linenos">753</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="DDCUtil.get_brightness-754"><a href="#DDCUtil.get_brightness-754"><span class="linenos">754</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>display:</strong>  the index of the specific display to query.
If unspecified, all detected displays are queried</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A list of <code><a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a></code> values, one for each
  queried display</p>
</blockquote>
</div>


                            </div>
                            <div id="DDCUtil.set_brightness" class="classattr">
                                        <input id="DDCUtil.set_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">set_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DDCUtil.set_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DDCUtil.set_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DDCUtil.set_brightness-756"><a href="#DDCUtil.set_brightness-756"><span class="linenos">756</span></a>    <span class="nd">@classmethod</span>
</span><span id="DDCUtil.set_brightness-757"><a href="#DDCUtil.set_brightness-757"><span class="linenos">757</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_brightness</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">IntPercentage</span><span class="p">,</span> <span class="n">display</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="DDCUtil.set_brightness-758"><a href="#DDCUtil.set_brightness-758"><span class="linenos">758</span></a>        <span class="n">monitors</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="DDCUtil.set_brightness-759"><a href="#DDCUtil.set_brightness-759"><span class="linenos">759</span></a>        <span class="k">if</span> <span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DDCUtil.set_brightness-760"><a href="#DDCUtil.set_brightness-760"><span class="linenos">760</span></a>            <span class="n">monitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">monitors</span><span class="p">[</span><span class="n">display</span><span class="p">]]</span>
</span><span id="DDCUtil.set_brightness-761"><a href="#DDCUtil.set_brightness-761"><span class="linenos">761</span></a>
</span><span id="DDCUtil.set_brightness-762"><a href="#DDCUtil.set_brightness-762"><span class="linenos">762</span></a>        <span class="n">__cache__</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">startswith</span><span class="o">=</span><span class="s1">&#39;ddcutil_brightness_&#39;</span><span class="p">)</span>
</span><span id="DDCUtil.set_brightness-763"><a href="#DDCUtil.set_brightness-763"><span class="linenos">763</span></a>        <span class="k">for</span> <span class="n">monitor</span> <span class="ow">in</span> <span class="n">monitors</span><span class="p">:</span>
</span><span id="DDCUtil.set_brightness-764"><a href="#DDCUtil.set_brightness-764"><span class="linenos">764</span></a>            <span class="c1"># check if monitor has a max brightness that requires us to scale this value</span>
</span><span id="DDCUtil.set_brightness-765"><a href="#DDCUtil.set_brightness-765"><span class="linenos">765</span></a>            <span class="n">cache_ident</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;serial&#39;</span><span class="p">],</span> <span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bin_serial&#39;</span><span class="p">])</span>
</span><span id="DDCUtil.set_brightness-766"><a href="#DDCUtil.set_brightness-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="n">cache_ident</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">:</span>
</span><span id="DDCUtil.set_brightness-767"><a href="#DDCUtil.set_brightness-767"><span class="linenos">767</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">get_brightness</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>
</span><span id="DDCUtil.set_brightness-768"><a href="#DDCUtil.set_brightness-768"><span class="linenos">768</span></a>
</span><span id="DDCUtil.set_brightness-769"><a href="#DDCUtil.set_brightness-769"><span class="linenos">769</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="DDCUtil.set_brightness-770"><a href="#DDCUtil.set_brightness-770"><span class="linenos">770</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_max_brightness_cache</span><span class="p">[</span><span class="n">cache_ident</span><span class="p">])</span>
</span><span id="DDCUtil.set_brightness-771"><a href="#DDCUtil.set_brightness-771"><span class="linenos">771</span></a>
</span><span id="DDCUtil.set_brightness-772"><a href="#DDCUtil.set_brightness-772"><span class="linenos">772</span></a>            <span class="n">check_output</span><span class="p">(</span>
</span><span id="DDCUtil.set_brightness-773"><a href="#DDCUtil.set_brightness-773"><span class="linenos">773</span></a>                <span class="p">[</span>
</span><span id="DDCUtil.set_brightness-774"><a href="#DDCUtil.set_brightness-774"><span class="linenos">774</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-775"><a href="#DDCUtil.set_brightness-775"><span class="linenos">775</span></a>                    <span class="s1">&#39;setvcp&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-776"><a href="#DDCUtil.set_brightness-776"><span class="linenos">776</span></a>                    <span class="s1">&#39;10&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-777"><a href="#DDCUtil.set_brightness-777"><span class="linenos">777</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
</span><span id="DDCUtil.set_brightness-778"><a href="#DDCUtil.set_brightness-778"><span class="linenos">778</span></a>                    <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-779"><a href="#DDCUtil.set_brightness-779"><span class="linenos">779</span></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">monitor</span><span class="p">[</span><span class="s1">&#39;bus_number&#39;</span><span class="p">]),</span>
</span><span id="DDCUtil.set_brightness-780"><a href="#DDCUtil.set_brightness-780"><span class="linenos">780</span></a>                    <span class="sa">f</span><span class="s1">&#39;--sleep-multiplier=</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">sleep_multiplier</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-781"><a href="#DDCUtil.set_brightness-781"><span class="linenos">781</span></a>                <span class="p">],</span>
</span><span id="DDCUtil.set_brightness-782"><a href="#DDCUtil.set_brightness-782"><span class="linenos">782</span></a>                <span class="n">max_tries</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">cmd_max_tries</span><span class="p">,</span>
</span><span id="DDCUtil.set_brightness-783"><a href="#DDCUtil.set_brightness-783"><span class="linenos">783</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>value (<a href="types.html#IntPercentage">screen_brightness_control.types.IntPercentage</a>):</strong>  the new brightness value</li>
<li><strong>display:</strong>  the index of the specific display to adjust.
If unspecified, all detected displays are adjusted</li>
</ul>
</div>


                            </div>
                </section>
                <section id="i2c_bus_from_drm_device">
                            <input id="i2c_bus_from_drm_device-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">i2c_bus_from_drm_device</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">dir</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="i2c_bus_from_drm_device-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#i2c_bus_from_drm_device"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="i2c_bus_from_drm_device-786"><a href="#i2c_bus_from_drm_device-786"><span class="linenos">786</span></a><span class="k">def</span><span class="w"> </span><span class="nf">i2c_bus_from_drm_device</span><span class="p">(</span><span class="nb">dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="i2c_bus_from_drm_device-787"><a href="#i2c_bus_from_drm_device-787"><span class="linenos">787</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="i2c_bus_from_drm_device-788"><a href="#i2c_bus_from_drm_device-788"><span class="linenos">788</span></a><span class="sd">    Extract the relevant I2C bus number from a device in `/sys/class/drm`.</span>
</span><span id="i2c_bus_from_drm_device-789"><a href="#i2c_bus_from_drm_device-789"><span class="linenos">789</span></a>
</span><span id="i2c_bus_from_drm_device-790"><a href="#i2c_bus_from_drm_device-790"><span class="linenos">790</span></a><span class="sd">    This function works by searching the directory for `i2c-*` and `ddc/i2c-dev/i2c-*` folders.</span>
</span><span id="i2c_bus_from_drm_device-791"><a href="#i2c_bus_from_drm_device-791"><span class="linenos">791</span></a>
</span><span id="i2c_bus_from_drm_device-792"><a href="#i2c_bus_from_drm_device-792"><span class="linenos">792</span></a><span class="sd">    Args:</span>
</span><span id="i2c_bus_from_drm_device-793"><a href="#i2c_bus_from_drm_device-793"><span class="linenos">793</span></a><span class="sd">        dir: the DRM directory, in the format `/sys/class/drm/&lt;device&gt;`</span>
</span><span id="i2c_bus_from_drm_device-794"><a href="#i2c_bus_from_drm_device-794"><span class="linenos">794</span></a>
</span><span id="i2c_bus_from_drm_device-795"><a href="#i2c_bus_from_drm_device-795"><span class="linenos">795</span></a><span class="sd">    Returns:</span>
</span><span id="i2c_bus_from_drm_device-796"><a href="#i2c_bus_from_drm_device-796"><span class="linenos">796</span></a><span class="sd">        Returns the I2C bus number as a string if found. Otherwise, returns None</span>
</span><span id="i2c_bus_from_drm_device-797"><a href="#i2c_bus_from_drm_device-797"><span class="linenos">797</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="i2c_bus_from_drm_device-798"><a href="#i2c_bus_from_drm_device-798"><span class="linenos">798</span></a>    <span class="c1"># check for enabled file and skip device if monitor inactive</span>
</span><span id="i2c_bus_from_drm_device-799"><a href="#i2c_bus_from_drm_device-799"><span class="linenos">799</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/enabled&#39;</span><span class="p">):</span>
</span><span id="i2c_bus_from_drm_device-800"><a href="#i2c_bus_from_drm_device-800"><span class="linenos">800</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/enabled&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="i2c_bus_from_drm_device-801"><a href="#i2c_bus_from_drm_device-801"><span class="linenos">801</span></a>            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;enabled&#39;</span><span class="p">:</span>
</span><span id="i2c_bus_from_drm_device-802"><a href="#i2c_bus_from_drm_device-802"><span class="linenos">802</span></a>                <span class="k">return</span>
</span><span id="i2c_bus_from_drm_device-803"><a href="#i2c_bus_from_drm_device-803"><span class="linenos">803</span></a>
</span><span id="i2c_bus_from_drm_device-804"><a href="#i2c_bus_from_drm_device-804"><span class="linenos">804</span></a>    <span class="c1"># sometimes the i2c path is in /sys/class/drm/*/i2c-*</span>
</span><span id="i2c_bus_from_drm_device-805"><a href="#i2c_bus_from_drm_device-805"><span class="linenos">805</span></a>    <span class="c1"># do this first because, in my testing, sometimes a device can have both `.../i2c-X` and `.../ddc/i2c-dev/...`</span>
</span><span id="i2c_bus_from_drm_device-806"><a href="#i2c_bus_from_drm_device-806"><span class="linenos">806</span></a>    <span class="c1"># and the latter is usually the wrong i2c path</span>
</span><span id="i2c_bus_from_drm_device-807"><a href="#i2c_bus_from_drm_device-807"><span class="linenos">807</span></a>    <span class="n">paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/i2c-*&#39;</span><span class="p">)</span>
</span><span id="i2c_bus_from_drm_device-808"><a href="#i2c_bus_from_drm_device-808"><span class="linenos">808</span></a>    <span class="k">if</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="i2c_bus_from_drm_device-809"><a href="#i2c_bus_from_drm_device-809"><span class="linenos">809</span></a>        <span class="k">return</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="i2c_bus_from_drm_device-810"><a href="#i2c_bus_from_drm_device-810"><span class="linenos">810</span></a>
</span><span id="i2c_bus_from_drm_device-811"><a href="#i2c_bus_from_drm_device-811"><span class="linenos">811</span></a>    <span class="c1"># sometimes the i2c path is in /sys/class/drm/*/ddc/i2c-dev</span>
</span><span id="i2c_bus_from_drm_device-812"><a href="#i2c_bus_from_drm_device-812"><span class="linenos">812</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/ddc/i2c-dev&#39;</span><span class="p">):</span>
</span><span id="i2c_bus_from_drm_device-813"><a href="#i2c_bus_from_drm_device-813"><span class="linenos">813</span></a>        <span class="n">paths</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s1">/ddc/i2c-dev&#39;</span><span class="p">)</span>
</span><span id="i2c_bus_from_drm_device-814"><a href="#i2c_bus_from_drm_device-814"><span class="linenos">814</span></a>        <span class="k">if</span> <span class="n">paths</span><span class="p">:</span>
</span><span id="i2c_bus_from_drm_device-815"><a href="#i2c_bus_from_drm_device-815"><span class="linenos">815</span></a>            <span class="k">return</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;i2c-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract the relevant I2C bus number from a device in <code>/sys/class/drm</code>.</p>

<p>This function works by searching the directory for <code>i2c-*</code> and <code>ddc/i2c-dev/i2c-*</code> folders.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>dir:</strong>  the DRM directory, in the format <code>/sys/class/drm/&lt;device&gt;</code></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Returns the I2C bus number as a string if found. Otherwise, returns None</p>
</blockquote>
</div>


                </section>
                <section id="list_monitors_info">
                            <input id="list_monitors_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_monitors_info</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">allow_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">unsupported</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="list_monitors_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#list_monitors_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="list_monitors_info-818"><a href="#list_monitors_info-818"><span class="linenos">818</span></a><span class="k">def</span><span class="w"> </span><span class="nf">list_monitors_info</span><span class="p">(</span>
</span><span id="list_monitors_info-819"><a href="#list_monitors_info-819"><span class="linenos">819</span></a>    <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">allow_duplicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">unsupported</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="list_monitors_info-820"><a href="#list_monitors_info-820"><span class="linenos">820</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="list_monitors_info-821"><a href="#list_monitors_info-821"><span class="linenos">821</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="list_monitors_info-822"><a href="#list_monitors_info-822"><span class="linenos">822</span></a><span class="sd">    Lists detailed information about all detected displays</span>
</span><span id="list_monitors_info-823"><a href="#list_monitors_info-823"><span class="linenos">823</span></a>
</span><span id="list_monitors_info-824"><a href="#list_monitors_info-824"><span class="linenos">824</span></a><span class="sd">    Args:</span>
</span><span id="list_monitors_info-825"><a href="#list_monitors_info-825"><span class="linenos">825</span></a><span class="sd">        method: the method the display can be addressed by. See `.get_methods`</span>
</span><span id="list_monitors_info-826"><a href="#list_monitors_info-826"><span class="linenos">826</span></a><span class="sd">            for more info on available methods</span>
</span><span id="list_monitors_info-827"><a href="#list_monitors_info-827"><span class="linenos">827</span></a><span class="sd">        allow_duplicates: whether to filter out duplicate displays (displays with the same EDID) or not</span>
</span><span id="list_monitors_info-828"><a href="#list_monitors_info-828"><span class="linenos">828</span></a><span class="sd">        unsupported: include detected displays that are invalid or unsupported</span>
</span><span id="list_monitors_info-829"><a href="#list_monitors_info-829"><span class="linenos">829</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="list_monitors_info-830"><a href="#list_monitors_info-830"><span class="linenos">830</span></a>    <span class="n">all_methods</span> <span class="o">=</span> <span class="n">get_methods</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="list_monitors_info-831"><a href="#list_monitors_info-831"><span class="linenos">831</span></a>    <span class="n">haystack</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="list_monitors_info-832"><a href="#list_monitors_info-832"><span class="linenos">832</span></a>    <span class="k">for</span> <span class="n">method_class</span> <span class="ow">in</span> <span class="n">all_methods</span><span class="p">:</span>
</span><span id="list_monitors_info-833"><a href="#list_monitors_info-833"><span class="linenos">833</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="list_monitors_info-834"><a href="#list_monitors_info-834"><span class="linenos">834</span></a>            <span class="k">if</span> <span class="n">unsupported</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">method_class</span><span class="p">,</span> <span class="n">BrightnessMethodAdv</span><span class="p">):</span>
</span><span id="list_monitors_info-835"><a href="#list_monitors_info-835"><span class="linenos">835</span></a>                <span class="n">haystack</span> <span class="o">+=</span> <span class="n">method_class</span><span class="o">.</span><span class="n">_gdi</span><span class="p">()</span>
</span><span id="list_monitors_info-836"><a href="#list_monitors_info-836"><span class="linenos">836</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="list_monitors_info-837"><a href="#list_monitors_info-837"><span class="linenos">837</span></a>                <span class="n">haystack</span> <span class="o">+=</span> <span class="n">method_class</span><span class="o">.</span><span class="n">get_display_info</span><span class="p">()</span>
</span><span id="list_monitors_info-838"><a href="#list_monitors_info-838"><span class="linenos">838</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="list_monitors_info-839"><a href="#list_monitors_info-839"><span class="linenos">839</span></a>            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error grabbing display info from </span><span class="si">{</span><span class="n">method_class</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">format_exc</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="list_monitors_info-840"><a href="#list_monitors_info-840"><span class="linenos">840</span></a>            <span class="k">pass</span>
</span><span id="list_monitors_info-841"><a href="#list_monitors_info-841"><span class="linenos">841</span></a>
</span><span id="list_monitors_info-842"><a href="#list_monitors_info-842"><span class="linenos">842</span></a>    <span class="k">if</span> <span class="n">allow_duplicates</span><span class="p">:</span>
</span><span id="list_monitors_info-843"><a href="#list_monitors_info-843"><span class="linenos">843</span></a>        <span class="k">return</span> <span class="n">haystack</span>
</span><span id="list_monitors_info-844"><a href="#list_monitors_info-844"><span class="linenos">844</span></a>
</span><span id="list_monitors_info-845"><a href="#list_monitors_info-845"><span class="linenos">845</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="list_monitors_info-846"><a href="#list_monitors_info-846"><span class="linenos">846</span></a>        <span class="c1"># use filter_monitors to remove duplicates</span>
</span><span id="list_monitors_info-847"><a href="#list_monitors_info-847"><span class="linenos">847</span></a>        <span class="k">return</span> <span class="n">filter_monitors</span><span class="p">(</span><span class="n">haystack</span><span class="o">=</span><span class="n">haystack</span><span class="p">)</span>
</span><span id="list_monitors_info-848"><a href="#list_monitors_info-848"><span class="linenos">848</span></a>    <span class="k">except</span> <span class="n">NoValidDisplayError</span><span class="p">:</span>
</span><span id="list_monitors_info-849"><a href="#list_monitors_info-849"><span class="linenos">849</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Lists detailed information about all detected displays</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>method:</strong>  the method the display can be addressed by. See <code><a href="../screen_brightness_control.html#get_methods">screen_brightness_control.get_methods</a></code>
for more info on available methods</li>
<li><strong>allow_duplicates:</strong>  whether to filter out duplicate displays (displays with the same EDID) or not</li>
<li><strong>unsupported:</strong>  include detected displays that are invalid or unsupported</li>
</ul>
</div>


                </section>
                <section id="METHODS">
                    <div class="attr variable">
            <span class="name">METHODS</span>        =
<input id="METHODS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="METHODS-view-value"></label><span class="default_value">(&lt;class &#39;<a href="#SysFiles">SysFiles</a>&#39;&gt;, &lt;class &#39;<a href="#I2C">I2C</a>&#39;&gt;, &lt;class &#39;<a href="#XRandr">XRandr</a>&#39;&gt;, &lt;class &#39;<a href="#DDCUtil">DDCUtil</a>&#39;&gt;)</span>

        
    </div>
    <a class="headerlink" href="#METHODS"></a>
    
    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>